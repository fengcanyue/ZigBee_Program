###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.40194/W32 for 8051         29/Sep/2015  20:23:28 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Componen #
#                          ts\mt\MT_ZDO.c                                     #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\SampleApp -                    #
#                          ¸±±¾\CC2530DB\..\..\..\Tools\CC2530DB\f8wRouter.cf #
#                          g" (-DCPU32MHZ -DROOT=__near_func                  #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0      #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Components\mt\MT_ #
#                          ZDO.c" -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D    #
#                          MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\RouterEB\List\"   #
#                          -lA "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\SampleApp -                   #
#                          ¸±±¾\CC2530DB\RouterEB\List\" --diag_suppress      #
#                          Pe001,Pa010 -o "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\RouterEB\Obj\"    #
#                          -e --no_cse --no_unroll --no_inline                #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\..\Source\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp -                       #
#                          ¸±±¾\CC2530DB\..\..\..\ZMain\TI2530DB\" -I         #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp -                       #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\hal\includ #
#                          e\" -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\ #
#                          Projects\zstack\Samples\SampleApp -                #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\hal\target #
#                          \CC2530EB\" -I "C:\Texas                           #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\include\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\high_level\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\low_level\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp - ¸±±¾\CC2530DB\..\..\..\..\..\Co #
#                          mponents\mac\low_level\srf04\single_chip\" -I      #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp -                       #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\mt\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp -                       #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\osal\inclu #
#                          de\" -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a #
#                          \Projects\zstack\Samples\SampleApp -               #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\services\s #
#                          addr\" -I "C:\Texas Instruments\ZStack-CC2530-2.5. #
#                          1a\Projects\zstack\Samples\SampleApp -             #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\services\s #
#                          data\" -I "C:\Texas Instruments\ZStack-CC2530-2.5. #
#                          1a\Projects\zstack\Samples\SampleApp -             #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\stack\af\" #
#                           -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Samples\SampleApp -                   #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\stack\nwk\ #
#                          " -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pr #
#                          ojects\zstack\Samples\SampleApp -                  #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\stack\sapi #
#                          \" -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\SampleApp -                 #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\stack\sec\ #
#                          " -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pr #
#                          ojects\zstack\Samples\SampleApp -                  #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\stack\sys\ #
#                          " -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pr #
#                          ojects\zstack\Samples\SampleApp -                  #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\stack\zdo\ #
#                          " -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Pr #
#                          ojects\zstack\Samples\SampleApp -                  #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\zmac\" -I  #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp -                       #
#                          ¸±±¾\CC2530DB\..\..\..\..\..\Components\zmac\f8w\" #
#                           -On --require_prototypes                          #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\SampleApp -                        #
#                          ¸±±¾\CC2530DB\RouterEB\List\MT_ZDO.lst             #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\SampleApp -                        #
#                          ¸±±¾\CC2530DB\RouterEB\Obj\MT_ZDO.r51              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Components\mt\MT_ZDO.c
      1          /**************************************************************************************************
      2            Filename:       MT_ZDO.c
      3            Revised:        $Date: 2012-02-16 16:04:32 -0800 (Thu, 16 Feb 2012) $
      4            Revision:       $Revision: 29348 $
      5          
      6            Description:    MonitorTest functions for the ZDO layer.
      7          
      8          
      9            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License"). You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          #ifdef MT_ZDO_FUNC
     41          
     42          /**************************************************************************************************
     43           * INCLUDES
     44           **************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Nv.h"
     48          #include "MT.h"
     49          #include "MT_ZDO.h"
     50          #include "APSMEDE.h"
     51          #include "ZDConfig.h"
     52          #include "ZDProfile.h"
     53          #include "ZDObject.h"
     54          #include "ZDApp.h"
     55          
     56          #if !defined( WIN32 )
     57            #include "OnBoard.h"
     58          #endif
     59          
     60          #if defined ( MT_SYS_KEY_MANAGEMENT )
     61            #include "ZDSecMgr.h"
     62          #endif
     63          
     64          #include "nwk_util.h"
     65          
     66          /**************************************************************************************************
     67           * CONSTANTS
     68           **************************************************************************************************/
     69          #define MT_ZDO_END_DEVICE_ANNCE_IND_LEN   0x0D
     70          #define MT_ZDO_ADDR_RSP_LEN               0x0D
     71          #define MT_ZDO_BIND_UNBIND_RSP_LEN        0x03
     72          #define MT_ZDO_BEACON_IND_LEN             21
     73          #define MT_ZDO_BEACON_IND_PACK_LEN        (MT_UART_TX_BUFF_MAX - SPI_0DATA_MSG_LEN)
     74          #define MT_ZDO_JOIN_CNF_LEN               5
     75          
     76          // Message must pack nwk addr, entire (not just pointer to) ieee addr, and packet cost, so the
     77          // sizeof(zdoConcentratorInd_t) is not usable.
     78          #define MT_ZDO_CONCENTRATOR_IND_LEN      (2 + Z_EXTADDR_LEN + 1)
     79          
     80          #define MTZDO_RESPONSE_BUFFER_LEN   100
     81          
     82          #define MTZDO_MAX_MATCH_CLUSTERS    16
     83          #define MTZDO_MAX_ED_BIND_CLUSTERS  15
     84          
     85          // Conversion from ZDO Cluster Id to the RPC AREQ Id is direct as follows:
     86          #define MT_ZDO_CID_TO_AREQ_ID(CId)  ((uint8)(CId) | 0x80)
     87          
     88          #define MT_ZDO_STATUS_LEN   1
     89          
     90          /**************************************************************************************************
     91           * GLOBAL VARIABLES
     92           **************************************************************************************************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     93          uint32 _zdoCallbackSub;
   \                     _zdoCallbackSub:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     94          uint8 *pBeaconIndBuf = NULL;
   \                     pBeaconIndBuf:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     95          
     96          /**************************************************************************************************
     97           * LOCAL VARIABLES
     98           **************************************************************************************************/
     99          
    100          /**************************************************************************************************
    101           * LOCAL FUNCTIONS
    102           **************************************************************************************************/
    103          #if defined (MT_ZDO_FUNC)
    104          void MT_ZdoNWKAddressRequest(uint8 *pBuf);
    105          void MT_ZdoIEEEAddrRequest(uint8 *pBuf);
    106          void MT_ZdoNodeDescRequest(uint8 *pBuf);
    107          void MT_ZdoPowerDescRequest(uint8 *pBuf);
    108          void MT_ZdoSimpleDescRequest(uint8 *pBuf);
    109          void MT_ZdoActiveEpRequest(uint8 *pBuf);
    110          void MT_ZdoMatchDescRequest(uint8 *pBuf);
    111          void MT_ZdoComplexDescRequest(uint8 *pBuf);
    112          void MT_ZdoUserDescRequest(uint8 *pBuf);
    113          void MT_ZdoEndDevAnnce(uint8 *pBuf);
    114          void MT_ZdoUserDescSet(uint8 *pBuf);
    115          void MT_ZdoServiceDiscRequest(uint8 *pBuf);
    116          void MT_ZdoEndDevBindRequest(uint8 *pBuf);
    117          void MT_ZdoBindRequest(uint8 *pBuf);
    118          void MT_ZdoUnbindRequest(uint8 *pBuf);
    119          void MT_ZdoMgmtNwkDiscRequest(uint8 *pBuf);
    120          #if defined ( MT_SYS_KEY_MANAGEMENT )
    121          void MT_ZdoSetLinkKey(uint8 *pBuf);
    122          void MT_ZdoRemoveLinkKey(uint8 *pBuf);
    123          void MT_ZdoGetLinkKey(uint8 *pBuf);
    124          #endif /* MT_SYS_KEY_MANAGEMENT */
    125          void MT_ZdoNetworkDiscoveryReq(uint8 *pBuf);
    126          void MT_ZdoJoinReq(uint8 *pBuf);
    127          /* Call back function */
    128          void *MT_ZdoNwkDiscoveryCnfCB ( void *pStr );
    129          void *MT_ZdoBeaconIndCB ( void *pStr );
    130          void *MT_ZdoJoinCnfCB ( void *pStr );
    131          #if defined (MT_ZDO_MGMT)
    132          void MT_ZdoMgmtLqiRequest(uint8 *pBuf);
    133          void MT_ZdoMgmtRtgRequest(uint8 *pBuf);
    134          void MT_ZdoMgmtBindRequest(uint8 *pBuf);
    135          void MT_ZdoMgmtLeaveRequest(uint8 *pBuf);
    136          void MT_ZdoMgmtDirectJoinRequest(uint8 *pBuf);
    137          void MT_ZdoMgmtPermitJoinRequest(uint8 *pBuf);
    138          void MT_ZdoMgmtNwkUpdateRequest(uint8 *pBuf);
    139          #endif /* MT_ZDO_MGMT */
    140          void MT_ZdoStartupFromApp(uint8 *pBuf);
    141          void MT_ZdoRegisterForZDOMsg(uint8 *pBuf);
    142          void MT_ZdoRemoveRegisteredCB(uint8 *pBuf);
    143          #endif /* MT_ZDO_FUNC */
    144          
    145          #if defined (MT_ZDO_CB_FUNC)
    146          uint8 MT_ZdoHandleExceptions( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg );
    147          void MT_ZdoAddrRspCB( ZDO_NwkIEEEAddrResp_t *pMsg, uint16 clusterID );
    148          void MT_ZdoEndDevAnnceCB( ZDO_DeviceAnnce_t *pMsg, uint16 srcAddr );
    149          void MT_ZdoBindUnbindRspCB( uint16 clusterID, uint16 srcAddr, uint8 status );
    150          void* MT_ZdoSrcRtgCB( void *pStr );
    151          static void *MT_ZdoConcentratorIndCB(void *pStr);
    152          static void *MT_ZdoLeaveInd(void *vPtr);
    153          #endif /* MT_ZDO_CB_FUNC */
    154          
    155          #if defined (MT_ZDO_FUNC)
    156          /***************************************************************************************************
    157           * @fn      MT_ZdoInit
    158           *
    159           * @brief   MT ZDO initialization
    160           *
    161           * @param   none
    162           *
    163           * @return  none
    164           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    165          void MT_ZdoInit(void)
   \                     MT_ZdoInit:
    166          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    167          #ifdef MT_ZDO_CB_FUNC
    168            /* Register with ZDO for indication callbacks */
    169            ZDO_RegisterForZdoCB(ZDO_SRC_RTG_IND_CBID, &MT_ZdoSrcRtgCB);
    170            ZDO_RegisterForZdoCB(ZDO_CONCENTRATOR_IND_CBID, &MT_ZdoConcentratorIndCB);
    171            ZDO_RegisterForZdoCB(ZDO_LEAVE_IND_CBID, &MT_ZdoLeaveInd);
    172          #endif
    173          }
   \   000000   02....       LJMP    ?BRET
    174          
    175          /***************************************************************************************************
    176           * @fn      MT_ZdoCommandProcessing
    177           *
    178           * @brief
    179           *
    180           *   Process all the ZDO commands that are issued by test tool
    181           *
    182           * @param   pBuf - pointer to the msg buffer
    183           *
    184           *          | LEN  | CMD0  | CMD1  |  DATA  |
    185           *          |  1   |   1   |   1   |  0-255 |
    186           *
    187           * @return  status
    188           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    189          uint8 MT_ZdoCommandProcessing(uint8* pBuf)
   \                     MT_ZdoCommandProcessing:
    190          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    191            uint8 status = MT_RPC_SUCCESS;
   \   000009   75..00       MOV     ?V0 + 0,#0x0
    192          
    193            switch (pBuf[MT_RPC_POS_CMD1])
   \   00000C   8E82         MOV     DPL,R6
   \   00000E   8F83         MOV     DPH,R7
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   6076         JZ      ??MT_ZdoCommandProcessing_0
   \   000015   14           DEC     A
   \   000016   607D         JZ      ??MT_ZdoCommandProcessing_1
   \   000018   14           DEC     A
   \   000019   7003         JNZ     $+5
   \   00001B   02....       LJMP    ??MT_ZdoCommandProcessing_2 & 0xFFFF
   \   00001E   14           DEC     A
   \   00001F   7003         JNZ     $+5
   \   000021   02....       LJMP    ??MT_ZdoCommandProcessing_3 & 0xFFFF
   \   000024   14           DEC     A
   \   000025   7003         JNZ     $+5
   \   000027   02....       LJMP    ??MT_ZdoCommandProcessing_4 & 0xFFFF
   \   00002A   14           DEC     A
   \   00002B   7003         JNZ     $+5
   \   00002D   02....       LJMP    ??MT_ZdoCommandProcessing_5 & 0xFFFF
   \   000030   14           DEC     A
   \   000031   7003         JNZ     $+5
   \   000033   02....       LJMP    ??MT_ZdoCommandProcessing_6 & 0xFFFF
   \   000036   14           DEC     A
   \   000037   7003         JNZ     $+5
   \   000039   02....       LJMP    ??MT_ZdoCommandProcessing_7 & 0xFFFF
   \   00003C   14           DEC     A
   \   00003D   7003         JNZ     $+5
   \   00003F   02....       LJMP    ??MT_ZdoCommandProcessing_8 & 0xFFFF
   \   000042   24FE         ADD     A,#-0x2
   \   000044   7003         JNZ     $+5
   \   000046   02....       LJMP    ??MT_ZdoCommandProcessing_9 & 0xFFFF
   \   000049   14           DEC     A
   \   00004A   7003         JNZ     $+5
   \   00004C   02....       LJMP    ??MT_ZdoCommandProcessing_10 & 0xFFFF
   \   00004F   14           DEC     A
   \   000050   7003         JNZ     $+5
   \   000052   02....       LJMP    ??MT_ZdoCommandProcessing_11 & 0xFFFF
   \   000055   24EC         ADD     A,#-0x14
   \   000057   7003         JNZ     $+5
   \   000059   02....       LJMP    ??MT_ZdoCommandProcessing_12 & 0xFFFF
   \   00005C   14           DEC     A
   \   00005D   7003         JNZ     $+5
   \   00005F   02....       LJMP    ??MT_ZdoCommandProcessing_13 & 0xFFFF
   \   000062   14           DEC     A
   \   000063   7003         JNZ     $+5
   \   000065   02....       LJMP    ??MT_ZdoCommandProcessing_14 & 0xFFFF
   \   000068   24FC         ADD     A,#-0x4
   \   00006A   7003         JNZ     $+5
   \   00006C   02....       LJMP    ??MT_ZdoCommandProcessing_15 & 0xFFFF
   \   00006F   14           DEC     A
   \   000070   7003         JNZ     $+5
   \   000072   02....       LJMP    ??MT_ZdoCommandProcessing_16 & 0xFFFF
   \   000075   24E9         ADD     A,#-0x17
   \   000077   7003         JNZ     $+5
   \   000079   02....       LJMP    ??MT_ZdoCommandProcessing_17 & 0xFFFF
   \   00007C   14           DEC     A
   \   00007D   7003         JNZ     $+5
   \   00007F   02....       LJMP    ??MT_ZdoCommandProcessing_18 & 0xFFFF
   \   000082   14           DEC     A
   \   000083   7003         JNZ     $+5
   \   000085   02....       LJMP    ??MT_ZdoCommandProcessing_19 & 0xFFFF
   \   000088   02....       LJMP    ??MT_ZdoCommandProcessing_20 & 0xFFFF
    194            {
    195          #if defined ( ZDO_NWKADDR_REQUEST )
    196              case MT_ZDO_NWK_ADDR_REQ:
    197                MT_ZdoNWKAddressRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_0:
   \   00008B                ; Setup parameters for call to function MT_ZdoNWKAddressRequest
   \   00008B   EE           MOV     A,R6
   \   00008C   FA           MOV     R2,A
   \   00008D   EF           MOV     A,R7
   \   00008E   FB           MOV     R3,A
   \   00008F   12....       LCALL   ??MT_ZdoNWKAddressRequest?relay
    198                break;
   \   000092   02....       LJMP    ??MT_ZdoCommandProcessing_21 & 0xFFFF
    199          #endif
    200          
    201          #if defined ( ZDO_IEEEADDR_REQUEST )
    202              case MT_ZDO_IEEE_ADDR_REQ:
    203                MT_ZdoIEEEAddrRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_1:
   \   000095                ; Setup parameters for call to function MT_ZdoIEEEAddrRequest
   \   000095   EE           MOV     A,R6
   \   000096   FA           MOV     R2,A
   \   000097   EF           MOV     A,R7
   \   000098   FB           MOV     R3,A
   \   000099   12....       LCALL   ??MT_ZdoIEEEAddrRequest?relay
    204                break;
   \   00009C   02....       LJMP    ??MT_ZdoCommandProcessing_21 & 0xFFFF
    205          #endif
    206          
    207          #if defined ( ZDO_NODEDESC_REQUEST )
    208              case MT_ZDO_NODE_DESC_REQ:
    209                MT_ZdoNodeDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_2:
   \   00009F                ; Setup parameters for call to function MT_ZdoNodeDescRequest
   \   00009F   EE           MOV     A,R6
   \   0000A0   FA           MOV     R2,A
   \   0000A1   EF           MOV     A,R7
   \   0000A2   FB           MOV     R3,A
   \   0000A3   12....       LCALL   ??MT_ZdoNodeDescRequest?relay
    210                break;
   \   0000A6   02....       LJMP    ??MT_ZdoCommandProcessing_21 & 0xFFFF
    211          #endif
    212          
    213          #if defined ( ZDO_POWERDESC_REQUEST )
    214              case MT_ZDO_POWER_DESC_REQ:
    215                MT_ZdoPowerDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_3:
   \   0000A9                ; Setup parameters for call to function MT_ZdoPowerDescRequest
   \   0000A9   EE           MOV     A,R6
   \   0000AA   FA           MOV     R2,A
   \   0000AB   EF           MOV     A,R7
   \   0000AC   FB           MOV     R3,A
   \   0000AD   12....       LCALL   ??MT_ZdoPowerDescRequest?relay
    216                break;
   \   0000B0   02....       LJMP    ??MT_ZdoCommandProcessing_21 & 0xFFFF
    217          #endif
    218          
    219          #if defined ( ZDO_SIMPLEDESC_REQUEST )
    220              case MT_ZDO_SIMPLE_DESC_REQ:
    221                MT_ZdoSimpleDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_4:
   \   0000B3                ; Setup parameters for call to function MT_ZdoSimpleDescRequest
   \   0000B3   EE           MOV     A,R6
   \   0000B4   FA           MOV     R2,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   FB           MOV     R3,A
   \   0000B7   12....       LCALL   ??MT_ZdoSimpleDescRequest?relay
    222                break;
   \   0000BA   02....       LJMP    ??MT_ZdoCommandProcessing_21 & 0xFFFF
    223          #endif
    224          
    225          #if defined ( ZDO_ACTIVEEP_REQUEST )
    226              case MT_ZDO_ACTIVE_EP_REQ:
    227                MT_ZdoActiveEpRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_5:
   \   0000BD                ; Setup parameters for call to function MT_ZdoActiveEpRequest
   \   0000BD   EE           MOV     A,R6
   \   0000BE   FA           MOV     R2,A
   \   0000BF   EF           MOV     A,R7
   \   0000C0   FB           MOV     R3,A
   \   0000C1   12....       LCALL   ??MT_ZdoActiveEpRequest?relay
    228                break;
   \   0000C4   02....       LJMP    ??MT_ZdoCommandProcessing_21 & 0xFFFF
    229          #endif
    230          
    231          #if defined ( ZDO_MATCH_REQUEST )
    232              case MT_ZDO_MATCH_DESC_REQ:
    233                MT_ZdoMatchDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_6:
   \   0000C7                ; Setup parameters for call to function MT_ZdoMatchDescRequest
   \   0000C7   EE           MOV     A,R6
   \   0000C8   FA           MOV     R2,A
   \   0000C9   EF           MOV     A,R7
   \   0000CA   FB           MOV     R3,A
   \   0000CB   12....       LCALL   ??MT_ZdoMatchDescRequest?relay
    234                break;
   \   0000CE   8078         SJMP    ??MT_ZdoCommandProcessing_21
    235          #endif
    236          
    237          #if defined ( ZDO_COMPLEXDESC_REQUEST )
    238              case MT_ZDO_COMPLEX_DESC_REQ:
    239                MT_ZdoComplexDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_7:
   \   0000D0                ; Setup parameters for call to function MT_ZdoComplexDescRequest
   \   0000D0   EE           MOV     A,R6
   \   0000D1   FA           MOV     R2,A
   \   0000D2   EF           MOV     A,R7
   \   0000D3   FB           MOV     R3,A
   \   0000D4   12....       LCALL   ??MT_ZdoComplexDescRequest?relay
    240                break;
   \   0000D7   806F         SJMP    ??MT_ZdoCommandProcessing_21
    241          #endif
    242          
    243          #if defined ( ZDO_USERDESC_REQUEST )
    244              case MT_ZDO_USER_DESC_REQ:
    245                MT_ZdoUserDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_8:
   \   0000D9                ; Setup parameters for call to function MT_ZdoUserDescRequest
   \   0000D9   EE           MOV     A,R6
   \   0000DA   FA           MOV     R2,A
   \   0000DB   EF           MOV     A,R7
   \   0000DC   FB           MOV     R3,A
   \   0000DD   12....       LCALL   ??MT_ZdoUserDescRequest?relay
    246                break;
   \   0000E0   8066         SJMP    ??MT_ZdoCommandProcessing_21
    247          #endif
    248          
    249          #if defined ( ZDO_ENDDEVICE_ANNCE )
    250              case MT_ZDO_END_DEV_ANNCE:
    251                MT_ZdoEndDevAnnce(pBuf);
   \                     ??MT_ZdoCommandProcessing_9:
   \   0000E2                ; Setup parameters for call to function MT_ZdoEndDevAnnce
   \   0000E2   EE           MOV     A,R6
   \   0000E3   FA           MOV     R2,A
   \   0000E4   EF           MOV     A,R7
   \   0000E5   FB           MOV     R3,A
   \   0000E6   12....       LCALL   ??MT_ZdoEndDevAnnce?relay
    252                break;
   \   0000E9   805D         SJMP    ??MT_ZdoCommandProcessing_21
    253          #endif
    254          
    255          #if defined ( ZDO_USERDESCSET_REQUEST )
    256              case MT_ZDO_USER_DESC_SET:
    257                MT_ZdoUserDescSet(pBuf);
   \                     ??MT_ZdoCommandProcessing_10:
   \   0000EB                ; Setup parameters for call to function MT_ZdoUserDescSet
   \   0000EB   EE           MOV     A,R6
   \   0000EC   FA           MOV     R2,A
   \   0000ED   EF           MOV     A,R7
   \   0000EE   FB           MOV     R3,A
   \   0000EF   12....       LCALL   ??MT_ZdoUserDescSet?relay
    258                break;
   \   0000F2   8054         SJMP    ??MT_ZdoCommandProcessing_21
    259          #endif
    260          
    261          #if defined ( ZDO_SERVERDISC_REQUEST )
    262              case MT_ZDO_SERVICE_DISC_REQ:
    263                MT_ZdoServiceDiscRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_11:
   \   0000F4                ; Setup parameters for call to function MT_ZdoServiceDiscRequest
   \   0000F4   EE           MOV     A,R6
   \   0000F5   FA           MOV     R2,A
   \   0000F6   EF           MOV     A,R7
   \   0000F7   FB           MOV     R3,A
   \   0000F8   12....       LCALL   ??MT_ZdoServiceDiscRequest?relay
    264                break;
   \   0000FB   804B         SJMP    ??MT_ZdoCommandProcessing_21
    265          #endif
    266          
    267          #if defined ( ZDO_ENDDEVICEBIND_REQUEST )
    268              case MT_ZDO_END_DEV_BIND_REQ:
    269                MT_ZdoEndDevBindRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_12:
   \   0000FD                ; Setup parameters for call to function MT_ZdoEndDevBindRequest
   \   0000FD   EE           MOV     A,R6
   \   0000FE   FA           MOV     R2,A
   \   0000FF   EF           MOV     A,R7
   \   000100   FB           MOV     R3,A
   \   000101   12....       LCALL   ??MT_ZdoEndDevBindRequest?relay
    270                break;
   \   000104   8042         SJMP    ??MT_ZdoCommandProcessing_21
    271          #endif
    272          
    273          #if defined ( ZDO_BIND_UNBIND_REQUEST )
    274              case MT_ZDO_BIND_REQ:
    275                MT_ZdoBindRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_13:
   \   000106                ; Setup parameters for call to function MT_ZdoBindRequest
   \   000106   EE           MOV     A,R6
   \   000107   FA           MOV     R2,A
   \   000108   EF           MOV     A,R7
   \   000109   FB           MOV     R3,A
   \   00010A   12....       LCALL   ??MT_ZdoBindRequest?relay
    276                break;
   \   00010D   8039         SJMP    ??MT_ZdoCommandProcessing_21
    277          #endif
    278          
    279          #if defined ( ZDO_BIND_UNBIND_REQUEST )
    280              case MT_ZDO_UNBIND_REQ:
    281                MT_ZdoUnbindRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_14:
   \   00010F                ; Setup parameters for call to function MT_ZdoUnbindRequest
   \   00010F   EE           MOV     A,R6
   \   000110   FA           MOV     R2,A
   \   000111   EF           MOV     A,R7
   \   000112   FB           MOV     R3,A
   \   000113   12....       LCALL   ??MT_ZdoUnbindRequest?relay
    282                break;
   \   000116   8030         SJMP    ??MT_ZdoCommandProcessing_21
    283          #endif
    284          
    285          #if defined ( MT_SYS_KEY_MANAGEMENT )
    286              case MT_ZDO_SET_LINK_KEY:
    287                MT_ZdoSetLinkKey(pBuf);
    288                break;
    289          
    290              case MT_ZDO_REMOVE_LINK_KEY:
    291                MT_ZdoRemoveLinkKey(pBuf);
    292                break;
    293          
    294              case MT_ZDO_GET_LINK_KEY:
    295                MT_ZdoGetLinkKey(pBuf);
    296                break;
    297          #endif // MT_SYS_KEY_MANAGEMENT
    298          
    299          #if defined ( ZDO_MANUAL_JOIN )
    300              case MT_ZDO_NWK_DISCOVERY_REQ:
    301                MT_ZdoNetworkDiscoveryReq(pBuf);
   \                     ??MT_ZdoCommandProcessing_15:
   \   000118                ; Setup parameters for call to function MT_ZdoNetworkDiscoveryReq
   \   000118   EE           MOV     A,R6
   \   000119   FA           MOV     R2,A
   \   00011A   EF           MOV     A,R7
   \   00011B   FB           MOV     R3,A
   \   00011C   12....       LCALL   ??MT_ZdoNetworkDiscoveryReq?relay
    302                break;
   \   00011F   8027         SJMP    ??MT_ZdoCommandProcessing_21
    303          
    304              case MT_ZDO_JOIN_REQ:
    305                MT_ZdoJoinReq(pBuf);
   \                     ??MT_ZdoCommandProcessing_16:
   \   000121                ; Setup parameters for call to function MT_ZdoJoinReq
   \   000121   EE           MOV     A,R6
   \   000122   FA           MOV     R2,A
   \   000123   EF           MOV     A,R7
   \   000124   FB           MOV     R3,A
   \   000125   12....       LCALL   ??MT_ZdoJoinReq?relay
    306                break;
   \   000128   801E         SJMP    ??MT_ZdoCommandProcessing_21
    307          #endif
    308          
    309          #if defined ( ZDO_MGMT_NWKDISC_REQUEST )
    310              case MT_ZDO_MGMT_NWKDISC_REQ:
    311                MT_ZdoMgmtNwkDiscRequest(pBuf);
    312                break;
    313          #endif
    314          
    315          #if defined ( ZDO_MGMT_LQI_REQUEST )
    316              case MT_ZDO_MGMT_LQI_REQ:
    317                MT_ZdoMgmtLqiRequest(pBuf);
    318                break;
    319          #endif
    320          
    321          #if defined ( ZDO_MGMT_RTG_REQUEST )
    322              case MT_ZDO_MGMT_RTG_REQ:
    323                MT_ZdoMgmtRtgRequest(pBuf);
    324                break;
    325          #endif
    326          
    327          #if defined ( ZDO_MGMT_BIND_REQUEST )
    328              case MT_ZDO_MGMT_BIND_REQ:
    329                MT_ZdoMgmtBindRequest(pBuf);
    330                break;
    331          #endif
    332          
    333          #if defined ( ZDO_MGMT_LEAVE_REQUEST )
    334              case MT_ZDO_MGMT_LEAVE_REQ:
    335                MT_ZdoMgmtLeaveRequest(pBuf);
    336                break;
    337          #endif
    338          
    339          #if defined ( ZDO_MGMT_JOINDIRECT_REQUEST )
    340              case MT_ZDO_MGMT_DIRECT_JOIN_REQ:
    341                MT_ZdoMgmtDirectJoinRequest(pBuf);
    342                break;
    343          #endif
    344          
    345          #if defined ( ZDO_MGMT_PERMIT_JOIN_REQUEST )
    346              case MT_ZDO_MGMT_PERMIT_JOIN_REQ:
    347                MT_ZdoMgmtPermitJoinRequest(pBuf);
    348                break;
    349          #endif
    350          
    351          #if defined ( ZDO_MGMT_NWKUPDATE_REQUEST )
    352              case MT_ZDO_MGMT_NWK_UPDATE_REQ:
    353                MT_ZdoMgmtNwkUpdateRequest(pBuf);
    354                break;
    355          #endif
    356          
    357          #if defined ( ZDO_NETWORKSTART_REQUEST )
    358              case MT_ZDO_STARTUP_FROM_APP:
    359                MT_ZdoStartupFromApp(pBuf);
   \                     ??MT_ZdoCommandProcessing_19:
   \   00012A                ; Setup parameters for call to function MT_ZdoStartupFromApp
   \   00012A   EE           MOV     A,R6
   \   00012B   FA           MOV     R2,A
   \   00012C   EF           MOV     A,R7
   \   00012D   FB           MOV     R3,A
   \   00012E   12....       LCALL   ??MT_ZdoStartupFromApp?relay
    360                break;
   \   000131   8015         SJMP    ??MT_ZdoCommandProcessing_21
    361          #endif
    362          
    363              case MT_ZDO_MSG_CB_REGISTER:
    364                MT_ZdoRegisterForZDOMsg(pBuf);
   \                     ??MT_ZdoCommandProcessing_17:
   \   000133                ; Setup parameters for call to function MT_ZdoRegisterForZDOMsg
   \   000133   EE           MOV     A,R6
   \   000134   FA           MOV     R2,A
   \   000135   EF           MOV     A,R7
   \   000136   FB           MOV     R3,A
   \   000137   12....       LCALL   ??MT_ZdoRegisterForZDOMsg?relay
    365                break;
   \   00013A   800C         SJMP    ??MT_ZdoCommandProcessing_21
    366          
    367              case MT_ZDO_MSG_CB_REMOVE:
    368                MT_ZdoRemoveRegisteredCB(pBuf);
   \                     ??MT_ZdoCommandProcessing_18:
   \   00013C                ; Setup parameters for call to function MT_ZdoRemoveRegisteredCB
   \   00013C   EE           MOV     A,R6
   \   00013D   FA           MOV     R2,A
   \   00013E   EF           MOV     A,R7
   \   00013F   FB           MOV     R3,A
   \   000140   12....       LCALL   ??MT_ZdoRemoveRegisteredCB?relay
    369                break;
   \   000143   8003         SJMP    ??MT_ZdoCommandProcessing_21
    370          
    371              default:
    372                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_ZdoCommandProcessing_20:
   \   000145   75..02       MOV     ?V0 + 0,#0x2
    373                break;
    374            }
    375          
    376            return status;
   \                     ??MT_ZdoCommandProcessing_21:
   \   000148   A9..         MOV     R1,?V0 + 0
   \   00014A   7F01         MOV     R7,#0x1
   \   00014C   02....       LJMP    ?BANKED_LEAVE_XDATA
    377          }
    378          
    379          /***************************************************************************************************
    380           * @fn      MT_ZdoNwkAddrReq
    381           *
    382           * @brief   Handle a nwk address request.
    383           *
    384           * @param   pData  - MT message data
    385           *
    386           * @return  void
    387           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    388          void MT_ZdoNWKAddressRequest(uint8 *pBuf)
   \                     MT_ZdoNWKAddressRequest:
    389          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    390            uint8 cmdId;
    391            uint8 retValue;
    392            uint8 reqType;
    393            uint8 startIndex;
    394            uint8 *pExtAddr;
    395          
    396            /* parse header */
    397            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 4,A
    398            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    399          
    400            /* parse parameters */
    401            pExtAddr = pBuf;
   \   00001F   8E..         MOV     ?V0 + 2,R6
   \   000021   8F..         MOV     ?V0 + 3,R7
    402            pBuf += Z_EXTADDR_LEN;
   \   000023   EE           MOV     A,R6
   \   000024   2408         ADD     A,#0x8
   \   000026   FE           MOV     R6,A
   \   000027   EF           MOV     A,R7
   \   000028   3400         ADDC    A,#0x0
   \   00002A   FF           MOV     R7,A
    403          
    404            /* Request type */
    405            reqType = *pBuf++;
   \   00002B   8E82         MOV     DPL,R6
   \   00002D   8F83         MOV     DPH,R7
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F5..         MOV     ?V0 + 0,A
   \   000032   8E82         MOV     DPL,R6
   \   000034   8F83         MOV     DPH,R7
   \   000036   A3           INC     DPTR
   \   000037   AE82         MOV     R6,DPL
   \   000039   AF83         MOV     R7,DPH
    406          
    407            /* Start index */
    408            startIndex = *pBuf;
   \   00003B   8E82         MOV     DPL,R6
   \   00003D   8F83         MOV     DPH,R7
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F5..         MOV     ?V0 + 1,A
    409          
    410            retValue = (uint8)ZDP_NwkAddrReq(pExtAddr, reqType, startIndex, 0);
   \   000042                ; Setup parameters for call to function ZDP_NwkAddrReq
   \   000042   7D00         MOV     R5,#0x0
   \   000044   AC..         MOV     R4,?V0 + 1
   \   000046   A9..         MOV     R1,?V0 + 0
   \   000048   AA..         MOV     R2,?V0 + 2
   \   00004A   AB..         MOV     R3,?V0 + 3
   \   00004C   12....       LCALL   ??ZDP_NwkAddrReq?relay
   \   00004F   E9           MOV     A,R1
   \   000050   85..82       MOV     DPL,?XSP + 0
   \   000053   85..83       MOV     DPH,?XSP + 1
   \   000056   F0           MOVX    @DPTR,A
    411          
    412            /* Build and send back the response */
    413            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000057                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000057   85..82       MOV     DPL,?XSP + 0
   \   00005A   85..83       MOV     DPH,?XSP + 1
   \   00005D   AC82         MOV     R4,DPL
   \   00005F   AD83         MOV     R5,DPH
   \   000061   7B01         MOV     R3,#0x1
   \   000063   AA..         MOV     R2,?V0 + 4
   \   000065   7965         MOV     R1,#0x65
   \   000067   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    414          }
   \   00006A   7401         MOV     A,#0x1
   \   00006C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006F   7F05         MOV     R7,#0x5
   \   000071   02....       LJMP    ?BANKED_LEAVE_XDATA
    415          
    416          /***************************************************************************************************
    417           * @fn      MT_ZdoIEEEAddrRequest
    418           *
    419           * @brief   Handle a IEEE address request.
    420           *
    421           * @param   pData  - MT message data
    422           *
    423           * @return  void
    424           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    425          void MT_ZdoIEEEAddrRequest (uint8 *pBuf)
   \                     MT_ZdoIEEEAddrRequest:
    426          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    427            uint8 cmdId;
    428            uint8 retValue;
    429            uint16 shortAddr;
    430            uint8 reqType;
    431            uint8 startIndex;
    432          
    433            /* parse header */
    434            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 4,A
    435            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    436          
    437            /* Dev address */
    438            shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00001F   8E82         MOV     DPL,R6
   \   000021   8F83         MOV     DPH,R7
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   7B00         MOV     R3,#0x0
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F8           MOV     R0,A
   \   00002E   7900         MOV     R1,#0x0
   \   000030   E4           CLR     A
   \   000031   C8           XCH     A,R0
   \   000032   F9           MOV     R1,A
   \   000033   EA           MOV     A,R2
   \   000034   28           ADD     A,R0
   \   000035   F8           MOV     R0,A
   \   000036   EB           MOV     A,R3
   \   000037   39           ADDC    A,R1
   \   000038   F9           MOV     R1,A
   \   000039   88..         MOV     ?V0 + 2,R0
   \   00003B   89..         MOV     ?V0 + 3,R1
    439            pBuf += 2;
   \   00003D   EE           MOV     A,R6
   \   00003E   2402         ADD     A,#0x2
   \   000040   FE           MOV     R6,A
   \   000041   EF           MOV     A,R7
   \   000042   3400         ADDC    A,#0x0
   \   000044   FF           MOV     R7,A
    440          
    441            /* request type */
    442            reqType = *pBuf++;
   \   000045   8E82         MOV     DPL,R6
   \   000047   8F83         MOV     DPH,R7
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F5..         MOV     ?V0 + 0,A
   \   00004C   8E82         MOV     DPL,R6
   \   00004E   8F83         MOV     DPH,R7
   \   000050   A3           INC     DPTR
   \   000051   AE82         MOV     R6,DPL
   \   000053   AF83         MOV     R7,DPH
    443          
    444            /* start index */
    445            startIndex = *pBuf;
   \   000055   8E82         MOV     DPL,R6
   \   000057   8F83         MOV     DPH,R7
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F5..         MOV     ?V0 + 1,A
    446          
    447            retValue = (uint8)ZDP_IEEEAddrReq(shortAddr, reqType, startIndex, 0);
   \   00005C                ; Setup parameters for call to function ZDP_IEEEAddrReq
   \   00005C   7D00         MOV     R5,#0x0
   \   00005E   AC..         MOV     R4,?V0 + 1
   \   000060   A9..         MOV     R1,?V0 + 0
   \   000062   AA..         MOV     R2,?V0 + 2
   \   000064   AB..         MOV     R3,?V0 + 3
   \   000066   12....       LCALL   ??ZDP_IEEEAddrReq?relay
   \   000069   E9           MOV     A,R1
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   F0           MOVX    @DPTR,A
    448          
    449            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000071                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000071   85..82       MOV     DPL,?XSP + 0
   \   000074   85..83       MOV     DPH,?XSP + 1
   \   000077   AC82         MOV     R4,DPL
   \   000079   AD83         MOV     R5,DPH
   \   00007B   7B01         MOV     R3,#0x1
   \   00007D   AA..         MOV     R2,?V0 + 4
   \   00007F   7965         MOV     R1,#0x65
   \   000081   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    450          }
   \   000084   7401         MOV     A,#0x1
   \   000086   12....       LCALL   ?DEALLOC_XSTACK8
   \   000089   7F05         MOV     R7,#0x5
   \   00008B   02....       LJMP    ?BANKED_LEAVE_XDATA
    451          
    452          /***************************************************************************************************
    453           * @fn      MT_ZdoNodeDescRequest
    454           *
    455           * @brief   Handle a Node Descriptor request.
    456           *
    457           * @param   pData  - MT message data
    458           *
    459           * @return  void
    460           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    461          void MT_ZdoNodeDescRequest (uint8 *pBuf)
   \                     MT_ZdoNodeDescRequest:
    462          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    463            uint8 cmdId;
    464            uint8 retValue;
    465            zAddrType_t destAddr;
    466            uint16 shortAddr;
    467          
    468            /* parse header */
    469            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    470            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    471          
    472            /* Destination address */
    473            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    474            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    475            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    476          
    477            /* Network address of interest */
    478            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    479            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    480          
    481            retValue = (uint8)ZDP_NodeDescReq( &destAddr, shortAddr, 0);
   \   000079                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000079   75..00       MOV     ?V0 + 3,#0x0
   \   00007C   78..         MOV     R0,#?V0 + 3
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000081   7902         MOV     R1,#0x2
   \   000083   AC..         MOV     R4,?V0 + 0
   \   000085   AD..         MOV     R5,?V0 + 1
   \   000087   7402         MOV     A,#0x2
   \   000089   12....       LCALL   ?XSTACK_DISP0_8
   \   00008C   AA82         MOV     R2,DPL
   \   00008E   AB83         MOV     R3,DPH
   \   000090   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000093   7401         MOV     A,#0x1
   \   000095   12....       LCALL   ?DEALLOC_XSTACK8
   \   000098   E9           MOV     A,R1
   \   000099   85..82       MOV     DPL,?XSP + 0
   \   00009C   85..83       MOV     DPH,?XSP + 1
   \   00009F   F0           MOVX    @DPTR,A
    482          
    483            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000A0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000A0   85..82       MOV     DPL,?XSP + 0
   \   0000A3   85..83       MOV     DPH,?XSP + 1
   \   0000A6   AC82         MOV     R4,DPL
   \   0000A8   AD83         MOV     R5,DPH
   \   0000AA   7B01         MOV     R3,#0x1
   \   0000AC   AA..         MOV     R2,?V0 + 2
   \   0000AE   7965         MOV     R1,#0x65
   \   0000B0   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    484          }
   \   0000B3   740A         MOV     A,#0xa
   \   0000B5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B8   7F04         MOV     R7,#0x4
   \   0000BA   02....       LJMP    ?BANKED_LEAVE_XDATA
    485          
    486          /***************************************************************************************************
    487           * @fn      MT_ZdoPowerDescRequest
    488           *
    489           * @brief   Handle a Power Descriptor request.
    490           *
    491           * @param   pData  - MT message data
    492           *
    493           * @return  void
    494           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    495          void MT_ZdoPowerDescRequest(uint8 *pBuf)
   \                     MT_ZdoPowerDescRequest:
    496          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    497            uint8 cmdId;
    498            uint8 retValue;
    499            zAddrType_t destAddr;
    500            uint16 shortAddr;
    501          
    502            /* parse header */
    503            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    504            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    505          
    506            /* Dev address */
    507            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    508            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    509            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    510          
    511            /* Network address of interest */
    512            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    513            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    514          
    515            retValue = (uint8)ZDP_PowerDescReq( &destAddr, shortAddr, 0);
   \   000079                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000079   75..00       MOV     ?V0 + 3,#0x0
   \   00007C   78..         MOV     R0,#?V0 + 3
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000081   7903         MOV     R1,#0x3
   \   000083   AC..         MOV     R4,?V0 + 0
   \   000085   AD..         MOV     R5,?V0 + 1
   \   000087   7402         MOV     A,#0x2
   \   000089   12....       LCALL   ?XSTACK_DISP0_8
   \   00008C   AA82         MOV     R2,DPL
   \   00008E   AB83         MOV     R3,DPH
   \   000090   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000093   7401         MOV     A,#0x1
   \   000095   12....       LCALL   ?DEALLOC_XSTACK8
   \   000098   E9           MOV     A,R1
   \   000099   85..82       MOV     DPL,?XSP + 0
   \   00009C   85..83       MOV     DPH,?XSP + 1
   \   00009F   F0           MOVX    @DPTR,A
    516          
    517            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000A0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000A0   85..82       MOV     DPL,?XSP + 0
   \   0000A3   85..83       MOV     DPH,?XSP + 1
   \   0000A6   AC82         MOV     R4,DPL
   \   0000A8   AD83         MOV     R5,DPH
   \   0000AA   7B01         MOV     R3,#0x1
   \   0000AC   AA..         MOV     R2,?V0 + 2
   \   0000AE   7965         MOV     R1,#0x65
   \   0000B0   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    518          }
   \   0000B3   740A         MOV     A,#0xa
   \   0000B5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B8   7F04         MOV     R7,#0x4
   \   0000BA   02....       LJMP    ?BANKED_LEAVE_XDATA
    519          
    520          /***************************************************************************************************
    521           * @fn      MT_ZdoSimpleDescRequest
    522           *
    523           * @brief   Handle a Simple Descriptor request.
    524           *
    525           * @param   pBuf  - MT message data
    526           *
    527           * @return  void
    528           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    529          void MT_ZdoSimpleDescRequest(uint8 *pBuf)
   \                     MT_ZdoSimpleDescRequest:
    530          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    531            uint8 cmdId;
    532            uint8 retValue;
    533            uint8 epInt;
    534            zAddrType_t destAddr;
    535            uint16 shortAddr;
    536          
    537            /* parse header */
    538            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 3,A
    539            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    540          
    541            /* Dev address */
    542            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    543            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    544            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    545          
    546            /* Network address of interest */
    547            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    548            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    549          
    550            /* endpoint/interface */
    551            epInt = *pBuf++;
   \   000079   8E82         MOV     DPL,R6
   \   00007B   8F83         MOV     DPH,R7
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   F5..         MOV     ?V0 + 2,A
   \   000080   8E82         MOV     DPL,R6
   \   000082   8F83         MOV     DPH,R7
   \   000084   A3           INC     DPTR
   \   000085   AE82         MOV     R6,DPL
   \   000087   AF83         MOV     R7,DPH
    552          
    553            retValue = (uint8)ZDP_SimpleDescReq( &destAddr, shortAddr, epInt, 0);
   \   000089                ; Setup parameters for call to function ZDP_SimpleDescReq
   \   000089   75..00       MOV     ?V0 + 4,#0x0
   \   00008C   78..         MOV     R0,#?V0 + 4
   \   00008E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000091   A9..         MOV     R1,?V0 + 2
   \   000093   AC..         MOV     R4,?V0 + 0
   \   000095   AD..         MOV     R5,?V0 + 1
   \   000097   7402         MOV     A,#0x2
   \   000099   12....       LCALL   ?XSTACK_DISP0_8
   \   00009C   AA82         MOV     R2,DPL
   \   00009E   AB83         MOV     R3,DPH
   \   0000A0   12....       LCALL   ??ZDP_SimpleDescReq?relay
   \   0000A3   7401         MOV     A,#0x1
   \   0000A5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A8   E9           MOV     A,R1
   \   0000A9   85..82       MOV     DPL,?XSP + 0
   \   0000AC   85..83       MOV     DPH,?XSP + 1
   \   0000AF   F0           MOVX    @DPTR,A
    554          
    555            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000B0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000B0   85..82       MOV     DPL,?XSP + 0
   \   0000B3   85..83       MOV     DPH,?XSP + 1
   \   0000B6   AC82         MOV     R4,DPL
   \   0000B8   AD83         MOV     R5,DPH
   \   0000BA   7B01         MOV     R3,#0x1
   \   0000BC   AA..         MOV     R2,?V0 + 3
   \   0000BE   7965         MOV     R1,#0x65
   \   0000C0   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    556          }
   \   0000C3   740A         MOV     A,#0xa
   \   0000C5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C8   7F05         MOV     R7,#0x5
   \   0000CA   02....       LJMP    ?BANKED_LEAVE_XDATA
    557          
    558          /***************************************************************************************************
    559           * @fn      MT_ZdoActiveEpRequest
    560           *
    561           * @brief   Handle a Active EP request.
    562           *
    563           * @param   pBuf  - MT message data
    564           *
    565           * @return  void
    566           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    567          void MT_ZdoActiveEpRequest(uint8 *pBuf)
   \                     MT_ZdoActiveEpRequest:
    568          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    569            uint8 cmdId;
    570            uint8 retValue;
    571            zAddrType_t destAddr;
    572            uint16 shortAddr;
    573          
    574            /* parse header */
    575            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    576            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    577          
    578            /* Dev address */
    579            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    580            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    581            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    582          
    583            /* Network address of interest */
    584            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    585            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    586          
    587            retValue = (uint8)ZDP_ActiveEPReq( &destAddr, shortAddr, 0);
   \   000079                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000079   75..00       MOV     ?V0 + 3,#0x0
   \   00007C   78..         MOV     R0,#?V0 + 3
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000081   7905         MOV     R1,#0x5
   \   000083   AC..         MOV     R4,?V0 + 0
   \   000085   AD..         MOV     R5,?V0 + 1
   \   000087   7402         MOV     A,#0x2
   \   000089   12....       LCALL   ?XSTACK_DISP0_8
   \   00008C   AA82         MOV     R2,DPL
   \   00008E   AB83         MOV     R3,DPH
   \   000090   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000093   7401         MOV     A,#0x1
   \   000095   12....       LCALL   ?DEALLOC_XSTACK8
   \   000098   E9           MOV     A,R1
   \   000099   85..82       MOV     DPL,?XSP + 0
   \   00009C   85..83       MOV     DPH,?XSP + 1
   \   00009F   F0           MOVX    @DPTR,A
    588          
    589            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000A0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000A0   85..82       MOV     DPL,?XSP + 0
   \   0000A3   85..83       MOV     DPH,?XSP + 1
   \   0000A6   AC82         MOV     R4,DPL
   \   0000A8   AD83         MOV     R5,DPH
   \   0000AA   7B01         MOV     R3,#0x1
   \   0000AC   AA..         MOV     R2,?V0 + 2
   \   0000AE   7965         MOV     R1,#0x65
   \   0000B0   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    590          }
   \   0000B3   740A         MOV     A,#0xa
   \   0000B5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B8   7F04         MOV     R7,#0x4
   \   0000BA   02....       LJMP    ?BANKED_LEAVE_XDATA
    591          
    592          /***************************************************************************************************
    593           * @fn      MT_ZdoMatchDescRequest
    594           *
    595           * @brief   Handle a Match Descriptor request.
    596           *
    597           * @param   pBuf  - MT message data
    598           *
    599           * @return  void
    600           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    601          void MT_ZdoMatchDescRequest(uint8 *pBuf)
   \                     MT_ZdoMatchDescRequest:
    602          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 74
   \   000005   74B6         MOV     A,#-0x4a
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    603            uint8 cmdId;
    604            uint8 retValue = 0;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7400         MOV     A,#0x0
   \   000016   F0           MOVX    @DPTR,A
    605            uint8 i, numInClusters, numOutClusters;
    606            uint16 profileId;
    607            zAddrType_t destAddr;
    608            uint16 shortAddr;
    609            uint16 inClusters[MTZDO_MAX_MATCH_CLUSTERS], outClusters[MTZDO_MAX_MATCH_CLUSTERS];
    610          
    611            /* parse header */
    612            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   8E82         MOV     DPL,R6
   \   000019   8F83         MOV     DPH,R7
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 5,A
    613            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000020   EE           MOV     A,R6
   \   000021   2403         ADD     A,#0x3
   \   000023   FE           MOV     R6,A
   \   000024   EF           MOV     A,R7
   \   000025   3400         ADDC    A,#0x0
   \   000027   FF           MOV     R7,A
    614          
    615            /* Dev address */
    616            destAddr.addrMode = Addr16Bit;
   \   000028   7409         MOV     A,#0x9
   \   00002A   12....       LCALL   ?XSTACK_DISP0_8
   \   00002D   7402         MOV     A,#0x2
   \   00002F   F0           MOVX    @DPTR,A
    617            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FA           MOV     R2,A
   \   000036   7B00         MOV     R3,#0x0
   \   000038   8E82         MOV     DPL,R6
   \   00003A   8F83         MOV     DPH,R7
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   F8           MOV     R0,A
   \   00003F   7900         MOV     R1,#0x0
   \   000041   E4           CLR     A
   \   000042   C8           XCH     A,R0
   \   000043   F9           MOV     R1,A
   \   000044   EA           MOV     A,R2
   \   000045   28           ADD     A,R0
   \   000046   F8           MOV     R0,A
   \   000047   EB           MOV     A,R3
   \   000048   39           ADDC    A,R1
   \   000049   F9           MOV     R1,A
   \   00004A   7401         MOV     A,#0x1
   \   00004C   12....       LCALL   ?XSTACK_DISP0_8
   \   00004F   E8           MOV     A,R0
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   E9           MOV     A,R1
   \   000053   F0           MOVX    @DPTR,A
    618            pBuf += 2;
   \   000054   EE           MOV     A,R6
   \   000055   2402         ADD     A,#0x2
   \   000057   FE           MOV     R6,A
   \   000058   EF           MOV     A,R7
   \   000059   3400         ADDC    A,#0x0
   \   00005B   FF           MOV     R7,A
    619          
    620            /* Network address of interest */
    621            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   00005C   8E82         MOV     DPL,R6
   \   00005E   8F83         MOV     DPH,R7
   \   000060   E0           MOVX    A,@DPTR
   \   000061   FA           MOV     R2,A
   \   000062   7B00         MOV     R3,#0x0
   \   000064   8E82         MOV     DPL,R6
   \   000066   8F83         MOV     DPH,R7
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F8           MOV     R0,A
   \   00006B   7900         MOV     R1,#0x0
   \   00006D   E4           CLR     A
   \   00006E   C8           XCH     A,R0
   \   00006F   F9           MOV     R1,A
   \   000070   EA           MOV     A,R2
   \   000071   28           ADD     A,R0
   \   000072   F8           MOV     R0,A
   \   000073   EB           MOV     A,R3
   \   000074   39           ADDC    A,R1
   \   000075   F9           MOV     R1,A
   \   000076   88..         MOV     ?V0 + 0,R0
   \   000078   89..         MOV     ?V0 + 1,R1
    622            pBuf += 2;
   \   00007A   EE           MOV     A,R6
   \   00007B   2402         ADD     A,#0x2
   \   00007D   FE           MOV     R6,A
   \   00007E   EF           MOV     A,R7
   \   00007F   3400         ADDC    A,#0x0
   \   000081   FF           MOV     R7,A
    623          
    624            /* Profile ID */
    625            profileId = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000082   8E82         MOV     DPL,R6
   \   000084   8F83         MOV     DPH,R7
   \   000086   E0           MOVX    A,@DPTR
   \   000087   FA           MOV     R2,A
   \   000088   7B00         MOV     R3,#0x0
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   A3           INC     DPTR
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   F8           MOV     R0,A
   \   000091   7900         MOV     R1,#0x0
   \   000093   E4           CLR     A
   \   000094   C8           XCH     A,R0
   \   000095   F9           MOV     R1,A
   \   000096   EA           MOV     A,R2
   \   000097   28           ADD     A,R0
   \   000098   F8           MOV     R0,A
   \   000099   EB           MOV     A,R3
   \   00009A   39           ADDC    A,R1
   \   00009B   F9           MOV     R1,A
   \   00009C   88..         MOV     ?V0 + 6,R0
   \   00009E   89..         MOV     ?V0 + 7,R1
    626            pBuf += 2;
   \   0000A0   EE           MOV     A,R6
   \   0000A1   2402         ADD     A,#0x2
   \   0000A3   FE           MOV     R6,A
   \   0000A4   EF           MOV     A,R7
   \   0000A5   3400         ADDC    A,#0x0
   \   0000A7   FF           MOV     R7,A
    627          
    628            /* NumInClusters */
    629            numInClusters = *pBuf++;
   \   0000A8   8E82         MOV     DPL,R6
   \   0000AA   8F83         MOV     DPH,R7
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   F5..         MOV     ?V0 + 3,A
   \   0000AF   8E82         MOV     DPL,R6
   \   0000B1   8F83         MOV     DPH,R7
   \   0000B3   A3           INC     DPTR
   \   0000B4   AE82         MOV     R6,DPL
   \   0000B6   AF83         MOV     R7,DPH
    630            if ( numInClusters <= MTZDO_MAX_MATCH_CLUSTERS )
   \   0000B8   E5..         MOV     A,?V0 + 3
   \   0000BA   C3           CLR     C
   \   0000BB   9411         SUBB    A,#0x11
   \   0000BD   505F         JNC     ??MT_ZdoMatchDescRequest_0
    631            {
    632              /* IN clusters */
    633              for ( i = 0; i < numInClusters; i++ )
   \   0000BF   75..00       MOV     ?V0 + 2,#0x0
   \                     ??MT_ZdoMatchDescRequest_1:
   \   0000C2   E5..         MOV     A,?V0 + 2
   \   0000C4   C3           CLR     C
   \   0000C5   95..         SUBB    A,?V0 + 3
   \   0000C7   505E         JNC     ??MT_ZdoMatchDescRequest_2
    634              {
    635                inClusters[i] = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   0000C9   8E82         MOV     DPL,R6
   \   0000CB   8F83         MOV     DPH,R7
   \   0000CD   E0           MOVX    A,@DPTR
   \   0000CE   FA           MOV     R2,A
   \   0000CF   7B00         MOV     R3,#0x0
   \   0000D1   8E82         MOV     DPL,R6
   \   0000D3   8F83         MOV     DPH,R7
   \   0000D5   A3           INC     DPTR
   \   0000D6   E0           MOVX    A,@DPTR
   \   0000D7   F8           MOV     R0,A
   \   0000D8   7900         MOV     R1,#0x0
   \   0000DA   E4           CLR     A
   \   0000DB   C8           XCH     A,R0
   \   0000DC   F9           MOV     R1,A
   \   0000DD   EA           MOV     A,R2
   \   0000DE   28           ADD     A,R0
   \   0000DF   FA           MOV     R2,A
   \   0000E0   EB           MOV     A,R3
   \   0000E1   39           ADDC    A,R1
   \   0000E2   FB           MOV     R3,A
   \   0000E3   E5..         MOV     A,?V0 + 2
   \   0000E5   A8..         MOV     R0,?V0 + 2
   \   0000E7   7900         MOV     R1,#0x0
   \   0000E9   E8           MOV     A,R0
   \   0000EA   75F002       MOV     B,#0x2
   \   0000ED   A4           MUL     AB
   \   0000EE   C8           XCH     A,R0
   \   0000EF   ACF0         MOV     R4,B
   \   0000F1   75F000       MOV     B,#0x0
   \   0000F4   A4           MUL     AB
   \   0000F5   2C           ADD     A,R4
   \   0000F6   FC           MOV     R4,A
   \   0000F7   75F002       MOV     B,#0x2
   \   0000FA   E9           MOV     A,R1
   \   0000FB   A4           MUL     AB
   \   0000FC   2C           ADD     A,R4
   \   0000FD   F9           MOV     R1,A
   \   0000FE   742A         MOV     A,#0x2a
   \   000100   12....       LCALL   ?XSTACK_DISP0_8
   \   000103   E582         MOV     A,DPL
   \   000105   28           ADD     A,R0
   \   000106   F582         MOV     DPL,A
   \   000108   E583         MOV     A,DPH
   \   00010A   39           ADDC    A,R1
   \   00010B   F583         MOV     DPH,A
   \   00010D   EA           MOV     A,R2
   \   00010E   F0           MOVX    @DPTR,A
   \   00010F   A3           INC     DPTR
   \   000110   EB           MOV     A,R3
   \   000111   F0           MOVX    @DPTR,A
    636                pBuf += 2;
   \   000112   EE           MOV     A,R6
   \   000113   2402         ADD     A,#0x2
   \   000115   FE           MOV     R6,A
   \   000116   EF           MOV     A,R7
   \   000117   3400         ADDC    A,#0x0
   \   000119   FF           MOV     R7,A
    637              }
   \   00011A   05..         INC     ?V0 + 2
   \   00011C   80A4         SJMP    ??MT_ZdoMatchDescRequest_1
    638            }
    639            else
    640            {
    641              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoMatchDescRequest_0:
   \   00011E   85..82       MOV     DPL,?XSP + 0
   \   000121   85..83       MOV     DPH,?XSP + 1
   \   000124   7480         MOV     A,#-0x80
   \   000126   F0           MOVX    @DPTR,A
    642            }
    643          
    644            /* NumOutClusters */
    645            numOutClusters = *pBuf++;
   \                     ??MT_ZdoMatchDescRequest_2:
   \   000127   8E82         MOV     DPL,R6
   \   000129   8F83         MOV     DPH,R7
   \   00012B   E0           MOVX    A,@DPTR
   \   00012C   F5..         MOV     ?V0 + 4,A
   \   00012E   8E82         MOV     DPL,R6
   \   000130   8F83         MOV     DPH,R7
   \   000132   A3           INC     DPTR
   \   000133   AE82         MOV     R6,DPL
   \   000135   AF83         MOV     R7,DPH
    646            if ( numOutClusters <= MTZDO_MAX_MATCH_CLUSTERS )
   \   000137   E5..         MOV     A,?V0 + 4
   \   000139   C3           CLR     C
   \   00013A   9411         SUBB    A,#0x11
   \   00013C   505F         JNC     ??MT_ZdoMatchDescRequest_3
    647            {
    648              /* OUT Clusters */
    649              for ( i = 0; i < numOutClusters; i++ )
   \   00013E   75..00       MOV     ?V0 + 2,#0x0
   \                     ??MT_ZdoMatchDescRequest_4:
   \   000141   E5..         MOV     A,?V0 + 2
   \   000143   C3           CLR     C
   \   000144   95..         SUBB    A,?V0 + 4
   \   000146   505E         JNC     ??MT_ZdoMatchDescRequest_5
    650              {
    651                outClusters[i] = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   000148   8E82         MOV     DPL,R6
   \   00014A   8F83         MOV     DPH,R7
   \   00014C   E0           MOVX    A,@DPTR
   \   00014D   FA           MOV     R2,A
   \   00014E   7B00         MOV     R3,#0x0
   \   000150   8E82         MOV     DPL,R6
   \   000152   8F83         MOV     DPH,R7
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F8           MOV     R0,A
   \   000157   7900         MOV     R1,#0x0
   \   000159   E4           CLR     A
   \   00015A   C8           XCH     A,R0
   \   00015B   F9           MOV     R1,A
   \   00015C   EA           MOV     A,R2
   \   00015D   28           ADD     A,R0
   \   00015E   FA           MOV     R2,A
   \   00015F   EB           MOV     A,R3
   \   000160   39           ADDC    A,R1
   \   000161   FB           MOV     R3,A
   \   000162   E5..         MOV     A,?V0 + 2
   \   000164   A8..         MOV     R0,?V0 + 2
   \   000166   7900         MOV     R1,#0x0
   \   000168   E8           MOV     A,R0
   \   000169   75F002       MOV     B,#0x2
   \   00016C   A4           MUL     AB
   \   00016D   C8           XCH     A,R0
   \   00016E   ACF0         MOV     R4,B
   \   000170   75F000       MOV     B,#0x0
   \   000173   A4           MUL     AB
   \   000174   2C           ADD     A,R4
   \   000175   FC           MOV     R4,A
   \   000176   75F002       MOV     B,#0x2
   \   000179   E9           MOV     A,R1
   \   00017A   A4           MUL     AB
   \   00017B   2C           ADD     A,R4
   \   00017C   F9           MOV     R1,A
   \   00017D   740A         MOV     A,#0xa
   \   00017F   12....       LCALL   ?XSTACK_DISP0_8
   \   000182   E582         MOV     A,DPL
   \   000184   28           ADD     A,R0
   \   000185   F582         MOV     DPL,A
   \   000187   E583         MOV     A,DPH
   \   000189   39           ADDC    A,R1
   \   00018A   F583         MOV     DPH,A
   \   00018C   EA           MOV     A,R2
   \   00018D   F0           MOVX    @DPTR,A
   \   00018E   A3           INC     DPTR
   \   00018F   EB           MOV     A,R3
   \   000190   F0           MOVX    @DPTR,A
    652                pBuf += 2;
   \   000191   EE           MOV     A,R6
   \   000192   2402         ADD     A,#0x2
   \   000194   FE           MOV     R6,A
   \   000195   EF           MOV     A,R7
   \   000196   3400         ADDC    A,#0x0
   \   000198   FF           MOV     R7,A
    653              }
   \   000199   05..         INC     ?V0 + 2
   \   00019B   80A4         SJMP    ??MT_ZdoMatchDescRequest_4
    654            }
    655            else
    656            {
    657              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoMatchDescRequest_3:
   \   00019D   85..82       MOV     DPL,?XSP + 0
   \   0001A0   85..83       MOV     DPH,?XSP + 1
   \   0001A3   7480         MOV     A,#-0x80
   \   0001A5   F0           MOVX    @DPTR,A
    658            }
    659          
    660            if ( retValue == 0 )
   \                     ??MT_ZdoMatchDescRequest_5:
   \   0001A6   85..82       MOV     DPL,?XSP + 0
   \   0001A9   85..83       MOV     DPH,?XSP + 1
   \   0001AC   E0           MOVX    A,@DPTR
   \   0001AD   7055         JNZ     ??MT_ZdoMatchDescRequest_6
    661            {
    662              retValue = (uint8)ZDP_MatchDescReq( &destAddr, shortAddr, profileId, numInClusters,
    663                                                 inClusters, numOutClusters, outClusters, 0);
   \   0001AF                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0001AF   75..00       MOV     ?V0 + 8,#0x0
   \   0001B2   78..         MOV     R0,#?V0 + 8
   \   0001B4   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001B7   740B         MOV     A,#0xb
   \   0001B9   12....       LCALL   ?XSTACK_DISP0_8
   \   0001BC   8582..       MOV     ?V0 + 8,DPL
   \   0001BF   8583..       MOV     ?V0 + 9,DPH
   \   0001C2   78..         MOV     R0,#?V0 + 8
   \   0001C4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001C7   E5..         MOV     A,?V0 + 4
   \   0001C9   F5..         MOV     ?V0 + 8,A
   \   0001CB   78..         MOV     R0,#?V0 + 8
   \   0001CD   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001D0   742E         MOV     A,#0x2e
   \   0001D2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D5   8582..       MOV     ?V0 + 8,DPL
   \   0001D8   8583..       MOV     ?V0 + 9,DPH
   \   0001DB   78..         MOV     R0,#?V0 + 8
   \   0001DD   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001E0   78..         MOV     R0,#?V0 + 6
   \   0001E2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001E5   A9..         MOV     R1,?V0 + 3
   \   0001E7   AC..         MOV     R4,?V0 + 0
   \   0001E9   AD..         MOV     R5,?V0 + 1
   \   0001EB   7409         MOV     A,#0x9
   \   0001ED   12....       LCALL   ?XSTACK_DISP0_8
   \   0001F0   AA82         MOV     R2,DPL
   \   0001F2   AB83         MOV     R3,DPH
   \   0001F4   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0001F7   7408         MOV     A,#0x8
   \   0001F9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001FC   E9           MOV     A,R1
   \   0001FD   85..82       MOV     DPL,?XSP + 0
   \   000200   85..83       MOV     DPH,?XSP + 1
   \   000203   F0           MOVX    @DPTR,A
    664            }
    665          
    666            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \                     ??MT_ZdoMatchDescRequest_6:
   \   000204                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000204   85..82       MOV     DPL,?XSP + 0
   \   000207   85..83       MOV     DPH,?XSP + 1
   \   00020A   AC82         MOV     R4,DPL
   \   00020C   AD83         MOV     R5,DPH
   \   00020E   7B01         MOV     R3,#0x1
   \   000210   AA..         MOV     R2,?V0 + 5
   \   000212   7965         MOV     R1,#0x65
   \   000214   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    667          }
   \   000217   744A         MOV     A,#0x4a
   \   000219   12....       LCALL   ?DEALLOC_XSTACK8
   \   00021C   7F0A         MOV     R7,#0xa
   \   00021E   02....       LJMP    ?BANKED_LEAVE_XDATA
    668          
    669          /***************************************************************************************************
    670           * @fn      MT_ZdoComplexDescRequest
    671           *
    672           * @brief   Handle a Complex Descriptor request.
    673           *
    674           * @param   pBuf  - MT message data
    675           *
    676           * @return  void
    677           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    678          void MT_ZdoComplexDescRequest(uint8 *pBuf)
   \                     MT_ZdoComplexDescRequest:
    679          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    680            uint8 cmdId;
    681            uint8 retValue;
    682            zAddrType_t destAddr;
    683            uint16 shortAddr;
    684          
    685            /* parse header */
    686            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    687            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    688          
    689            /* Dev address */
    690            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    691            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    692            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    693          
    694            /* Network address of interest */
    695            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    696            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    697          
    698            retValue = (uint8)ZDP_ComplexDescReq( &destAddr, shortAddr, 0);
   \   000079                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000079   75..00       MOV     ?V0 + 3,#0x0
   \   00007C   78..         MOV     R0,#?V0 + 3
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000081   7910         MOV     R1,#0x10
   \   000083   AC..         MOV     R4,?V0 + 0
   \   000085   AD..         MOV     R5,?V0 + 1
   \   000087   7402         MOV     A,#0x2
   \   000089   12....       LCALL   ?XSTACK_DISP0_8
   \   00008C   AA82         MOV     R2,DPL
   \   00008E   AB83         MOV     R3,DPH
   \   000090   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000093   7401         MOV     A,#0x1
   \   000095   12....       LCALL   ?DEALLOC_XSTACK8
   \   000098   E9           MOV     A,R1
   \   000099   85..82       MOV     DPL,?XSP + 0
   \   00009C   85..83       MOV     DPH,?XSP + 1
   \   00009F   F0           MOVX    @DPTR,A
    699          
    700            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000A0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000A0   85..82       MOV     DPL,?XSP + 0
   \   0000A3   85..83       MOV     DPH,?XSP + 1
   \   0000A6   AC82         MOV     R4,DPL
   \   0000A8   AD83         MOV     R5,DPH
   \   0000AA   7B01         MOV     R3,#0x1
   \   0000AC   AA..         MOV     R2,?V0 + 2
   \   0000AE   7965         MOV     R1,#0x65
   \   0000B0   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    701          }
   \   0000B3   740A         MOV     A,#0xa
   \   0000B5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B8   7F04         MOV     R7,#0x4
   \   0000BA   02....       LJMP    ?BANKED_LEAVE_XDATA
    702          
    703          /***************************************************************************************************
    704           * @fn      MT_ZdoUserDescRequest
    705           *
    706           * @brief   Handle a User Descriptor request.
    707           *
    708           * @param   pBuf  - MT message data
    709           *
    710           * @return  void
    711           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    712          void MT_ZdoUserDescRequest(uint8 *pBuf)
   \                     MT_ZdoUserDescRequest:
    713          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    714            uint8 cmdId;
    715            uint8 retValue;
    716            zAddrType_t destAddr;
    717            uint16 shortAddr;
    718          
    719            /* parse header */
    720            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    721            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    722          
    723            /* Dev address */
    724            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    725            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    726            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    727          
    728            /* Network address of interest */
    729            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    730            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    731          
    732            retValue = (uint8)ZDP_UserDescReq( &destAddr, shortAddr, 0);
   \   000079                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000079   75..00       MOV     ?V0 + 3,#0x0
   \   00007C   78..         MOV     R0,#?V0 + 3
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000081   7911         MOV     R1,#0x11
   \   000083   AC..         MOV     R4,?V0 + 0
   \   000085   AD..         MOV     R5,?V0 + 1
   \   000087   7402         MOV     A,#0x2
   \   000089   12....       LCALL   ?XSTACK_DISP0_8
   \   00008C   AA82         MOV     R2,DPL
   \   00008E   AB83         MOV     R3,DPH
   \   000090   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000093   7401         MOV     A,#0x1
   \   000095   12....       LCALL   ?DEALLOC_XSTACK8
   \   000098   E9           MOV     A,R1
   \   000099   85..82       MOV     DPL,?XSP + 0
   \   00009C   85..83       MOV     DPH,?XSP + 1
   \   00009F   F0           MOVX    @DPTR,A
    733          
    734            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000A0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000A0   85..82       MOV     DPL,?XSP + 0
   \   0000A3   85..83       MOV     DPH,?XSP + 1
   \   0000A6   AC82         MOV     R4,DPL
   \   0000A8   AD83         MOV     R5,DPH
   \   0000AA   7B01         MOV     R3,#0x1
   \   0000AC   AA..         MOV     R2,?V0 + 2
   \   0000AE   7965         MOV     R1,#0x65
   \   0000B0   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    735          }
   \   0000B3   740A         MOV     A,#0xa
   \   0000B5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B8   7F04         MOV     R7,#0x4
   \   0000BA   02....       LJMP    ?BANKED_LEAVE_XDATA
    736          
    737          /***************************************************************************************************
    738           * @fn      MT_ZdoEndDevAnnce
    739           *
    740           * @brief   Handle a End Device Announce Descriptor request.
    741           *
    742           * @param   pBuf  - MT message data
    743           *
    744           * @return  void
    745           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    746          void MT_ZdoEndDevAnnce(uint8 *pBuf)
   \                     MT_ZdoEndDevAnnce:
    747          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    748            uint8 cmdId;
    749            uint8 retValue;
    750            uint16 shortAddr;
    751            uint8 *pIEEEAddr;
    752          
    753            /* parse header */
    754            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 4,A
    755            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    756          
    757            /* network address */
    758            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   00001F   8E82         MOV     DPL,R6
   \   000021   8F83         MOV     DPH,R7
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   7B00         MOV     R3,#0x0
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F8           MOV     R0,A
   \   00002E   7900         MOV     R1,#0x0
   \   000030   E4           CLR     A
   \   000031   C8           XCH     A,R0
   \   000032   F9           MOV     R1,A
   \   000033   EA           MOV     A,R2
   \   000034   28           ADD     A,R0
   \   000035   F8           MOV     R0,A
   \   000036   EB           MOV     A,R3
   \   000037   39           ADDC    A,R1
   \   000038   F9           MOV     R1,A
   \   000039   88..         MOV     ?V0 + 0,R0
   \   00003B   89..         MOV     ?V0 + 1,R1
    759            pBuf += 2;
   \   00003D   EE           MOV     A,R6
   \   00003E   2402         ADD     A,#0x2
   \   000040   FE           MOV     R6,A
   \   000041   EF           MOV     A,R7
   \   000042   3400         ADDC    A,#0x0
   \   000044   FF           MOV     R7,A
    760          
    761            /* extended address */
    762            pIEEEAddr = pBuf;
   \   000045   8E..         MOV     ?V0 + 2,R6
   \   000047   8F..         MOV     ?V0 + 3,R7
    763            pBuf += Z_EXTADDR_LEN;
   \   000049   EE           MOV     A,R6
   \   00004A   2408         ADD     A,#0x8
   \   00004C   FE           MOV     R6,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   FF           MOV     R7,A
    764          
    765            retValue = (uint8)ZDP_DeviceAnnce( shortAddr, pIEEEAddr, *pBuf, 0);
   \   000051                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000051   75..00       MOV     ?V0 + 5,#0x0
   \   000054   78..         MOV     R0,#?V0 + 5
   \   000056   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000059   8E82         MOV     DPL,R6
   \   00005B   8F83         MOV     DPH,R7
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   F9           MOV     R1,A
   \   00005F   AC..         MOV     R4,?V0 + 2
   \   000061   AD..         MOV     R5,?V0 + 3
   \   000063   AA..         MOV     R2,?V0 + 0
   \   000065   AB..         MOV     R3,?V0 + 1
   \   000067   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   00006A   7401         MOV     A,#0x1
   \   00006C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006F   E9           MOV     A,R1
   \   000070   85..82       MOV     DPL,?XSP + 0
   \   000073   85..83       MOV     DPH,?XSP + 1
   \   000076   F0           MOVX    @DPTR,A
    766          
    767            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000077                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000077   85..82       MOV     DPL,?XSP + 0
   \   00007A   85..83       MOV     DPH,?XSP + 1
   \   00007D   AC82         MOV     R4,DPL
   \   00007F   AD83         MOV     R5,DPH
   \   000081   7B01         MOV     R3,#0x1
   \   000083   AA..         MOV     R2,?V0 + 4
   \   000085   7965         MOV     R1,#0x65
   \   000087   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    768          }
   \   00008A   7401         MOV     A,#0x1
   \   00008C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008F   7F06         MOV     R7,#0x6
   \   000091   02....       LJMP    ?BANKED_LEAVE_XDATA
    769          
    770          /***************************************************************************************************
    771           * @fn      MT_ZdoUserDescSet
    772           *
    773           * @brief   Handle a User Descriptor Set.
    774           *
    775           * @param   pBuf  - MT message data
    776           *
    777           * @return  void
    778           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    779          void MT_ZdoUserDescSet(uint8 *pBuf)
   \                     MT_ZdoUserDescSet:
    780          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 27
   \   000005   74E5         MOV     A,#-0x1b
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    781            uint8 cmdId;
    782            uint8 retValue;
    783            zAddrType_t destAddr;
    784            uint16 shortAddr;
    785            UserDescriptorFormat_t userDesc;
    786          
    787            /* parse header */
    788            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    789            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    790          
    791            /* Dev address */
    792            destAddr.addrMode = Addr16Bit;
   \   00001F   7409         MOV     A,#0x9
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    793            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    794            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    795          
    796            /* Network address of interest */
    797            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000053   8E82         MOV     DPL,R6
   \   000055   8F83         MOV     DPH,R7
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   7B00         MOV     R3,#0x0
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 0,R0
   \   00006F   89..         MOV     ?V0 + 1,R1
    798            pBuf += 2;
   \   000071   EE           MOV     A,R6
   \   000072   2402         ADD     A,#0x2
   \   000074   FE           MOV     R6,A
   \   000075   EF           MOV     A,R7
   \   000076   3400         ADDC    A,#0x0
   \   000078   FF           MOV     R7,A
    799          
    800            /* User descriptor */
    801            userDesc.len = *pBuf++;
   \   000079   8E82         MOV     DPL,R6
   \   00007B   8F83         MOV     DPH,R7
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   C0E0         PUSH    A
   \   000080   740A         MOV     A,#0xa
   \   000082   12....       LCALL   ?XSTACK_DISP0_8
   \   000085   D0E0         POP     A
   \   000087   F0           MOVX    @DPTR,A
   \   000088   8E82         MOV     DPL,R6
   \   00008A   8F83         MOV     DPH,R7
   \   00008C   A3           INC     DPTR
   \   00008D   AE82         MOV     R6,DPL
   \   00008F   AF83         MOV     R7,DPH
    802            osal_memcpy( userDesc.desc, pBuf, userDesc.len );
   \   000091                ; Setup parameters for call to function osal_memcpy
   \   000091   8E..         MOV     ?V0 + 4,R6
   \   000093   8F..         MOV     ?V0 + 5,R7
   \   000095   75..00       MOV     ?V0 + 6,#0x0
   \   000098   78..         MOV     R0,#?V0 + 4
   \   00009A   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00009D   740D         MOV     A,#0xd
   \   00009F   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A2   E0           MOVX    A,@DPTR
   \   0000A3   FC           MOV     R4,A
   \   0000A4   7D00         MOV     R5,#0x0
   \   0000A6   740E         MOV     A,#0xe
   \   0000A8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AB   AA82         MOV     R2,DPL
   \   0000AD   AB83         MOV     R3,DPH
   \   0000AF   12....       LCALL   ??osal_memcpy?relay
   \   0000B2   7403         MOV     A,#0x3
   \   0000B4   12....       LCALL   ?DEALLOC_XSTACK8
    803            pBuf += 16;
   \   0000B7   EE           MOV     A,R6
   \   0000B8   2410         ADD     A,#0x10
   \   0000BA   FE           MOV     R6,A
   \   0000BB   EF           MOV     A,R7
   \   0000BC   3400         ADDC    A,#0x0
   \   0000BE   FF           MOV     R7,A
    804          
    805            retValue = (uint8)ZDP_UserDescSet( &destAddr, shortAddr, &userDesc, 0);
   \   0000BF                ; Setup parameters for call to function ZDP_UserDescSet
   \   0000BF   740A         MOV     A,#0xa
   \   0000C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C4   8582..       MOV     ?V0 + 4,DPL
   \   0000C7   8583..       MOV     ?V0 + 5,DPH
   \   0000CA   78..         MOV     R0,#?V0 + 4
   \   0000CC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CF   7900         MOV     R1,#0x0
   \   0000D1   AC..         MOV     R4,?V0 + 0
   \   0000D3   AD..         MOV     R5,?V0 + 1
   \   0000D5   7403         MOV     A,#0x3
   \   0000D7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DA   AA82         MOV     R2,DPL
   \   0000DC   AB83         MOV     R3,DPH
   \   0000DE   12....       LCALL   ??ZDP_UserDescSet?relay
   \   0000E1   7402         MOV     A,#0x2
   \   0000E3   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E6   E9           MOV     A,R1
   \   0000E7   85..82       MOV     DPL,?XSP + 0
   \   0000EA   85..83       MOV     DPH,?XSP + 1
   \   0000ED   F0           MOVX    @DPTR,A
    806          
    807            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000EE                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000EE   85..82       MOV     DPL,?XSP + 0
   \   0000F1   85..83       MOV     DPH,?XSP + 1
   \   0000F4   AC82         MOV     R4,DPL
   \   0000F6   AD83         MOV     R5,DPH
   \   0000F8   7B01         MOV     R3,#0x1
   \   0000FA   AA..         MOV     R2,?V0 + 2
   \   0000FC   7965         MOV     R1,#0x65
   \   0000FE   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    808          }
   \   000101   741B         MOV     A,#0x1b
   \   000103   12....       LCALL   ?DEALLOC_XSTACK8
   \   000106   7F07         MOV     R7,#0x7
   \   000108   02....       LJMP    ?BANKED_LEAVE_XDATA
    809          
    810          /***************************************************************************************************
    811           * @fn      MT_ZdoServiceDiscRequest
    812           *
    813           * @brief   Handle a Server Discovery request.
    814           *
    815           * @param   pBuf  - MT message data
    816           *
    817           * @return  void
    818           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    819          void MT_ZdoServiceDiscRequest(uint8 *pBuf)
   \                     MT_ZdoServiceDiscRequest:
    820          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    821            uint8 cmdId;
    822            uint8 retValue;
    823            uint16 serviceMask;
    824          
    825            /* parse header */
    826            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 2,A
    827            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    828          
    829            /* Service Mask */
    830            serviceMask = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   00001F   8E82         MOV     DPL,R6
   \   000021   8F83         MOV     DPH,R7
   \   000023   E0           MOVX    A,@DPTR
   \   000024   FA           MOV     R2,A
   \   000025   7B00         MOV     R3,#0x0
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F8           MOV     R0,A
   \   00002E   7900         MOV     R1,#0x0
   \   000030   E4           CLR     A
   \   000031   C8           XCH     A,R0
   \   000032   F9           MOV     R1,A
   \   000033   EA           MOV     A,R2
   \   000034   28           ADD     A,R0
   \   000035   F8           MOV     R0,A
   \   000036   EB           MOV     A,R3
   \   000037   39           ADDC    A,R1
   \   000038   F9           MOV     R1,A
   \   000039   88..         MOV     ?V0 + 0,R0
   \   00003B   89..         MOV     ?V0 + 1,R1
    831            pBuf += 2;
   \   00003D   EE           MOV     A,R6
   \   00003E   2402         ADD     A,#0x2
   \   000040   FE           MOV     R6,A
   \   000041   EF           MOV     A,R7
   \   000042   3400         ADDC    A,#0x0
   \   000044   FF           MOV     R7,A
    832          
    833            retValue = (uint8)ZDP_ServerDiscReq( serviceMask, 0);
   \   000045                ; Setup parameters for call to function ZDP_ServerDiscReq
   \   000045   7900         MOV     R1,#0x0
   \   000047   AA..         MOV     R2,?V0 + 0
   \   000049   AB..         MOV     R3,?V0 + 1
   \   00004B   12....       LCALL   ??ZDP_ServerDiscReq?relay
   \   00004E   E9           MOV     A,R1
   \   00004F   85..82       MOV     DPL,?XSP + 0
   \   000052   85..83       MOV     DPH,?XSP + 1
   \   000055   F0           MOVX    @DPTR,A
    834          
    835            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000056                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000056   85..82       MOV     DPL,?XSP + 0
   \   000059   85..83       MOV     DPH,?XSP + 1
   \   00005C   AC82         MOV     R4,DPL
   \   00005E   AD83         MOV     R5,DPH
   \   000060   7B01         MOV     R3,#0x1
   \   000062   AA..         MOV     R2,?V0 + 2
   \   000064   7965         MOV     R1,#0x65
   \   000066   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    836          }
   \   000069   7401         MOV     A,#0x1
   \   00006B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006E   7F03         MOV     R7,#0x3
   \   000070   02....       LJMP    ?BANKED_LEAVE_XDATA
    837          
    838          /***************************************************************************************************
    839           * @fn      MT_ZdoEndDevBindRequest
    840           *
    841           * @brief   Handle a End Device Bind request.
    842           *
    843           * @param   pBuf  - MT message data
    844           *
    845           * @return  void
    846           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    847          void MT_ZdoEndDevBindRequest(uint8 *pBuf)
   \                     MT_ZdoEndDevBindRequest:
    848          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 70
   \   000005   74BA         MOV     A,#-0x46
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    849            uint8 cmdId;
    850            uint8 retValue = 0;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7400         MOV     A,#0x0
   \   000016   F0           MOVX    @DPTR,A
    851            uint8 i, epInt, numInClusters, numOutClusters;
    852            zAddrType_t destAddr;
    853            uint16 shortAddr;
    854            uint16 profileID, inClusters[MTZDO_MAX_ED_BIND_CLUSTERS], outClusters[MTZDO_MAX_ED_BIND_CLUSTERS];
    855          
    856            /* parse header */
    857            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   8E82         MOV     DPL,R6
   \   000019   8F83         MOV     DPH,R7
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 7,A
    858            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000020   EE           MOV     A,R6
   \   000021   2403         ADD     A,#0x3
   \   000023   FE           MOV     R6,A
   \   000024   EF           MOV     A,R7
   \   000025   3400         ADDC    A,#0x0
   \   000027   FF           MOV     R7,A
    859          
    860            /* Dev address */
    861            destAddr.addrMode = Addr16Bit;
   \   000028   7409         MOV     A,#0x9
   \   00002A   12....       LCALL   ?XSTACK_DISP0_8
   \   00002D   7402         MOV     A,#0x2
   \   00002F   F0           MOVX    @DPTR,A
    862            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000030   8E82         MOV     DPL,R6
   \   000032   8F83         MOV     DPH,R7
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FA           MOV     R2,A
   \   000036   7B00         MOV     R3,#0x0
   \   000038   8E82         MOV     DPL,R6
   \   00003A   8F83         MOV     DPH,R7
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   F8           MOV     R0,A
   \   00003F   7900         MOV     R1,#0x0
   \   000041   E4           CLR     A
   \   000042   C8           XCH     A,R0
   \   000043   F9           MOV     R1,A
   \   000044   EA           MOV     A,R2
   \   000045   28           ADD     A,R0
   \   000046   F8           MOV     R0,A
   \   000047   EB           MOV     A,R3
   \   000048   39           ADDC    A,R1
   \   000049   F9           MOV     R1,A
   \   00004A   7401         MOV     A,#0x1
   \   00004C   12....       LCALL   ?XSTACK_DISP0_8
   \   00004F   E8           MOV     A,R0
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   E9           MOV     A,R1
   \   000053   F0           MOVX    @DPTR,A
    863            pBuf += 2;
   \   000054   EE           MOV     A,R6
   \   000055   2402         ADD     A,#0x2
   \   000057   FE           MOV     R6,A
   \   000058   EF           MOV     A,R7
   \   000059   3400         ADDC    A,#0x0
   \   00005B   FF           MOV     R7,A
    864          
    865            /* Local coordinator of the binding */
    866            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   00005C   8E82         MOV     DPL,R6
   \   00005E   8F83         MOV     DPH,R7
   \   000060   E0           MOVX    A,@DPTR
   \   000061   FA           MOV     R2,A
   \   000062   7B00         MOV     R3,#0x0
   \   000064   8E82         MOV     DPL,R6
   \   000066   8F83         MOV     DPH,R7
   \   000068   A3           INC     DPTR
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   F8           MOV     R0,A
   \   00006B   7900         MOV     R1,#0x0
   \   00006D   E4           CLR     A
   \   00006E   C8           XCH     A,R0
   \   00006F   F9           MOV     R1,A
   \   000070   EA           MOV     A,R2
   \   000071   28           ADD     A,R0
   \   000072   F8           MOV     R0,A
   \   000073   EB           MOV     A,R3
   \   000074   39           ADDC    A,R1
   \   000075   F9           MOV     R1,A
   \   000076   88..         MOV     ?V0 + 2,R0
   \   000078   89..         MOV     ?V0 + 3,R1
    867            pBuf += 2;
   \   00007A   EE           MOV     A,R6
   \   00007B   2402         ADD     A,#0x2
   \   00007D   FE           MOV     R6,A
   \   00007E   EF           MOV     A,R7
   \   00007F   3400         ADDC    A,#0x0
   \   000081   FF           MOV     R7,A
    868          
    869            /* For now, skip past the extended address */
    870            pBuf += Z_EXTADDR_LEN;
   \   000082   EE           MOV     A,R6
   \   000083   2408         ADD     A,#0x8
   \   000085   FE           MOV     R6,A
   \   000086   EF           MOV     A,R7
   \   000087   3400         ADDC    A,#0x0
   \   000089   FF           MOV     R7,A
    871          
    872            /* Endpoint */
    873            epInt = *pBuf++;
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   F5..         MOV     ?V0 + 10,A
   \   000091   8E82         MOV     DPL,R6
   \   000093   8F83         MOV     DPH,R7
   \   000095   A3           INC     DPTR
   \   000096   AE82         MOV     R6,DPL
   \   000098   AF83         MOV     R7,DPH
    874          
    875            /* Profile ID */
    876            profileID = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   00009A   8E82         MOV     DPL,R6
   \   00009C   8F83         MOV     DPH,R7
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   FA           MOV     R2,A
   \   0000A0   7B00         MOV     R3,#0x0
   \   0000A2   8E82         MOV     DPL,R6
   \   0000A4   8F83         MOV     DPH,R7
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   F8           MOV     R0,A
   \   0000A9   7900         MOV     R1,#0x0
   \   0000AB   E4           CLR     A
   \   0000AC   C8           XCH     A,R0
   \   0000AD   F9           MOV     R1,A
   \   0000AE   EA           MOV     A,R2
   \   0000AF   28           ADD     A,R0
   \   0000B0   F8           MOV     R0,A
   \   0000B1   EB           MOV     A,R3
   \   0000B2   39           ADDC    A,R1
   \   0000B3   F9           MOV     R1,A
   \   0000B4   88..         MOV     ?V0 + 0,R0
   \   0000B6   89..         MOV     ?V0 + 1,R1
    877            pBuf += 2;
   \   0000B8   EE           MOV     A,R6
   \   0000B9   2402         ADD     A,#0x2
   \   0000BB   FE           MOV     R6,A
   \   0000BC   EF           MOV     A,R7
   \   0000BD   3400         ADDC    A,#0x0
   \   0000BF   FF           MOV     R7,A
    878          
    879            /* NumInClusters */
    880            numInClusters = *pBuf++;
   \   0000C0   8E82         MOV     DPL,R6
   \   0000C2   8F83         MOV     DPH,R7
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   F5..         MOV     ?V0 + 6,A
   \   0000C7   8E82         MOV     DPL,R6
   \   0000C9   8F83         MOV     DPH,R7
   \   0000CB   A3           INC     DPTR
   \   0000CC   AE82         MOV     R6,DPL
   \   0000CE   AF83         MOV     R7,DPH
    881            if ( numInClusters <= MTZDO_MAX_ED_BIND_CLUSTERS )
   \   0000D0   E5..         MOV     A,?V0 + 6
   \   0000D2   C3           CLR     C
   \   0000D3   9410         SUBB    A,#0x10
   \   0000D5   505F         JNC     ??MT_ZdoEndDevBindRequest_0
    882            {
    883              for ( i = 0; i < numInClusters; i++ )
   \   0000D7   75..00       MOV     ?V0 + 4,#0x0
   \                     ??MT_ZdoEndDevBindRequest_1:
   \   0000DA   E5..         MOV     A,?V0 + 4
   \   0000DC   C3           CLR     C
   \   0000DD   95..         SUBB    A,?V0 + 6
   \   0000DF   505E         JNC     ??MT_ZdoEndDevBindRequest_2
    884              {
    885                inClusters[i] = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000E1   8E82         MOV     DPL,R6
   \   0000E3   8F83         MOV     DPH,R7
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   FA           MOV     R2,A
   \   0000E7   7B00         MOV     R3,#0x0
   \   0000E9   8E82         MOV     DPL,R6
   \   0000EB   8F83         MOV     DPH,R7
   \   0000ED   A3           INC     DPTR
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   F8           MOV     R0,A
   \   0000F0   7900         MOV     R1,#0x0
   \   0000F2   E4           CLR     A
   \   0000F3   C8           XCH     A,R0
   \   0000F4   F9           MOV     R1,A
   \   0000F5   EA           MOV     A,R2
   \   0000F6   28           ADD     A,R0
   \   0000F7   FA           MOV     R2,A
   \   0000F8   EB           MOV     A,R3
   \   0000F9   39           ADDC    A,R1
   \   0000FA   FB           MOV     R3,A
   \   0000FB   E5..         MOV     A,?V0 + 4
   \   0000FD   A8..         MOV     R0,?V0 + 4
   \   0000FF   7900         MOV     R1,#0x0
   \   000101   E8           MOV     A,R0
   \   000102   75F002       MOV     B,#0x2
   \   000105   A4           MUL     AB
   \   000106   C8           XCH     A,R0
   \   000107   ACF0         MOV     R4,B
   \   000109   75F000       MOV     B,#0x0
   \   00010C   A4           MUL     AB
   \   00010D   2C           ADD     A,R4
   \   00010E   FC           MOV     R4,A
   \   00010F   75F002       MOV     B,#0x2
   \   000112   E9           MOV     A,R1
   \   000113   A4           MUL     AB
   \   000114   2C           ADD     A,R4
   \   000115   F9           MOV     R1,A
   \   000116   7428         MOV     A,#0x28
   \   000118   12....       LCALL   ?XSTACK_DISP0_8
   \   00011B   E582         MOV     A,DPL
   \   00011D   28           ADD     A,R0
   \   00011E   F582         MOV     DPL,A
   \   000120   E583         MOV     A,DPH
   \   000122   39           ADDC    A,R1
   \   000123   F583         MOV     DPH,A
   \   000125   EA           MOV     A,R2
   \   000126   F0           MOVX    @DPTR,A
   \   000127   A3           INC     DPTR
   \   000128   EB           MOV     A,R3
   \   000129   F0           MOVX    @DPTR,A
    886                pBuf += 2;
   \   00012A   EE           MOV     A,R6
   \   00012B   2402         ADD     A,#0x2
   \   00012D   FE           MOV     R6,A
   \   00012E   EF           MOV     A,R7
   \   00012F   3400         ADDC    A,#0x0
   \   000131   FF           MOV     R7,A
    887              }
   \   000132   05..         INC     ?V0 + 4
   \   000134   80A4         SJMP    ??MT_ZdoEndDevBindRequest_1
    888            }
    889            else
    890            {
    891              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoEndDevBindRequest_0:
   \   000136   85..82       MOV     DPL,?XSP + 0
   \   000139   85..83       MOV     DPH,?XSP + 1
   \   00013C   7480         MOV     A,#-0x80
   \   00013E   F0           MOVX    @DPTR,A
    892            }
    893          
    894            /* NumOutClusters */
    895            numOutClusters = *pBuf++;
   \                     ??MT_ZdoEndDevBindRequest_2:
   \   00013F   8E82         MOV     DPL,R6
   \   000141   8F83         MOV     DPH,R7
   \   000143   E0           MOVX    A,@DPTR
   \   000144   F5..         MOV     ?V0 + 5,A
   \   000146   8E82         MOV     DPL,R6
   \   000148   8F83         MOV     DPH,R7
   \   00014A   A3           INC     DPTR
   \   00014B   AE82         MOV     R6,DPL
   \   00014D   AF83         MOV     R7,DPH
    896            if ( numOutClusters <= MTZDO_MAX_ED_BIND_CLUSTERS )
   \   00014F   E5..         MOV     A,?V0 + 5
   \   000151   C3           CLR     C
   \   000152   9410         SUBB    A,#0x10
   \   000154   505F         JNC     ??MT_ZdoEndDevBindRequest_3
    897            {
    898              for ( i = 0; i < numOutClusters; i++ )
   \   000156   75..00       MOV     ?V0 + 4,#0x0
   \                     ??MT_ZdoEndDevBindRequest_4:
   \   000159   E5..         MOV     A,?V0 + 4
   \   00015B   C3           CLR     C
   \   00015C   95..         SUBB    A,?V0 + 5
   \   00015E   505E         JNC     ??MT_ZdoEndDevBindRequest_5
    899              {
    900                outClusters[i] = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000160   8E82         MOV     DPL,R6
   \   000162   8F83         MOV     DPH,R7
   \   000164   E0           MOVX    A,@DPTR
   \   000165   FA           MOV     R2,A
   \   000166   7B00         MOV     R3,#0x0
   \   000168   8E82         MOV     DPL,R6
   \   00016A   8F83         MOV     DPH,R7
   \   00016C   A3           INC     DPTR
   \   00016D   E0           MOVX    A,@DPTR
   \   00016E   F8           MOV     R0,A
   \   00016F   7900         MOV     R1,#0x0
   \   000171   E4           CLR     A
   \   000172   C8           XCH     A,R0
   \   000173   F9           MOV     R1,A
   \   000174   EA           MOV     A,R2
   \   000175   28           ADD     A,R0
   \   000176   FA           MOV     R2,A
   \   000177   EB           MOV     A,R3
   \   000178   39           ADDC    A,R1
   \   000179   FB           MOV     R3,A
   \   00017A   E5..         MOV     A,?V0 + 4
   \   00017C   A8..         MOV     R0,?V0 + 4
   \   00017E   7900         MOV     R1,#0x0
   \   000180   E8           MOV     A,R0
   \   000181   75F002       MOV     B,#0x2
   \   000184   A4           MUL     AB
   \   000185   C8           XCH     A,R0
   \   000186   ACF0         MOV     R4,B
   \   000188   75F000       MOV     B,#0x0
   \   00018B   A4           MUL     AB
   \   00018C   2C           ADD     A,R4
   \   00018D   FC           MOV     R4,A
   \   00018E   75F002       MOV     B,#0x2
   \   000191   E9           MOV     A,R1
   \   000192   A4           MUL     AB
   \   000193   2C           ADD     A,R4
   \   000194   F9           MOV     R1,A
   \   000195   740A         MOV     A,#0xa
   \   000197   12....       LCALL   ?XSTACK_DISP0_8
   \   00019A   E582         MOV     A,DPL
   \   00019C   28           ADD     A,R0
   \   00019D   F582         MOV     DPL,A
   \   00019F   E583         MOV     A,DPH
   \   0001A1   39           ADDC    A,R1
   \   0001A2   F583         MOV     DPH,A
   \   0001A4   EA           MOV     A,R2
   \   0001A5   F0           MOVX    @DPTR,A
   \   0001A6   A3           INC     DPTR
   \   0001A7   EB           MOV     A,R3
   \   0001A8   F0           MOVX    @DPTR,A
    901                pBuf += 2;
   \   0001A9   EE           MOV     A,R6
   \   0001AA   2402         ADD     A,#0x2
   \   0001AC   FE           MOV     R6,A
   \   0001AD   EF           MOV     A,R7
   \   0001AE   3400         ADDC    A,#0x0
   \   0001B0   FF           MOV     R7,A
    902              }
   \   0001B1   05..         INC     ?V0 + 4
   \   0001B3   80A4         SJMP    ??MT_ZdoEndDevBindRequest_4
    903            }
    904            else
    905            {
    906              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoEndDevBindRequest_3:
   \   0001B5   85..82       MOV     DPL,?XSP + 0
   \   0001B8   85..83       MOV     DPH,?XSP + 1
   \   0001BB   7480         MOV     A,#-0x80
   \   0001BD   F0           MOVX    @DPTR,A
    907            }
    908          
    909            if ( retValue == 0 )
   \                     ??MT_ZdoEndDevBindRequest_5:
   \   0001BE   85..82       MOV     DPL,?XSP + 0
   \   0001C1   85..83       MOV     DPH,?XSP + 1
   \   0001C4   E0           MOVX    A,@DPTR
   \   0001C5   705E         JNZ     ??MT_ZdoEndDevBindRequest_6
    910            {
    911              retValue = (uint8)ZDP_EndDeviceBindReq( &destAddr, shortAddr, epInt, profileID,
    912                                                    numInClusters, inClusters, numOutClusters, outClusters, 0);
   \   0001C7                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   0001C7   75..00       MOV     ?V0 + 8,#0x0
   \   0001CA   78..         MOV     R0,#?V0 + 8
   \   0001CC   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001CF   740B         MOV     A,#0xb
   \   0001D1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001D4   8582..       MOV     ?V0 + 8,DPL
   \   0001D7   8583..       MOV     ?V0 + 9,DPH
   \   0001DA   78..         MOV     R0,#?V0 + 8
   \   0001DC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001DF   E5..         MOV     A,?V0 + 5
   \   0001E1   F5..         MOV     ?V0 + 8,A
   \   0001E3   78..         MOV     R0,#?V0 + 8
   \   0001E5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001E8   742C         MOV     A,#0x2c
   \   0001EA   12....       LCALL   ?XSTACK_DISP0_8
   \   0001ED   8582..       MOV     ?V0 + 8,DPL
   \   0001F0   8583..       MOV     ?V0 + 9,DPH
   \   0001F3   78..         MOV     R0,#?V0 + 8
   \   0001F5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001F8   E5..         MOV     A,?V0 + 6
   \   0001FA   F5..         MOV     ?V0 + 8,A
   \   0001FC   78..         MOV     R0,#?V0 + 8
   \   0001FE   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000201   78..         MOV     R0,#?V0 + 0
   \   000203   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000206   A9..         MOV     R1,?V0 + 10
   \   000208   AC..         MOV     R4,?V0 + 2
   \   00020A   AD..         MOV     R5,?V0 + 3
   \   00020C   740A         MOV     A,#0xa
   \   00020E   12....       LCALL   ?XSTACK_DISP0_8
   \   000211   AA82         MOV     R2,DPL
   \   000213   AB83         MOV     R3,DPH
   \   000215   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000218   7409         MOV     A,#0x9
   \   00021A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00021D   E9           MOV     A,R1
   \   00021E   85..82       MOV     DPL,?XSP + 0
   \   000221   85..83       MOV     DPH,?XSP + 1
   \   000224   F0           MOVX    @DPTR,A
    913            }
    914          
    915            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \                     ??MT_ZdoEndDevBindRequest_6:
   \   000225                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000225   85..82       MOV     DPL,?XSP + 0
   \   000228   85..83       MOV     DPH,?XSP + 1
   \   00022B   AC82         MOV     R4,DPL
   \   00022D   AD83         MOV     R5,DPH
   \   00022F   7B01         MOV     R3,#0x1
   \   000231   AA..         MOV     R2,?V0 + 7
   \   000233   7965         MOV     R1,#0x65
   \   000235   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    916          }
   \   000238   7446         MOV     A,#0x46
   \   00023A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00023D   7F0B         MOV     R7,#0xb
   \   00023F   02....       LJMP    ?BANKED_LEAVE_XDATA
    917          
    918          /***************************************************************************************************
    919           * @fn      MT_ZdoBindRequest
    920           *
    921           * @brief   Handle a Bind request.
    922           *
    923           * @param   pBuf  - MT message data
    924           *
    925           * @return  void
    926           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    927          void MT_ZdoBindRequest(uint8 *pBuf)
   \                     MT_ZdoBindRequest:
    928          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 19
   \   000005   74ED         MOV     A,#-0x13
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    929            uint8 cmdId;
    930            uint8 retValue;
    931            zAddrType_t destAddr, devAddr;
    932            uint8 *pSrcAddr, *ptr;
    933            uint8 srcEPInt, dstEPInt;
    934            uint16 clusterID;
    935          
    936            /* parse header */
    937            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 1,A
    938            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
    939          
    940            /* Dev address */
    941            destAddr.addrMode = Addr16Bit;
   \   00001F   7412         MOV     A,#0x12
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
    942            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   740A         MOV     A,#0xa
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
    943            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
    944          
    945            /* SrcAddress */
    946            pSrcAddr = pBuf;
   \   000053   8E..         MOV     ?V0 + 8,R6
   \   000055   8F..         MOV     ?V0 + 9,R7
    947            pBuf += Z_EXTADDR_LEN;
   \   000057   EE           MOV     A,R6
   \   000058   2408         ADD     A,#0x8
   \   00005A   FE           MOV     R6,A
   \   00005B   EF           MOV     A,R7
   \   00005C   3400         ADDC    A,#0x0
   \   00005E   FF           MOV     R7,A
    948          
    949            /* SrcEPInt */
    950            srcEPInt = *pBuf++;
   \   00005F   8E82         MOV     DPL,R6
   \   000061   8F83         MOV     DPH,R7
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F5..         MOV     ?V0 + 2,A
   \   000066   8E82         MOV     DPL,R6
   \   000068   8F83         MOV     DPH,R7
   \   00006A   A3           INC     DPTR
   \   00006B   AE82         MOV     R6,DPL
   \   00006D   AF83         MOV     R7,DPH
    951          
    952            /* ClusterID */
    953            clusterID = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   00006F   8E82         MOV     DPL,R6
   \   000071   8F83         MOV     DPH,R7
   \   000073   E0           MOVX    A,@DPTR
   \   000074   FA           MOV     R2,A
   \   000075   7B00         MOV     R3,#0x0
   \   000077   8E82         MOV     DPL,R6
   \   000079   8F83         MOV     DPH,R7
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F8           MOV     R0,A
   \   00007E   7900         MOV     R1,#0x0
   \   000080   E4           CLR     A
   \   000081   C8           XCH     A,R0
   \   000082   F9           MOV     R1,A
   \   000083   EA           MOV     A,R2
   \   000084   28           ADD     A,R0
   \   000085   F8           MOV     R0,A
   \   000086   EB           MOV     A,R3
   \   000087   39           ADDC    A,R1
   \   000088   F9           MOV     R1,A
   \   000089   88..         MOV     ?V0 + 6,R0
   \   00008B   89..         MOV     ?V0 + 7,R1
    954            pBuf += 2;
   \   00008D   EE           MOV     A,R6
   \   00008E   2402         ADD     A,#0x2
   \   000090   FE           MOV     R6,A
   \   000091   EF           MOV     A,R7
   \   000092   3400         ADDC    A,#0x0
   \   000094   FF           MOV     R7,A
    955          
    956            /* Destination Address mode */
    957            devAddr.addrMode = *pBuf++;
   \   000095   8E82         MOV     DPL,R6
   \   000097   8F83         MOV     DPH,R7
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   C0E0         PUSH    A
   \   00009C   7409         MOV     A,#0x9
   \   00009E   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A1   D0E0         POP     A
   \   0000A3   F0           MOVX    @DPTR,A
   \   0000A4   8E82         MOV     DPL,R6
   \   0000A6   8F83         MOV     DPH,R7
   \   0000A8   A3           INC     DPTR
   \   0000A9   AE82         MOV     R6,DPL
   \   0000AB   AF83         MOV     R7,DPH
    958          
    959            /* Destination Address */
    960            if ( devAddr.addrMode == Addr64Bit )
   \   0000AD   7409         MOV     A,#0x9
   \   0000AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   6403         XRL     A,#0x3
   \   0000B5   7016         JNZ     ??MT_ZdoBindRequest_0
    961            {
    962              ptr = pBuf;
   \   0000B7   8E..         MOV     ?V0 + 4,R6
   \   0000B9   8F..         MOV     ?V0 + 5,R7
    963              osal_cpyExtAddr( devAddr.addr.extAddr, ptr );
   \   0000BB                ; Setup parameters for call to function sAddrExtCpy
   \   0000BB   AC..         MOV     R4,?V0 + 4
   \   0000BD   AD..         MOV     R5,?V0 + 5
   \   0000BF   7401         MOV     A,#0x1
   \   0000C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C4   AA82         MOV     R2,DPL
   \   0000C6   AB83         MOV     R3,DPH
   \   0000C8   12....       LCALL   ??sAddrExtCpy?relay
   \   0000CB   8024         SJMP    ??MT_ZdoBindRequest_1
    964            }
    965            else
    966            {
    967              devAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \                     ??MT_ZdoBindRequest_0:
   \   0000CD   8E82         MOV     DPL,R6
   \   0000CF   8F83         MOV     DPH,R7
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   FA           MOV     R2,A
   \   0000D3   7B00         MOV     R3,#0x0
   \   0000D5   8E82         MOV     DPL,R6
   \   0000D7   8F83         MOV     DPH,R7
   \   0000D9   A3           INC     DPTR
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   F8           MOV     R0,A
   \   0000DC   7900         MOV     R1,#0x0
   \   0000DE   E4           CLR     A
   \   0000DF   C8           XCH     A,R0
   \   0000E0   F9           MOV     R1,A
   \   0000E1   EA           MOV     A,R2
   \   0000E2   28           ADD     A,R0
   \   0000E3   F8           MOV     R0,A
   \   0000E4   EB           MOV     A,R3
   \   0000E5   39           ADDC    A,R1
   \   0000E6   F9           MOV     R1,A
   \   0000E7   7401         MOV     A,#0x1
   \   0000E9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EC   E8           MOV     A,R0
   \   0000ED   F0           MOVX    @DPTR,A
   \   0000EE   A3           INC     DPTR
   \   0000EF   E9           MOV     A,R1
   \   0000F0   F0           MOVX    @DPTR,A
    968            }
    969            /* The short address occupies LSB two bytes */
    970            pBuf += Z_EXTADDR_LEN;
   \                     ??MT_ZdoBindRequest_1:
   \   0000F1   EE           MOV     A,R6
   \   0000F2   2408         ADD     A,#0x8
   \   0000F4   FE           MOV     R6,A
   \   0000F5   EF           MOV     A,R7
   \   0000F6   3400         ADDC    A,#0x0
   \   0000F8   FF           MOV     R7,A
    971          
    972            /* DstEPInt */
    973            dstEPInt = *pBuf;
   \   0000F9   8E82         MOV     DPL,R6
   \   0000FB   8F83         MOV     DPH,R7
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   F5..         MOV     ?V0 + 0,A
    974          
    975            retValue = (uint8)ZDP_BindReq( &destAddr, pSrcAddr, srcEPInt, clusterID, &devAddr, dstEPInt, 0);
   \   000100                ; Setup parameters for call to function ZDP_BindUnbindReq
   \   000100   75..00       MOV     ?V0 + 3,#0x0
   \   000103   78..         MOV     R0,#?V0 + 3
   \   000105   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000108   E5..         MOV     A,?V0 + 0
   \   00010A   F5..         MOV     ?V0 + 3,A
   \   00010C   78..         MOV     R0,#?V0 + 3
   \   00010E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000111   7403         MOV     A,#0x3
   \   000113   12....       LCALL   ?XSTACK_DISP0_8
   \   000116   8582..       MOV     ?V0 + 10,DPL
   \   000119   8583..       MOV     ?V0 + 11,DPH
   \   00011C   78..         MOV     R0,#?V0 + 10
   \   00011E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000121   78..         MOV     R0,#?V0 + 6
   \   000123   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000126   78..         MOV     R0,#?V0 + 8
   \   000128   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00012B   A9..         MOV     R1,?V0 + 2
   \   00012D   7412         MOV     A,#0x12
   \   00012F   12....       LCALL   ?XSTACK_DISP0_8
   \   000132   AC82         MOV     R4,DPL
   \   000134   AD83         MOV     R5,DPH
   \   000136   7A21         MOV     R2,#0x21
   \   000138   7B00         MOV     R3,#0x0
   \   00013A   12....       LCALL   ??ZDP_BindUnbindReq?relay
   \   00013D   7408         MOV     A,#0x8
   \   00013F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000142   E9           MOV     A,R1
   \   000143   85..82       MOV     DPL,?XSP + 0
   \   000146   85..83       MOV     DPH,?XSP + 1
   \   000149   F0           MOVX    @DPTR,A
    976          
    977            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   00014A                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00014A   85..82       MOV     DPL,?XSP + 0
   \   00014D   85..83       MOV     DPH,?XSP + 1
   \   000150   AC82         MOV     R4,DPL
   \   000152   AD83         MOV     R5,DPH
   \   000154   7B01         MOV     R3,#0x1
   \   000156   AA..         MOV     R2,?V0 + 1
   \   000158   7965         MOV     R1,#0x65
   \   00015A   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    978          }
   \   00015D   7413         MOV     A,#0x13
   \   00015F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000162   7F0C         MOV     R7,#0xc
   \   000164   02....       LJMP    ?BANKED_LEAVE_XDATA
    979          
    980          /***************************************************************************************************
    981           * @fn      MT_ZdoUnbindRequest
    982           *
    983           * @brief   Handle a Unbind request.
    984           *
    985           * @param   pBuf  - MT message data
    986           *
    987           * @return  void
    988           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    989          void MT_ZdoUnbindRequest(uint8 *pBuf)
   \                     MT_ZdoUnbindRequest:
    990          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 19
   \   000005   74ED         MOV     A,#-0x13
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    991            uint8 cmdId;
    992            uint8 retValue;
    993            zAddrType_t destAddr, devAddr;
    994            uint8 *pSrcAddr, *ptr;
    995            uint8 srcEPInt, dstEPInt;
    996            uint16 clusterID;
    997          
    998            /* parse header */
    999            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 1,A
   1000            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000017   EE           MOV     A,R6
   \   000018   2403         ADD     A,#0x3
   \   00001A   FE           MOV     R6,A
   \   00001B   EF           MOV     A,R7
   \   00001C   3400         ADDC    A,#0x0
   \   00001E   FF           MOV     R7,A
   1001          
   1002            /* dev address */
   1003            destAddr.addrMode = Addr16Bit;
   \   00001F   7412         MOV     A,#0x12
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   7402         MOV     A,#0x2
   \   000026   F0           MOVX    @DPTR,A
   1004            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   740A         MOV     A,#0xa
   \   000043   12....       LCALL   ?XSTACK_DISP0_8
   \   000046   E8           MOV     A,R0
   \   000047   F0           MOVX    @DPTR,A
   \   000048   A3           INC     DPTR
   \   000049   E9           MOV     A,R1
   \   00004A   F0           MOVX    @DPTR,A
   1005            pBuf += 2;
   \   00004B   EE           MOV     A,R6
   \   00004C   2402         ADD     A,#0x2
   \   00004E   FE           MOV     R6,A
   \   00004F   EF           MOV     A,R7
   \   000050   3400         ADDC    A,#0x0
   \   000052   FF           MOV     R7,A
   1006          
   1007            /* SrcAddress */
   1008            pSrcAddr = pBuf;
   \   000053   8E..         MOV     ?V0 + 8,R6
   \   000055   8F..         MOV     ?V0 + 9,R7
   1009            pBuf += Z_EXTADDR_LEN;
   \   000057   EE           MOV     A,R6
   \   000058   2408         ADD     A,#0x8
   \   00005A   FE           MOV     R6,A
   \   00005B   EF           MOV     A,R7
   \   00005C   3400         ADDC    A,#0x0
   \   00005E   FF           MOV     R7,A
   1010          
   1011            /* SrcEPInt */
   1012            srcEPInt = *pBuf++;
   \   00005F   8E82         MOV     DPL,R6
   \   000061   8F83         MOV     DPH,R7
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F5..         MOV     ?V0 + 2,A
   \   000066   8E82         MOV     DPL,R6
   \   000068   8F83         MOV     DPH,R7
   \   00006A   A3           INC     DPTR
   \   00006B   AE82         MOV     R6,DPL
   \   00006D   AF83         MOV     R7,DPH
   1013          
   1014            /* ClusterID */
   1015            clusterID = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   00006F   8E82         MOV     DPL,R6
   \   000071   8F83         MOV     DPH,R7
   \   000073   E0           MOVX    A,@DPTR
   \   000074   FA           MOV     R2,A
   \   000075   7B00         MOV     R3,#0x0
   \   000077   8E82         MOV     DPL,R6
   \   000079   8F83         MOV     DPH,R7
   \   00007B   A3           INC     DPTR
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   F8           MOV     R0,A
   \   00007E   7900         MOV     R1,#0x0
   \   000080   E4           CLR     A
   \   000081   C8           XCH     A,R0
   \   000082   F9           MOV     R1,A
   \   000083   EA           MOV     A,R2
   \   000084   28           ADD     A,R0
   \   000085   F8           MOV     R0,A
   \   000086   EB           MOV     A,R3
   \   000087   39           ADDC    A,R1
   \   000088   F9           MOV     R1,A
   \   000089   88..         MOV     ?V0 + 6,R0
   \   00008B   89..         MOV     ?V0 + 7,R1
   1016            pBuf += 2;
   \   00008D   EE           MOV     A,R6
   \   00008E   2402         ADD     A,#0x2
   \   000090   FE           MOV     R6,A
   \   000091   EF           MOV     A,R7
   \   000092   3400         ADDC    A,#0x0
   \   000094   FF           MOV     R7,A
   1017          
   1018            /* Destination Address mode */
   1019            devAddr.addrMode = *pBuf++;
   \   000095   8E82         MOV     DPL,R6
   \   000097   8F83         MOV     DPH,R7
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   C0E0         PUSH    A
   \   00009C   7409         MOV     A,#0x9
   \   00009E   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A1   D0E0         POP     A
   \   0000A3   F0           MOVX    @DPTR,A
   \   0000A4   8E82         MOV     DPL,R6
   \   0000A6   8F83         MOV     DPH,R7
   \   0000A8   A3           INC     DPTR
   \   0000A9   AE82         MOV     R6,DPL
   \   0000AB   AF83         MOV     R7,DPH
   1020          
   1021            /* Destination Address */
   1022            if ( devAddr.addrMode == Addr64Bit )
   \   0000AD   7409         MOV     A,#0x9
   \   0000AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   6403         XRL     A,#0x3
   \   0000B5   7016         JNZ     ??MT_ZdoUnbindRequest_0
   1023            {
   1024              ptr = pBuf;
   \   0000B7   8E..         MOV     ?V0 + 4,R6
   \   0000B9   8F..         MOV     ?V0 + 5,R7
   1025              osal_cpyExtAddr( devAddr.addr.extAddr, ptr );
   \   0000BB                ; Setup parameters for call to function sAddrExtCpy
   \   0000BB   AC..         MOV     R4,?V0 + 4
   \   0000BD   AD..         MOV     R5,?V0 + 5
   \   0000BF   7401         MOV     A,#0x1
   \   0000C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C4   AA82         MOV     R2,DPL
   \   0000C6   AB83         MOV     R3,DPH
   \   0000C8   12....       LCALL   ??sAddrExtCpy?relay
   \   0000CB   8024         SJMP    ??MT_ZdoUnbindRequest_1
   1026            }
   1027            else
   1028            {
   1029              devAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \                     ??MT_ZdoUnbindRequest_0:
   \   0000CD   8E82         MOV     DPL,R6
   \   0000CF   8F83         MOV     DPH,R7
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   FA           MOV     R2,A
   \   0000D3   7B00         MOV     R3,#0x0
   \   0000D5   8E82         MOV     DPL,R6
   \   0000D7   8F83         MOV     DPH,R7
   \   0000D9   A3           INC     DPTR
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   F8           MOV     R0,A
   \   0000DC   7900         MOV     R1,#0x0
   \   0000DE   E4           CLR     A
   \   0000DF   C8           XCH     A,R0
   \   0000E0   F9           MOV     R1,A
   \   0000E1   EA           MOV     A,R2
   \   0000E2   28           ADD     A,R0
   \   0000E3   F8           MOV     R0,A
   \   0000E4   EB           MOV     A,R3
   \   0000E5   39           ADDC    A,R1
   \   0000E6   F9           MOV     R1,A
   \   0000E7   7401         MOV     A,#0x1
   \   0000E9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EC   E8           MOV     A,R0
   \   0000ED   F0           MOVX    @DPTR,A
   \   0000EE   A3           INC     DPTR
   \   0000EF   E9           MOV     A,R1
   \   0000F0   F0           MOVX    @DPTR,A
   1030            }
   1031            /* The short address occupies LSB two bytes */
   1032            pBuf += Z_EXTADDR_LEN;
   \                     ??MT_ZdoUnbindRequest_1:
   \   0000F1   EE           MOV     A,R6
   \   0000F2   2408         ADD     A,#0x8
   \   0000F4   FE           MOV     R6,A
   \   0000F5   EF           MOV     A,R7
   \   0000F6   3400         ADDC    A,#0x0
   \   0000F8   FF           MOV     R7,A
   1033          
   1034            /* dstEPInt */
   1035            dstEPInt = *pBuf;
   \   0000F9   8E82         MOV     DPL,R6
   \   0000FB   8F83         MOV     DPH,R7
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   F5..         MOV     ?V0 + 0,A
   1036          
   1037            retValue = (uint8)ZDP_UnbindReq( &destAddr, pSrcAddr, srcEPInt, clusterID, &devAddr, dstEPInt, 0);
   \   000100                ; Setup parameters for call to function ZDP_BindUnbindReq
   \   000100   75..00       MOV     ?V0 + 3,#0x0
   \   000103   78..         MOV     R0,#?V0 + 3
   \   000105   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000108   E5..         MOV     A,?V0 + 0
   \   00010A   F5..         MOV     ?V0 + 3,A
   \   00010C   78..         MOV     R0,#?V0 + 3
   \   00010E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000111   7403         MOV     A,#0x3
   \   000113   12....       LCALL   ?XSTACK_DISP0_8
   \   000116   8582..       MOV     ?V0 + 10,DPL
   \   000119   8583..       MOV     ?V0 + 11,DPH
   \   00011C   78..         MOV     R0,#?V0 + 10
   \   00011E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000121   78..         MOV     R0,#?V0 + 6
   \   000123   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000126   78..         MOV     R0,#?V0 + 8
   \   000128   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00012B   A9..         MOV     R1,?V0 + 2
   \   00012D   7412         MOV     A,#0x12
   \   00012F   12....       LCALL   ?XSTACK_DISP0_8
   \   000132   AC82         MOV     R4,DPL
   \   000134   AD83         MOV     R5,DPH
   \   000136   7A22         MOV     R2,#0x22
   \   000138   7B00         MOV     R3,#0x0
   \   00013A   12....       LCALL   ??ZDP_BindUnbindReq?relay
   \   00013D   7408         MOV     A,#0x8
   \   00013F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000142   E9           MOV     A,R1
   \   000143   85..82       MOV     DPL,?XSP + 0
   \   000146   85..83       MOV     DPH,?XSP + 1
   \   000149   F0           MOVX    @DPTR,A
   1038          
   1039            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   00014A                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00014A   85..82       MOV     DPL,?XSP + 0
   \   00014D   85..83       MOV     DPH,?XSP + 1
   \   000150   AC82         MOV     R4,DPL
   \   000152   AD83         MOV     R5,DPH
   \   000154   7B01         MOV     R3,#0x1
   \   000156   AA..         MOV     R2,?V0 + 1
   \   000158   7965         MOV     R1,#0x65
   \   00015A   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1040          }
   \   00015D   7413         MOV     A,#0x13
   \   00015F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000162   7F0C         MOV     R7,#0xc
   \   000164   02....       LJMP    ?BANKED_LEAVE_XDATA
   1041          
   1042          #if defined (MT_SYS_KEY_MANAGEMENT)
   1043          /***************************************************************************************************
   1044           * @fn      MT_ZdoSetLinkKey
   1045           *
   1046           * @brief   Set an application or trust center link key.
   1047           *
   1048           * @param   pBuf  - MT message data
   1049           *
   1050           * @return  void
   1051           ***************************************************************************************************/
   1052          void MT_ZdoSetLinkKey(uint8 *pBuf)
   1053          {
   1054            uint8 cmdId;
   1055            uint8 retValue;
   1056            uint8 *pExtAddr;
   1057            uint8 *pKey;
   1058            uint16 shortAddr;
   1059          
   1060            /* parse header */
   1061            cmdId = pBuf[MT_RPC_POS_CMD1];
   1062            pBuf += MT_RPC_FRAME_HDR_SZ;
   1063          
   1064            /* ShortAddr */
   1065            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1066            pBuf += 2;
   1067          
   1068            /* Extended Addr */
   1069            pExtAddr = pBuf;
   1070            pBuf += Z_EXTADDR_LEN;
   1071          
   1072            /* Key data */
   1073            pKey = pBuf;
   1074          
   1075            retValue = (uint8)ZDSecMgrAddLinkKey( shortAddr, pExtAddr, pKey);
   1076          
   1077            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1078          }
   1079          
   1080          /***************************************************************************************************
   1081           * @fn      MT_ZdoRemoveLinkKey
   1082           *
   1083           * @brief   Remove an application or trust center link key.
   1084           *
   1085           * @param   pBuf  - MT message data
   1086           *
   1087           * @return  void
   1088           ***************************************************************************************************/
   1089          void MT_ZdoRemoveLinkKey(uint8 *pBuf)
   1090          {
   1091            uint8 cmdId;
   1092            uint8 retValue;
   1093            uint8 *pExtAddr;
   1094          
   1095            /* parse header */
   1096            cmdId = pBuf[MT_RPC_POS_CMD1];
   1097            pBuf += MT_RPC_FRAME_HDR_SZ;
   1098          
   1099            /* ShortAddr */
   1100            pExtAddr = pBuf;
   1101          
   1102            retValue = ZDSecMgrDeviceRemoveByExtAddr( pExtAddr );
   1103          
   1104            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1105          }
   1106          
   1107          /***************************************************************************************************
   1108           * @fn      MT_ZdoGetLinkKey
   1109           *
   1110           * @brief   Get the application link key.
   1111           *
   1112           * @param   pBuf  - MT message data
   1113           *
   1114           * @return  void
   1115           ***************************************************************************************************/
   1116          void MT_ZdoGetLinkKey(uint8 *pBuf)
   1117          {
   1118            uint8 cmdId;
   1119            uint8 retValue;
   1120            uint8 *pExtAddr;
   1121            uint8 *retBuf = NULL;
   1122            uint8 len;
   1123            APSME_LinkKeyData_t *pApsLinkKey = NULL;
   1124            uint16 apsLinkKeyNvId;
   1125          
   1126            // parse header
   1127            cmdId = pBuf[MT_RPC_POS_CMD1];
   1128            pBuf += MT_RPC_FRAME_HDR_SZ;
   1129          
   1130            // Extended Address
   1131            pExtAddr = pBuf;
   1132          
   1133            // Fetch the key NV ID
   1134            retValue = APSME_LinkKeyNVIdGet( pExtAddr, &apsLinkKeyNvId );
   1135          
   1136            if (retValue == ZSuccess)
   1137            {
   1138              if ((pApsLinkKey = (APSME_LinkKeyData_t *)osal_mem_alloc(sizeof(APSME_LinkKeyData_t))) != NULL)
   1139              {
   1140                // retrieve key from NV
   1141                if (osal_nv_read( apsLinkKeyNvId, 0,
   1142                                 sizeof(APSME_LinkKeyData_t), pApsLinkKey) != SUCCESS)
   1143                {
   1144                  retValue = ZNwkUnknownDevice;
   1145                }
   1146              }
   1147              else
   1148              {
   1149                retValue = ZNwkUnknownDevice;
   1150              }
   1151            }
   1152          
   1153            // Construct the response message
   1154            len = MT_ZDO_STATUS_LEN + Z_EXTADDR_LEN + SEC_KEY_LEN; // status + extAddr + key
   1155            if ((retBuf = (uint8 *)osal_mem_alloc(len)) != NULL)
   1156            {
   1157              if (retValue == ZSuccess)
   1158              {
   1159                // Extended Address
   1160                osal_memcpy( &(retBuf[1]), pExtAddr, Z_EXTADDR_LEN );
   1161          
   1162                // Key data
   1163                osal_memcpy( &(retBuf[1 + Z_EXTADDR_LEN]), pApsLinkKey->key, SEC_KEY_LEN );
   1164              }
   1165              else
   1166              {
   1167                // Failed case - set the rest fields to all FF
   1168                osal_memset( &(retBuf[1]), 0xFF, Z_EXTADDR_LEN + SEC_KEY_LEN );
   1169              }
   1170          
   1171              retBuf[0] = retValue;  // Status
   1172          
   1173              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, len, retBuf);
   1174          
   1175              // clear retBuf because it contains key data and free allocated memory
   1176              osal_memset(retBuf, 0x00, len);
   1177          
   1178              osal_mem_free(retBuf);
   1179            }
   1180          
   1181            // clear copy of key in RAM
   1182            if (pApsLinkKey != NULL)
   1183            {
   1184              osal_memset(pApsLinkKey, 0x00, sizeof(APSME_LinkKeyData_t));
   1185          
   1186              osal_mem_free(pApsLinkKey);
   1187            }
   1188          
   1189            return;
   1190          }
   1191          #endif // MT_SYS_KEY_MANAGEMENT
   1192          
   1193          #if defined (MT_ZDO_MGMT)
   1194          /***************************************************************************************************
   1195           * @fn      MT_ZdoMgmtNwkDiscRequest
   1196           *
   1197           * @brief   Handle a Mgmt Nwk Discovery request.
   1198           *
   1199           * @param   pBuf  - MT message data
   1200           *
   1201           * @return  void
   1202           ***************************************************************************************************/
   1203          void MT_ZdoMgmtNwkDiscRequest(uint8 *pBuf)
   1204          {
   1205            uint8 cmdId;
   1206            uint8 retValue;
   1207            zAddrType_t destAddr;
   1208            uint32 scanChannels;
   1209            uint8 scanDuration, startIndex;
   1210          
   1211            /* parse header */
   1212            cmdId = pBuf[MT_RPC_POS_CMD1];
   1213            pBuf += MT_RPC_FRAME_HDR_SZ;
   1214          
   1215            /* Dev address */
   1216            destAddr.addrMode = Addr16Bit;
   1217            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1218            pBuf += 2;
   1219          
   1220            /* Scan Channels */
   1221            scanChannels = BUILD_UINT32( pBuf[0], pBuf[1], pBuf[2], pBuf[3] );
   1222            pBuf += 4;
   1223          
   1224            /* Scan Duration */
   1225            scanDuration = *pBuf++;
   1226          
   1227            /* Start Index */
   1228            startIndex = *pBuf;
   1229          
   1230            retValue = (uint8)ZDP_MgmtNwkDiscReq( &destAddr, scanChannels, scanDuration, startIndex, 0);
   1231          
   1232            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1233          }
   1234          
   1235          /***************************************************************************************************
   1236           * @fn      MT_ZdoMgmtLqiRequest
   1237           *
   1238           * @brief   Handle a Mgmt Lqi request.
   1239           *
   1240           * @param   pBuf  - MT message data
   1241           *
   1242           * @return  void
   1243           ***************************************************************************************************/
   1244          void MT_ZdoMgmtLqiRequest(uint8 *pBuf)
   1245          {
   1246            uint8 cmdId;
   1247            uint8 retValue;
   1248            zAddrType_t destAddr;
   1249            uint8 startIndex;
   1250          
   1251            /* parse header */
   1252            cmdId = pBuf[MT_RPC_POS_CMD1];
   1253            pBuf += MT_RPC_FRAME_HDR_SZ;
   1254          
   1255            /* Dev address */
   1256            destAddr.addrMode = Addr16Bit;
   1257            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1258            pBuf += 2;
   1259          
   1260            /* Start Index */
   1261            startIndex = *pBuf;
   1262          
   1263            retValue = (uint8)ZDP_MgmtLqiReq( &destAddr, startIndex, 0);
   1264          
   1265            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1266          }
   1267          
   1268          /***************************************************************************************************
   1269           * @fn      MT_ZdoMgmtRtgRequest
   1270           *
   1271           * @brief   Handle a Mgmt Rtg request.
   1272           *
   1273           * @param   pBuf  - MT message data
   1274           *
   1275           * @return  void
   1276           ***************************************************************************************************/
   1277          void MT_ZdoMgmtRtgRequest(uint8 *pBuf)
   1278          {
   1279            uint8 cmdId;
   1280            uint8 retValue;
   1281            zAddrType_t destAddr;
   1282            uint8 startIndex;
   1283          
   1284            /* parse header */
   1285            cmdId = pBuf[MT_RPC_POS_CMD1];
   1286            pBuf += MT_RPC_FRAME_HDR_SZ;
   1287          
   1288            /* Dev Address */
   1289            destAddr.addrMode = Addr16Bit;
   1290            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
   1291            pBuf += 2;
   1292          
   1293            /* Start Index */
   1294            startIndex = *pBuf;
   1295          
   1296            retValue = (byte)ZDP_MgmtRtgReq( &destAddr, startIndex, 0);
   1297          
   1298            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1299          }
   1300          
   1301          /***************************************************************************************************
   1302           * @fn      MT_ZdoMgmtBindRequest
   1303           *
   1304           * @brief   Handle a Mgmt Bind request.
   1305           *
   1306           * @param   pBuf  - MT message data
   1307           *
   1308           * @return  void
   1309           ***************************************************************************************************/
   1310          void MT_ZdoMgmtBindRequest(uint8 *pBuf)
   1311          {
   1312            uint8 cmdId;
   1313            uint8 retValue;
   1314            zAddrType_t destAddr;
   1315            uint8 startIndex;
   1316          
   1317            /* parse header */
   1318            cmdId = pBuf[MT_RPC_POS_CMD1];
   1319            pBuf += MT_RPC_FRAME_HDR_SZ;
   1320          
   1321            /* Dev Address */
   1322            destAddr.addrMode = Addr16Bit;
   1323            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1324            pBuf += 2;
   1325          
   1326            /* Start Index */
   1327            startIndex = *pBuf;
   1328          
   1329            retValue = (uint8)ZDP_MgmtBindReq( &destAddr, startIndex, 0);
   1330          
   1331            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1332          }
   1333          
   1334          /***************************************************************************************************
   1335           * @fn      MT_ZdoMgmtLeaveRequest
   1336           *
   1337           * @brief   Handle a Mgmt Leave request.
   1338           *
   1339           * @param   pBuf  - MT message data
   1340           *
   1341           * @return  void
   1342           ***************************************************************************************************/
   1343          void MT_ZdoMgmtLeaveRequest(uint8 *pBuf)
   1344          {
   1345            uint8 cmdId;
   1346            uint8 retValue;
   1347            zAddrType_t destAddr;
   1348            uint8 *pIEEEAddr;
   1349            uint8 removeChildren, rejoin;
   1350          
   1351            /* parse header */
   1352            cmdId = pBuf[MT_RPC_POS_CMD1];
   1353            pBuf += MT_RPC_FRAME_HDR_SZ;
   1354          
   1355            /* Destination Address */
   1356            destAddr.addrMode = Addr16Bit;
   1357            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1358            pBuf += 2;
   1359          
   1360            /* IEEE address */
   1361            pIEEEAddr = pBuf;
   1362            pBuf += Z_EXTADDR_LEN;
   1363          
   1364            /* Remove Children */
   1365            removeChildren = *pBuf++;
   1366          
   1367            /* Rejoin */
   1368            rejoin = *pBuf;
   1369          
   1370            retValue = (byte)ZDP_MgmtLeaveReq( &destAddr, pIEEEAddr, removeChildren, rejoin, 0);
   1371          
   1372            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1373          }
   1374          
   1375          
   1376          /***************************************************************************************************
   1377           * @fn      MT_ZdoMgmtDirectJoinRequest
   1378           *
   1379           * @brief   Handle a Mgmt Direct Join request.
   1380           *
   1381           * @param   pBuf  - MT message data
   1382           *
   1383           * @return  void
   1384           ***************************************************************************************************/
   1385          void MT_ZdoMgmtDirectJoinRequest(uint8 *pBuf)
   1386          {
   1387            uint8 cmdId;
   1388            uint8 retValue;
   1389            zAddrType_t destAddr;
   1390            uint8 *deviceAddr;
   1391            uint8 capInfo;
   1392          
   1393            /* parse header */
   1394            cmdId = pBuf[MT_RPC_POS_CMD1];
   1395            pBuf += MT_RPC_FRAME_HDR_SZ;
   1396          
   1397            /* Destination Address */
   1398            destAddr.addrMode = Addr16Bit;
   1399            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1400            pBuf += 2;
   1401          
   1402            /* Device Address */
   1403            deviceAddr = pBuf;
   1404            pBuf += Z_EXTADDR_LEN;
   1405          
   1406            /* Capability information */
   1407            capInfo = *pBuf;
   1408          
   1409            retValue = (uint8)ZDP_MgmtDirectJoinReq( &destAddr, deviceAddr, capInfo, 0);
   1410          
   1411            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1412          }
   1413          
   1414          /***************************************************************************************************
   1415           * @fn      MT_ZdoMgmtPermitJoinRequest
   1416           *
   1417           * @brief   Handle a Mgmt Permit Join request.
   1418           *
   1419           * @param   pBuf  - MT message data
   1420           *
   1421           * @return  void
   1422           ***************************************************************************************************/
   1423          void MT_ZdoMgmtPermitJoinRequest(uint8 *pBuf)
   1424          {
   1425            uint8 cmdId;
   1426            uint8 retValue;
   1427            zAddrType_t destAddr;
   1428            uint8 duration, tcSignificance;
   1429          
   1430            /* parse header */
   1431            cmdId = pBuf[MT_RPC_POS_CMD1];
   1432            pBuf += MT_RPC_FRAME_HDR_SZ;
   1433          
   1434            /* Destination Address */
   1435            destAddr.addrMode = Addr16Bit;
   1436            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1437            pBuf += 2;
   1438          
   1439            /* Duration */
   1440            duration = *pBuf++;
   1441          
   1442            /* Trust center significance */
   1443            tcSignificance = *pBuf;
   1444          
   1445            retValue = (byte)ZDP_MgmtPermitJoinReq( &destAddr, duration, tcSignificance, 0);
   1446          
   1447            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1448          }
   1449          
   1450          /***************************************************************************************************
   1451           * @fn      MT_ZdoMgmtNwkUpdateRequest
   1452           *
   1453           * @brief   Handle a Mgmt Nwk Update request.
   1454           *
   1455           * @param   pBuf  - MT message data
   1456           *
   1457           * @return  void
   1458           ***************************************************************************************************/
   1459          void MT_ZdoMgmtNwkUpdateRequest(uint8 *pBuf)
   1460          {
   1461            uint8 cmdId;
   1462            uint8 retValue;
   1463            zAddrType_t destAddr;
   1464            uint32 channelMask;
   1465            uint8 scanDuration, scanCount;
   1466            uint16 nwkManagerAddr;
   1467          
   1468              /* parse header */
   1469            cmdId = pBuf[MT_RPC_POS_CMD1];
   1470            pBuf += MT_RPC_FRAME_HDR_SZ;
   1471          
   1472            /* Destination address */
   1473            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1474            pBuf += 2;
   1475          
   1476            /* Destination address mode */
   1477            destAddr.addrMode = *pBuf++;
   1478          
   1479            channelMask = BUILD_UINT32( pBuf[0], pBuf[1], pBuf[2], pBuf[3]);
   1480            pBuf += 4;
   1481          
   1482            /* Scan duration */
   1483            scanDuration = *pBuf++;
   1484          
   1485            /* Scan count */
   1486            scanCount = *pBuf++;
   1487          
   1488            /* NWK manager address */
   1489            nwkManagerAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1490          
   1491            /* Send the Management Network Update request */
   1492            retValue = (uint8)ZDP_MgmtNwkUpdateReq( &destAddr, channelMask, scanDuration,
   1493                                                    scanCount, _NIB.nwkUpdateId+1, nwkManagerAddr );
   1494          
   1495            /*
   1496              Since we don't recevied our own broadcast messages, we should
   1497              send a unicast copy of the message to ourself.
   1498            */
   1499            if ( destAddr.addrMode == AddrBroadcast )
   1500            {
   1501              destAddr.addrMode = Addr16Bit;
   1502              destAddr.addr.shortAddr = _NIB.nwkDevAddress;
   1503              retValue = (uint8) ZDP_MgmtNwkUpdateReq( &destAddr, channelMask, scanDuration,
   1504                                                       scanCount, _NIB.nwkUpdateId+1, nwkManagerAddr );
   1505            }
   1506          
   1507            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1508          }
   1509          #endif /* MT_ZDO_MGMT */
   1510          
   1511          /***************************************************************************************************
   1512           * @fn      MT_ZdoStartupFromApp
   1513           *
   1514           * @brief   Handle a Startup from App request.
   1515           *
   1516           * @param   pBuf  - MT message data
   1517           *
   1518           * @return  void
   1519           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1520          void MT_ZdoStartupFromApp(uint8 *pBuf)
   \                     MT_ZdoStartupFromApp:
   1521          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1522            uint8 cmd0, cmd1, retValue;
   1523          
   1524            /* parse header */
   1525            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 1,A
   1526            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   000016   8E82         MOV     DPL,R6
   \   000018   8F83         MOV     DPH,R7
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 0,A
   1527            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001F   EE           MOV     A,R6
   \   000020   2403         ADD     A,#0x3
   \   000022   FE           MOV     R6,A
   \   000023   EF           MOV     A,R7
   \   000024   3400         ADDC    A,#0x0
   \   000026   FF           MOV     R7,A
   1528          
   1529            retValue = ZDOInitDevice(100);
   \   000027                ; Setup parameters for call to function ZDOInitDevice
   \   000027   7A64         MOV     R2,#0x64
   \   000029   7B00         MOV     R3,#0x0
   \   00002B   12....       LCALL   ??ZDOInitDevice?relay
   \   00002E   E9           MOV     A,R1
   \   00002F   85..82       MOV     DPL,?XSP + 0
   \   000032   85..83       MOV     DPH,?XSP + 1
   \   000035   F0           MOVX    @DPTR,A
   1530          
   1531            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \   000036   74E0         MOV     A,#-0x20
   \   000038   55..         ANL     A,?V0 + 1
   \   00003A   6420         XRL     A,#0x20
   \   00003C   7013         JNZ     ??MT_ZdoStartupFromApp_0
   1532            {
   1533              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_ZDO), cmd1,1, &retValue);
   \   00003E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00003E   85..82       MOV     DPL,?XSP + 0
   \   000041   85..83       MOV     DPH,?XSP + 1
   \   000044   AC82         MOV     R4,DPL
   \   000046   AD83         MOV     R5,DPH
   \   000048   7B01         MOV     R3,#0x1
   \   00004A   AA..         MOV     R2,?V0 + 0
   \   00004C   7965         MOV     R1,#0x65
   \   00004E   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1534            }
   1535          }
   \                     ??MT_ZdoStartupFromApp_0:
   \   000051   7401         MOV     A,#0x1
   \   000053   12....       LCALL   ?DEALLOC_XSTACK8
   \   000056   7F02         MOV     R7,#0x2
   \   000058   02....       LJMP    ?BANKED_LEAVE_XDATA
   1536          
   1537          
   1538          /***************************************************************************************************
   1539           * @fn      MT_ZdoNetworkDiscoveryReq
   1540           *
   1541           * @brief   Handle a ZDO Network Discovery request.
   1542           *
   1543           * @param   pBuf  - MT message data
   1544           *
   1545           * @return  void
   1546           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1547          void MT_ZdoNetworkDiscoveryReq(uint8 *pBuf)
   \                     MT_ZdoNetworkDiscoveryReq:
   1548          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1549            uint8  retValue = ZFailure;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7401         MOV     A,#0x1
   \   000016   F0           MOVX    @DPTR,A
   1550            uint8  cmdId;
   1551            uint32 scanChannels;
   1552          
   1553            /* parse header */
   1554            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   8E82         MOV     DPL,R6
   \   000019   8F83         MOV     DPH,R7
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 0,A
   1555            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000020   EE           MOV     A,R6
   \   000021   2403         ADD     A,#0x3
   \   000023   FE           MOV     R6,A
   \   000024   EF           MOV     A,R7
   \   000025   3400         ADDC    A,#0x0
   \   000027   FF           MOV     R7,A
   1556          
   1557            /* Packet format */
   1558            /* scan channels (4) | scan duration (1) */
   1559          
   1560            /* Scan channels */
   1561            scanChannels = osal_build_uint32(pBuf, 4);
   \   000028                ; Setup parameters for call to function osal_build_uint32
   \   000028   7904         MOV     R1,#0x4
   \   00002A   EE           MOV     A,R6
   \   00002B   FA           MOV     R2,A
   \   00002C   EF           MOV     A,R7
   \   00002D   FB           MOV     R3,A
   \   00002E   12....       LCALL   ??osal_build_uint32?relay
   \   000031   8A..         MOV     ?V0 + 8,R2
   \   000033   8B..         MOV     ?V0 + 9,R3
   \   000035   8C..         MOV     ?V0 + 10,R4
   \   000037   8D..         MOV     ?V0 + 11,R5
   \   000039   85....       MOV     ?V0 + 4,?V0 + 8
   \   00003C   85....       MOV     ?V0 + 5,?V0 + 9
   \   00003F   85....       MOV     ?V0 + 6,?V0 + 10
   \   000042   85....       MOV     ?V0 + 7,?V0 + 11
   1562            pBuf += 4;
   \   000045   EE           MOV     A,R6
   \   000046   2404         ADD     A,#0x4
   \   000048   FE           MOV     R6,A
   \   000049   EF           MOV     A,R7
   \   00004A   3400         ADDC    A,#0x0
   \   00004C   FF           MOV     R7,A
   1563          
   1564            retValue = ZDApp_NetworkDiscoveryReq(scanChannels, *pBuf);
   \   00004D                ; Setup parameters for call to function ZDApp_NetworkDiscoveryReq
   \   00004D   8E82         MOV     DPL,R6
   \   00004F   8F83         MOV     DPH,R7
   \   000051   E0           MOVX    A,@DPTR
   \   000052   F9           MOV     R1,A
   \   000053   AA..         MOV     R2,?V0 + 4
   \   000055   AB..         MOV     R3,?V0 + 5
   \   000057   AC..         MOV     R4,?V0 + 6
   \   000059   AD..         MOV     R5,?V0 + 7
   \   00005B   12....       LCALL   ??ZDApp_NetworkDiscoveryReq?relay
   \   00005E   E9           MOV     A,R1
   \   00005F   85..82       MOV     DPL,?XSP + 0
   \   000062   85..83       MOV     DPH,?XSP + 1
   \   000065   F0           MOVX    @DPTR,A
   1565          
   1566            // Register ZDO callback for MT to handle the network discovery confirm
   1567            // and beacon notification confirm
   1568            ZDO_RegisterForZdoCB( ZDO_NWK_DISCOVERY_CNF_CBID, &MT_ZdoNwkDiscoveryCnfCB );
   \   000066                ; Setup parameters for call to function ZDO_RegisterForZdoCB
   \   000066   7A..         MOV     R2,#??MT_ZdoNwkDiscoveryCnfCB?relay & 0xff
   \   000068   7B..         MOV     R3,#(??MT_ZdoNwkDiscoveryCnfCB?relay >> 8) & 0xff
   \   00006A   7902         MOV     R1,#0x2
   \   00006C   12....       LCALL   ??ZDO_RegisterForZdoCB?relay
   \   00006F   E9           MOV     A,R1
   1569            ZDO_RegisterForZdoCB( ZDO_BEACON_NOTIFY_IND_CBID, &MT_ZdoBeaconIndCB );
   \   000070                ; Setup parameters for call to function ZDO_RegisterForZdoCB
   \   000070   7A..         MOV     R2,#??MT_ZdoBeaconIndCB?relay & 0xff
   \   000072   7B..         MOV     R3,#(??MT_ZdoBeaconIndCB?relay >> 8) & 0xff
   \   000074   7903         MOV     R1,#0x3
   \   000076   12....       LCALL   ??ZDO_RegisterForZdoCB?relay
   \   000079   E9           MOV     A,R1
   1570          
   1571            /* Build and send back the response */
   1572            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue );
   \   00007A                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00007A   85..82       MOV     DPL,?XSP + 0
   \   00007D   85..83       MOV     DPH,?XSP + 1
   \   000080   AC82         MOV     R4,DPL
   \   000082   AD83         MOV     R5,DPH
   \   000084   7B01         MOV     R3,#0x1
   \   000086   AA..         MOV     R2,?V0 + 0
   \   000088   7965         MOV     R1,#0x65
   \   00008A   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1573          }
   \   00008D   7401         MOV     A,#0x1
   \   00008F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000092   7F0C         MOV     R7,#0xc
   \   000094   02....       LJMP    ?BANKED_LEAVE_XDATA
   1574          
   1575          
   1576          /***************************************************************************************************
   1577           * @fn      MT_ZdoJoinReq
   1578           *
   1579           * @brief   Handle a ZDO Join request.
   1580           *
   1581           * @param   pBuf  - MT message data
   1582           *
   1583           * @return  void
   1584           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1585          void MT_ZdoJoinReq(uint8 *pBuf)
   \                     MT_ZdoJoinReq:
   1586          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1587            uint8  retValue = ZFailure;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7401         MOV     A,#0x1
   \   000016   F0           MOVX    @DPTR,A
   1588            uint8  cmdId;
   1589            uint16 panId;
   1590            uint16 chosenParent;
   1591          
   1592            /* parse header */
   1593            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   8E82         MOV     DPL,R6
   \   000019   8F83         MOV     DPH,R7
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 2,A
   1594            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000020   EE           MOV     A,R6
   \   000021   2403         ADD     A,#0x3
   \   000023   FE           MOV     R6,A
   \   000024   EF           MOV     A,R7
   \   000025   3400         ADDC    A,#0x0
   \   000027   FF           MOV     R7,A
   1595          
   1596            /* Packet format */
   1597            /* channel     (1) | panID (2) | extendedPanID (8) | chosenParent (2) |
   1598             * parentDepth (1) | stackProfile  (1)
   1599             */
   1600          
   1601            panId        = BUILD_UINT16(pBuf[1], pBuf[2]);
   \   000028   8E82         MOV     DPL,R6
   \   00002A   8F83         MOV     DPH,R7
   \   00002C   A3           INC     DPTR
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   FA           MOV     R2,A
   \   00002F   7B00         MOV     R3,#0x0
   \   000031   8E82         MOV     DPL,R6
   \   000033   8F83         MOV     DPH,R7
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F8           MOV     R0,A
   \   000039   7900         MOV     R1,#0x0
   \   00003B   E4           CLR     A
   \   00003C   C8           XCH     A,R0
   \   00003D   F9           MOV     R1,A
   \   00003E   EA           MOV     A,R2
   \   00003F   28           ADD     A,R0
   \   000040   F8           MOV     R0,A
   \   000041   EB           MOV     A,R3
   \   000042   39           ADDC    A,R1
   \   000043   F9           MOV     R1,A
   \   000044   88..         MOV     ?V0 + 0,R0
   \   000046   89..         MOV     ?V0 + 1,R1
   1602            chosenParent = BUILD_UINT16(pBuf[11], pBuf[12]);
   \   000048   EE           MOV     A,R6
   \   000049   240B         ADD     A,#0xb
   \   00004B   F582         MOV     DPL,A
   \   00004D   EF           MOV     A,R7
   \   00004E   3400         ADDC    A,#0x0
   \   000050   F583         MOV     DPH,A
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FA           MOV     R2,A
   \   000054   7B00         MOV     R3,#0x0
   \   000056   EE           MOV     A,R6
   \   000057   240C         ADD     A,#0xc
   \   000059   F582         MOV     DPL,A
   \   00005B   EF           MOV     A,R7
   \   00005C   3400         ADDC    A,#0x0
   \   00005E   F583         MOV     DPH,A
   \   000060   E0           MOVX    A,@DPTR
   \   000061   F8           MOV     R0,A
   \   000062   7900         MOV     R1,#0x0
   \   000064   E4           CLR     A
   \   000065   C8           XCH     A,R0
   \   000066   F9           MOV     R1,A
   \   000067   EA           MOV     A,R2
   \   000068   28           ADD     A,R0
   \   000069   F8           MOV     R0,A
   \   00006A   EB           MOV     A,R3
   \   00006B   39           ADDC    A,R1
   \   00006C   F9           MOV     R1,A
   \   00006D   88..         MOV     ?V0 + 4,R0
   \   00006F   89..         MOV     ?V0 + 5,R1
   1603          
   1604            retValue = ZDApp_JoinReq(pBuf[0], panId, &(pBuf[3]), chosenParent, pBuf[13], pBuf[14]);
   \   000071                ; Setup parameters for call to function ZDApp_JoinReq
   \   000071   EE           MOV     A,R6
   \   000072   240E         ADD     A,#0xe
   \   000074   F582         MOV     DPL,A
   \   000076   EF           MOV     A,R7
   \   000077   3400         ADDC    A,#0x0
   \   000079   F583         MOV     DPH,A
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F5..         MOV     ?V0 + 3,A
   \   00007E   78..         MOV     R0,#?V0 + 3
   \   000080   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000083   EE           MOV     A,R6
   \   000084   240D         ADD     A,#0xd
   \   000086   F582         MOV     DPL,A
   \   000088   EF           MOV     A,R7
   \   000089   3400         ADDC    A,#0x0
   \   00008B   F583         MOV     DPH,A
   \   00008D   E0           MOVX    A,@DPTR
   \   00008E   F5..         MOV     ?V0 + 3,A
   \   000090   78..         MOV     R0,#?V0 + 3
   \   000092   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000095   78..         MOV     R0,#?V0 + 4
   \   000097   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009A   EE           MOV     A,R6
   \   00009B   2403         ADD     A,#0x3
   \   00009D   FC           MOV     R4,A
   \   00009E   EF           MOV     A,R7
   \   00009F   3400         ADDC    A,#0x0
   \   0000A1   FD           MOV     R5,A
   \   0000A2   AA..         MOV     R2,?V0 + 0
   \   0000A4   AB..         MOV     R3,?V0 + 1
   \   0000A6   8E82         MOV     DPL,R6
   \   0000A8   8F83         MOV     DPH,R7
   \   0000AA   E0           MOVX    A,@DPTR
   \   0000AB   F9           MOV     R1,A
   \   0000AC   12....       LCALL   ??ZDApp_JoinReq?relay
   \   0000AF   7404         MOV     A,#0x4
   \   0000B1   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B4   E9           MOV     A,R1
   \   0000B5   85..82       MOV     DPL,?XSP + 0
   \   0000B8   85..83       MOV     DPH,?XSP + 1
   \   0000BB   F0           MOVX    @DPTR,A
   1605          
   1606            /* Register for MT to receive Join Confirm */
   1607            ZDO_RegisterForZdoCB( ZDO_JOIN_CNF_CBID, &MT_ZdoJoinCnfCB );
   \   0000BC                ; Setup parameters for call to function ZDO_RegisterForZdoCB
   \   0000BC   7A..         MOV     R2,#??MT_ZdoJoinCnfCB?relay & 0xff
   \   0000BE   7B..         MOV     R3,#(??MT_ZdoJoinCnfCB?relay >> 8) & 0xff
   \   0000C0   7904         MOV     R1,#0x4
   \   0000C2   12....       LCALL   ??ZDO_RegisterForZdoCB?relay
   \   0000C5   E9           MOV     A,R1
   1608          
   1609            /* Build and send back the response */
   1610            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue );
   \   0000C6                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000C6   85..82       MOV     DPL,?XSP + 0
   \   0000C9   85..83       MOV     DPH,?XSP + 1
   \   0000CC   AC82         MOV     R4,DPL
   \   0000CE   AD83         MOV     R5,DPH
   \   0000D0   7B01         MOV     R3,#0x1
   \   0000D2   AA..         MOV     R2,?V0 + 2
   \   0000D4   7965         MOV     R1,#0x65
   \   0000D6   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1611          
   1612          }
   \   0000D9   7401         MOV     A,#0x1
   \   0000DB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000DE   7F06         MOV     R7,#0x6
   \   0000E0   02....       LJMP    ?BANKED_LEAVE_XDATA
   1613          
   1614          /***************************************************************************************************
   1615           * @fn          MT_ZdoNwkDiscoveryCnfCB
   1616           *
   1617           * @brief       Send an indication to inform host device the completion of
   1618           *              network discovery scan
   1619           *
   1620           * @param       pStr - pointer to a parameter and a structure of parameters
   1621           *
   1622           * @return      void
   1623           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1624          void *MT_ZdoNwkDiscoveryCnfCB ( void *pStr )
   \                     MT_ZdoNwkDiscoveryCnfCB:
   1625          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1626            /* pStr: status (uint8) */
   1627            /* Packet Format */
   1628            /* Status (1) */
   1629          
   1630            // Scan completed. De-register the callback with ZDO
   1631            ZDO_DeregisterForZdoCB( ZDO_NWK_DISCOVERY_CNF_CBID );
   \   000009                ; Setup parameters for call to function ZDO_DeregisterForZdoCB
   \   000009   7902         MOV     R1,#0x2
   \   00000B   12....       LCALL   ??ZDO_DeregisterForZdoCB?relay
   \   00000E   E9           MOV     A,R1
   1632            ZDO_DeregisterForZdoCB( ZDO_BEACON_NOTIFY_IND_CBID );
   \   00000F                ; Setup parameters for call to function ZDO_DeregisterForZdoCB
   \   00000F   7903         MOV     R1,#0x3
   \   000011   12....       LCALL   ??ZDO_DeregisterForZdoCB?relay
   \   000014   E9           MOV     A,R1
   1633          
   1634            // Send the buffered beacon indication
   1635            MT_ZdoBeaconIndCB ( NULL );
   \   000015                ; Setup parameters for call to function MT_ZdoBeaconIndCB
   \   000015   7A00         MOV     R2,#0x0
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??MT_ZdoBeaconIndCB?relay
   1636          
   1637            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   1638                                                   MT_ZDO_NWK_DISCOVERY_CNF, 1, pStr);
   \   00001C                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00001C   EE           MOV     A,R6
   \   00001D   FC           MOV     R4,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FD           MOV     R5,A
   \   000020   7B01         MOV     R3,#0x1
   \   000022   7AC7         MOV     R2,#-0x39
   \   000024   7945         MOV     R1,#0x45
   \   000026   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1639            return NULL;
   \   000029   7A00         MOV     R2,#0x0
   \   00002B   7B00         MOV     R3,#0x0
   \   00002D   7F01         MOV     R7,#0x1
   \   00002F   02....       LJMP    ?BANKED_LEAVE_XDATA
   1640          }
   1641          
   1642          
   1643          
   1644          /***************************************************************************************************
   1645           * @fn          MT_ZdoBeaconIndCB
   1646           *
   1647           * @brief       Send an indication to host device of a beacon notification
   1648           *
   1649           * @param       pStr -  pointer to a parameter and a structure of parameters
   1650           *
   1651           * @return      void
   1652           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1653          void *MT_ZdoBeaconIndCB ( void *pStr )
   \                     MT_ZdoBeaconIndCB:
   1654          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 2,R2
   \   000007   8B..         MOV     ?V0 + 3,R3
   1655            zdoBeaconInd_t *pBeacon = pStr;
   \   000009   85....       MOV     ?V0 + 0,?V0 + 2
   \   00000C   85....       MOV     ?V0 + 1,?V0 + 3
   1656            uint8 *pTmp;
   1657          
   1658            /* Packet Format */
   1659            /* devCnt (1) | device #1 (21) | device #2 (21) |... | device #n (21) */
   1660          
   1661            if( pStr != NULL)
   \   00000F   E5..         MOV     A,?V0 + 2
   \   000011   45..         ORL     A,?V0 + 3
   \   000013   7003         JNZ     $+5
   \   000015   02....       LJMP    ??MT_ZdoBeaconIndCB_0 & 0xFFFF
   1662            {
   1663              if( pBeaconIndBuf == NULL )
   \   000018   90....       MOV     DPTR,#pBeaconIndBuf
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   F8           MOV     R0,A
   \   00001D   A3           INC     DPTR
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   F9           MOV     R1,A
   \   000020   E8           MOV     A,R0
   \   000021   49           ORL     A,R1
   \   000022   7030         JNZ     ??MT_ZdoBeaconIndCB_1
   1664              {
   1665                // If pBeaconIndBuf has not been allocated yet
   1666                // allocate memory now with MAX_UART_TX_BUFF
   1667                if( NULL == (pBeaconIndBuf = (uint8 *)osal_mem_alloc(MT_ZDO_BEACON_IND_PACK_LEN)))
   \   000024                ; Setup parameters for call to function osal_mem_alloc
   \   000024   7A7B         MOV     R2,#0x7b
   \   000026   7B00         MOV     R3,#0x0
   \   000028   12....       LCALL   ??osal_mem_alloc?relay
   \   00002B   8A..         MOV     ?V0 + 4,R2
   \   00002D   8B..         MOV     ?V0 + 5,R3
   \   00002F   A8..         MOV     R0,?V0 + 4
   \   000031   A9..         MOV     R1,?V0 + 5
   \   000033   90....       MOV     DPTR,#pBeaconIndBuf
   \   000036   E8           MOV     A,R0
   \   000037   F0           MOVX    @DPTR,A
   \   000038   A3           INC     DPTR
   \   000039   E9           MOV     A,R1
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   E8           MOV     A,R0
   \   00003C   49           ORL     A,R1
   \   00003D   7007         JNZ     ??MT_ZdoBeaconIndCB_2
   1668                {
   1669                  // Memory failure
   1670                  return NULL;
   \   00003F   7A00         MOV     R2,#0x0
   \   000041   7B00         MOV     R3,#0x0
   \   000043   02....       LJMP    ??MT_ZdoBeaconIndCB_3 & 0xFFFF
   1671                }
   1672                pBeaconIndBuf[0] = 0; // First byte is devCnt. Initialize to 0.
   \                     ??MT_ZdoBeaconIndCB_2:
   \   000046   90....       MOV     DPTR,#pBeaconIndBuf
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F8           MOV     R0,A
   \   00004B   A3           INC     DPTR
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F583         MOV     DPH,A
   \   00004F   8882         MOV     DPL,R0
   \   000051   7400         MOV     A,#0x0
   \   000053   F0           MOVX    @DPTR,A
   1673              }
   1674          
   1675              // Fill in the buffer with the beacon indication
   1676              pTmp = pBeaconIndBuf + (1 + pBeaconIndBuf[0] * MT_ZDO_BEACON_IND_LEN);
   \                     ??MT_ZdoBeaconIndCB_1:
   \   000054   90....       MOV     DPTR,#pBeaconIndBuf
   \   000057   E0           MOVX    A,@DPTR
   \   000058   F8           MOV     R0,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   F583         MOV     DPH,A
   \   00005D   8882         MOV     DPL,R0
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   F8           MOV     R0,A
   \   000061   7900         MOV     R1,#0x0
   \   000063   E8           MOV     A,R0
   \   000064   75F015       MOV     B,#0x15
   \   000067   A4           MUL     AB
   \   000068   C8           XCH     A,R0
   \   000069   AAF0         MOV     R2,B
   \   00006B   75F000       MOV     B,#0x0
   \   00006E   A4           MUL     AB
   \   00006F   2A           ADD     A,R2
   \   000070   FA           MOV     R2,A
   \   000071   75F015       MOV     B,#0x15
   \   000074   E9           MOV     A,R1
   \   000075   A4           MUL     AB
   \   000076   2A           ADD     A,R2
   \   000077   F9           MOV     R1,A
   \   000078   90....       MOV     DPTR,#pBeaconIndBuf
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   28           ADD     A,R0
   \   00007D   FA           MOV     R2,A
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   39           ADDC    A,R1
   \   000081   8A82         MOV     DPL,R2
   \   000083   F583         MOV     DPH,A
   \   000085   A3           INC     DPTR
   \   000086   AE82         MOV     R6,DPL
   \   000088   AF83         MOV     R7,DPH
   1677              *pTmp++ = LO_UINT16(pBeacon->sourceAddr);
   \   00008A   85..82       MOV     DPL,?V0 + 0
   \   00008D   85..83       MOV     DPH,?V0 + 1
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F8           MOV     R0,A
   \   000092   A3           INC     DPTR
   \   000093   E0           MOVX    A,@DPTR
   \   000094   F9           MOV     R1,A
   \   000095   E8           MOV     A,R0
   \   000096   8E82         MOV     DPL,R6
   \   000098   8F83         MOV     DPH,R7
   \   00009A   F0           MOVX    @DPTR,A
   \   00009B   8E82         MOV     DPL,R6
   \   00009D   8F83         MOV     DPH,R7
   \   00009F   A3           INC     DPTR
   \   0000A0   AE82         MOV     R6,DPL
   \   0000A2   AF83         MOV     R7,DPH
   1678              *pTmp++ = HI_UINT16(pBeacon->sourceAddr);
   \   0000A4   85..82       MOV     DPL,?V0 + 0
   \   0000A7   85..83       MOV     DPH,?V0 + 1
   \   0000AA   E0           MOVX    A,@DPTR
   \   0000AB   F8           MOV     R0,A
   \   0000AC   A3           INC     DPTR
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   F9           MOV     R1,A
   \   0000AF   E4           CLR     A
   \   0000B0   E9           MOV     A,R1
   \   0000B1   F8           MOV     R0,A
   \   0000B2   8E82         MOV     DPL,R6
   \   0000B4   8F83         MOV     DPH,R7
   \   0000B6   F0           MOVX    @DPTR,A
   \   0000B7   8E82         MOV     DPL,R6
   \   0000B9   8F83         MOV     DPH,R7
   \   0000BB   A3           INC     DPTR
   \   0000BC   AE82         MOV     R6,DPL
   \   0000BE   AF83         MOV     R7,DPH
   1679              *pTmp++ = LO_UINT16(pBeacon->panID);
   \   0000C0   85..82       MOV     DPL,?V0 + 0
   \   0000C3   85..83       MOV     DPH,?V0 + 1
   \   0000C6   A3           INC     DPTR
   \   0000C7   A3           INC     DPTR
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   F8           MOV     R0,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   E0           MOVX    A,@DPTR
   \   0000CC   F9           MOV     R1,A
   \   0000CD   E8           MOV     A,R0
   \   0000CE   8E82         MOV     DPL,R6
   \   0000D0   8F83         MOV     DPH,R7
   \   0000D2   F0           MOVX    @DPTR,A
   \   0000D3   8E82         MOV     DPL,R6
   \   0000D5   8F83         MOV     DPH,R7
   \   0000D7   A3           INC     DPTR
   \   0000D8   AE82         MOV     R6,DPL
   \   0000DA   AF83         MOV     R7,DPH
   1680              *pTmp++ = HI_UINT16(pBeacon->panID);
   \   0000DC   85..82       MOV     DPL,?V0 + 0
   \   0000DF   85..83       MOV     DPH,?V0 + 1
   \   0000E2   A3           INC     DPTR
   \   0000E3   A3           INC     DPTR
   \   0000E4   E0           MOVX    A,@DPTR
   \   0000E5   F8           MOV     R0,A
   \   0000E6   A3           INC     DPTR
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   F9           MOV     R1,A
   \   0000E9   E4           CLR     A
   \   0000EA   E9           MOV     A,R1
   \   0000EB   F8           MOV     R0,A
   \   0000EC   8E82         MOV     DPL,R6
   \   0000EE   8F83         MOV     DPH,R7
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   8E82         MOV     DPL,R6
   \   0000F3   8F83         MOV     DPH,R7
   \   0000F5   A3           INC     DPTR
   \   0000F6   AE82         MOV     R6,DPL
   \   0000F8   AF83         MOV     R7,DPH
   1681              *pTmp++ = pBeacon->logicalChannel;
   \   0000FA   85..82       MOV     DPL,?V0 + 0
   \   0000FD   85..83       MOV     DPH,?V0 + 1
   \   000100   A3           INC     DPTR
   \   000101   A3           INC     DPTR
   \   000102   A3           INC     DPTR
   \   000103   A3           INC     DPTR
   \   000104   E0           MOVX    A,@DPTR
   \   000105   8E82         MOV     DPL,R6
   \   000107   8F83         MOV     DPH,R7
   \   000109   F0           MOVX    @DPTR,A
   \   00010A   8E82         MOV     DPL,R6
   \   00010C   8F83         MOV     DPH,R7
   \   00010E   A3           INC     DPTR
   \   00010F   AE82         MOV     R6,DPL
   \   000111   AF83         MOV     R7,DPH
   1682              *pTmp++ = pBeacon->permitJoining;
   \   000113   85..82       MOV     DPL,?V0 + 0
   \   000116   85..83       MOV     DPH,?V0 + 1
   \   000119   A3           INC     DPTR
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   A3           INC     DPTR
   \   00011D   A3           INC     DPTR
   \   00011E   E0           MOVX    A,@DPTR
   \   00011F   8E82         MOV     DPL,R6
   \   000121   8F83         MOV     DPH,R7
   \   000123   F0           MOVX    @DPTR,A
   \   000124   8E82         MOV     DPL,R6
   \   000126   8F83         MOV     DPH,R7
   \   000128   A3           INC     DPTR
   \   000129   AE82         MOV     R6,DPL
   \   00012B   AF83         MOV     R7,DPH
   1683              *pTmp++ = pBeacon->routerCapacity;
   \   00012D   85..82       MOV     DPL,?V0 + 0
   \   000130   85..83       MOV     DPH,?V0 + 1
   \   000133   A3           INC     DPTR
   \   000134   A3           INC     DPTR
   \   000135   A3           INC     DPTR
   \   000136   A3           INC     DPTR
   \   000137   A3           INC     DPTR
   \   000138   A3           INC     DPTR
   \   000139   E0           MOVX    A,@DPTR
   \   00013A   8E82         MOV     DPL,R6
   \   00013C   8F83         MOV     DPH,R7
   \   00013E   F0           MOVX    @DPTR,A
   \   00013F   8E82         MOV     DPL,R6
   \   000141   8F83         MOV     DPH,R7
   \   000143   A3           INC     DPTR
   \   000144   AE82         MOV     R6,DPL
   \   000146   AF83         MOV     R7,DPH
   1684              *pTmp++ = pBeacon->deviceCapacity;
   \   000148   85..82       MOV     DPL,?V0 + 0
   \   00014B   85..83       MOV     DPH,?V0 + 1
   \   00014E   A3           INC     DPTR
   \   00014F   A3           INC     DPTR
   \   000150   A3           INC     DPTR
   \   000151   A3           INC     DPTR
   \   000152   A3           INC     DPTR
   \   000153   A3           INC     DPTR
   \   000154   A3           INC     DPTR
   \   000155   E0           MOVX    A,@DPTR
   \   000156   8E82         MOV     DPL,R6
   \   000158   8F83         MOV     DPH,R7
   \   00015A   F0           MOVX    @DPTR,A
   \   00015B   8E82         MOV     DPL,R6
   \   00015D   8F83         MOV     DPH,R7
   \   00015F   A3           INC     DPTR
   \   000160   AE82         MOV     R6,DPL
   \   000162   AF83         MOV     R7,DPH
   1685              *pTmp++ = pBeacon->protocolVersion;
   \   000164   85..82       MOV     DPL,?V0 + 0
   \   000167   85..83       MOV     DPH,?V0 + 1
   \   00016A   A3           INC     DPTR
   \   00016B   A3           INC     DPTR
   \   00016C   A3           INC     DPTR
   \   00016D   A3           INC     DPTR
   \   00016E   A3           INC     DPTR
   \   00016F   A3           INC     DPTR
   \   000170   A3           INC     DPTR
   \   000171   A3           INC     DPTR
   \   000172   E0           MOVX    A,@DPTR
   \   000173   8E82         MOV     DPL,R6
   \   000175   8F83         MOV     DPH,R7
   \   000177   F0           MOVX    @DPTR,A
   \   000178   8E82         MOV     DPL,R6
   \   00017A   8F83         MOV     DPH,R7
   \   00017C   A3           INC     DPTR
   \   00017D   AE82         MOV     R6,DPL
   \   00017F   AF83         MOV     R7,DPH
   1686              *pTmp++ = pBeacon->stackProfile;
   \   000181   85..82       MOV     DPL,?V0 + 0
   \   000184   85..83       MOV     DPH,?V0 + 1
   \   000187   A3           INC     DPTR
   \   000188   A3           INC     DPTR
   \   000189   A3           INC     DPTR
   \   00018A   A3           INC     DPTR
   \   00018B   A3           INC     DPTR
   \   00018C   A3           INC     DPTR
   \   00018D   A3           INC     DPTR
   \   00018E   A3           INC     DPTR
   \   00018F   A3           INC     DPTR
   \   000190   E0           MOVX    A,@DPTR
   \   000191   8E82         MOV     DPL,R6
   \   000193   8F83         MOV     DPH,R7
   \   000195   F0           MOVX    @DPTR,A
   \   000196   8E82         MOV     DPL,R6
   \   000198   8F83         MOV     DPH,R7
   \   00019A   A3           INC     DPTR
   \   00019B   AE82         MOV     R6,DPL
   \   00019D   AF83         MOV     R7,DPH
   1687              *pTmp++ = pBeacon->LQI;
   \   00019F   85..82       MOV     DPL,?V0 + 0
   \   0001A2   85..83       MOV     DPH,?V0 + 1
   \   0001A5   A3           INC     DPTR
   \   0001A6   A3           INC     DPTR
   \   0001A7   A3           INC     DPTR
   \   0001A8   A3           INC     DPTR
   \   0001A9   A3           INC     DPTR
   \   0001AA   A3           INC     DPTR
   \   0001AB   A3           INC     DPTR
   \   0001AC   A3           INC     DPTR
   \   0001AD   A3           INC     DPTR
   \   0001AE   A3           INC     DPTR
   \   0001AF   E0           MOVX    A,@DPTR
   \   0001B0   8E82         MOV     DPL,R6
   \   0001B2   8F83         MOV     DPH,R7
   \   0001B4   F0           MOVX    @DPTR,A
   \   0001B5   8E82         MOV     DPL,R6
   \   0001B7   8F83         MOV     DPH,R7
   \   0001B9   A3           INC     DPTR
   \   0001BA   AE82         MOV     R6,DPL
   \   0001BC   AF83         MOV     R7,DPH
   1688              *pTmp++ = pBeacon->depth;
   \   0001BE   E5..         MOV     A,?V0 + 0
   \   0001C0   240B         ADD     A,#0xb
   \   0001C2   F582         MOV     DPL,A
   \   0001C4   E5..         MOV     A,?V0 + 1
   \   0001C6   3400         ADDC    A,#0x0
   \   0001C8   F583         MOV     DPH,A
   \   0001CA   E0           MOVX    A,@DPTR
   \   0001CB   8E82         MOV     DPL,R6
   \   0001CD   8F83         MOV     DPH,R7
   \   0001CF   F0           MOVX    @DPTR,A
   \   0001D0   8E82         MOV     DPL,R6
   \   0001D2   8F83         MOV     DPH,R7
   \   0001D4   A3           INC     DPTR
   \   0001D5   AE82         MOV     R6,DPL
   \   0001D7   AF83         MOV     R7,DPH
   1689              *pTmp++ = pBeacon->updateID;
   \   0001D9   E5..         MOV     A,?V0 + 0
   \   0001DB   240C         ADD     A,#0xc
   \   0001DD   F582         MOV     DPL,A
   \   0001DF   E5..         MOV     A,?V0 + 1
   \   0001E1   3400         ADDC    A,#0x0
   \   0001E3   F583         MOV     DPH,A
   \   0001E5   E0           MOVX    A,@DPTR
   \   0001E6   8E82         MOV     DPL,R6
   \   0001E8   8F83         MOV     DPH,R7
   \   0001EA   F0           MOVX    @DPTR,A
   \   0001EB   8E82         MOV     DPL,R6
   \   0001ED   8F83         MOV     DPH,R7
   \   0001EF   A3           INC     DPTR
   \   0001F0   AE82         MOV     R6,DPL
   \   0001F2   AF83         MOV     R7,DPH
   1690              osal_memcpy( pTmp, pBeacon->extendedPanID, Z_EXTADDR_LEN);
   \   0001F4                ; Setup parameters for call to function osal_memcpy
   \   0001F4   E5..         MOV     A,?V0 + 0
   \   0001F6   240D         ADD     A,#0xd
   \   0001F8   F5..         MOV     ?V0 + 4,A
   \   0001FA   E5..         MOV     A,?V0 + 1
   \   0001FC   3400         ADDC    A,#0x0
   \   0001FE   F5..         MOV     ?V0 + 5,A
   \   000200   75..00       MOV     ?V0 + 6,#0x0
   \   000203   78..         MOV     R0,#?V0 + 4
   \   000205   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000208   7C08         MOV     R4,#0x8
   \   00020A   7D00         MOV     R5,#0x0
   \   00020C   EE           MOV     A,R6
   \   00020D   FA           MOV     R2,A
   \   00020E   EF           MOV     A,R7
   \   00020F   FB           MOV     R3,A
   \   000210   12....       LCALL   ??osal_memcpy?relay
   \   000213   7403         MOV     A,#0x3
   \   000215   12....       LCALL   ?DEALLOC_XSTACK8
   1691          
   1692              pBeaconIndBuf[0] += 1; // Increment the devCnt
   \   000218   90....       MOV     DPTR,#pBeaconIndBuf
   \   00021B   E0           MOVX    A,@DPTR
   \   00021C   F8           MOV     R0,A
   \   00021D   A3           INC     DPTR
   \   00021E   E0           MOVX    A,@DPTR
   \   00021F   F583         MOV     DPH,A
   \   000221   8882         MOV     DPL,R0
   \   000223   E0           MOVX    A,@DPTR
   \   000224   2401         ADD     A,#0x1
   \   000226   F0           MOVX    @DPTR,A
   1693          
   1694              // Check if the buffer can fit in another beacon
   1695              if( ((pBeaconIndBuf[0] + 1) * MT_ZDO_BEACON_IND_LEN + 1) > MT_ZDO_BEACON_IND_PACK_LEN )
   \   000227   90....       MOV     DPTR,#pBeaconIndBuf
   \   00022A   E0           MOVX    A,@DPTR
   \   00022B   F8           MOV     R0,A
   \   00022C   A3           INC     DPTR
   \   00022D   E0           MOVX    A,@DPTR
   \   00022E   F583         MOV     DPH,A
   \   000230   8882         MOV     DPL,R0
   \   000232   E0           MOVX    A,@DPTR
   \   000233   F8           MOV     R0,A
   \   000234   7900         MOV     R1,#0x0
   \   000236   E8           MOV     A,R0
   \   000237   75F015       MOV     B,#0x15
   \   00023A   A4           MUL     AB
   \   00023B   C8           XCH     A,R0
   \   00023C   AAF0         MOV     R2,B
   \   00023E   75F000       MOV     B,#0x0
   \   000241   A4           MUL     AB
   \   000242   2A           ADD     A,R2
   \   000243   FA           MOV     R2,A
   \   000244   75F015       MOV     B,#0x15
   \   000247   E9           MOV     A,R1
   \   000248   A4           MUL     AB
   \   000249   2A           ADD     A,R2
   \   00024A   F9           MOV     R1,A
   \   00024B   E8           MOV     A,R0
   \   00024C   2416         ADD     A,#0x16
   \   00024E   F8           MOV     R0,A
   \   00024F   E9           MOV     A,R1
   \   000250   3400         ADDC    A,#0x0
   \   000252   F9           MOV     R1,A
   \   000253   C3           CLR     C
   \   000254   E8           MOV     A,R0
   \   000255   947C         SUBB    A,#0x7c
   \   000257   E9           MOV     A,R1
   \   000258   9400         SUBB    A,#0x0
   \   00025A   A2D2         MOV     C,0xD0 /* PSW */.2
   \   00025C   65D0         XRL     A,PSW
   \   00025E   33           RLC     A
   \   00025F   5003         JNC     $+5
   \   000261   02....       LJMP    ??MT_ZdoBeaconIndCB_4 & 0xFFFF
   1696              {
   1697                // Packet full, send the packet over MT
   1698                MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   1699                                             MT_ZDO_BEACON_NOTIFY_IND,
   1700                                             (pBeaconIndBuf[0] * MT_ZDO_BEACON_IND_LEN + 1), pBeaconIndBuf);
   \   000264                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000264   90....       MOV     DPTR,#pBeaconIndBuf
   \   000267   E0           MOVX    A,@DPTR
   \   000268   FC           MOV     R4,A
   \   000269   A3           INC     DPTR
   \   00026A   E0           MOVX    A,@DPTR
   \   00026B   FD           MOV     R5,A
   \   00026C   75F015       MOV     B,#0x15
   \   00026F   90....       MOV     DPTR,#pBeaconIndBuf
   \   000272   E0           MOVX    A,@DPTR
   \   000273   F8           MOV     R0,A
   \   000274   A3           INC     DPTR
   \   000275   E0           MOVX    A,@DPTR
   \   000276   F583         MOV     DPH,A
   \   000278   8882         MOV     DPL,R0
   \   00027A   E0           MOVX    A,@DPTR
   \   00027B   A4           MUL     AB
   \   00027C   2401         ADD     A,#0x1
   \   00027E   FB           MOV     R3,A
   \   00027F   7AC5         MOV     R2,#-0x3b
   \   000281   7945         MOV     R1,#0x45
   \   000283   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1701                pBeaconIndBuf[0] = 0; // Reset the devCnt back to zero
   \   000286   90....       MOV     DPTR,#pBeaconIndBuf
   \   000289   E0           MOVX    A,@DPTR
   \   00028A   F8           MOV     R0,A
   \   00028B   A3           INC     DPTR
   \   00028C   E0           MOVX    A,@DPTR
   \   00028D   F583         MOV     DPH,A
   \   00028F   8882         MOV     DPL,R0
   \   000291   7400         MOV     A,#0x0
   \   000293   F0           MOVX    @DPTR,A
   \   000294   805D         SJMP    ??MT_ZdoBeaconIndCB_4
   1702              }
   1703            }
   1704            else
   1705            {
   1706              if( (pBeaconIndBuf != NULL) && (pBeaconIndBuf[0] != 0) )
   \                     ??MT_ZdoBeaconIndCB_0:
   \   000296   90....       MOV     DPTR,#pBeaconIndBuf
   \   000299   E0           MOVX    A,@DPTR
   \   00029A   F8           MOV     R0,A
   \   00029B   A3           INC     DPTR
   \   00029C   E0           MOVX    A,@DPTR
   \   00029D   F9           MOV     R1,A
   \   00029E   E8           MOV     A,R0
   \   00029F   49           ORL     A,R1
   \   0002A0   6030         JZ      ??MT_ZdoBeaconIndCB_5
   \   0002A2   90....       MOV     DPTR,#pBeaconIndBuf
   \   0002A5   E0           MOVX    A,@DPTR
   \   0002A6   F8           MOV     R0,A
   \   0002A7   A3           INC     DPTR
   \   0002A8   E0           MOVX    A,@DPTR
   \   0002A9   F583         MOV     DPH,A
   \   0002AB   8882         MOV     DPL,R0
   \   0002AD   E0           MOVX    A,@DPTR
   \   0002AE   6022         JZ      ??MT_ZdoBeaconIndCB_5
   1707              {
   1708                // End of beacon indication, send the packet over MT
   1709                MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   1710                                             MT_ZDO_BEACON_NOTIFY_IND,
   1711                                             (pBeaconIndBuf[0] * MT_ZDO_BEACON_IND_LEN + 1), pBeaconIndBuf);
   \   0002B0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0002B0   90....       MOV     DPTR,#pBeaconIndBuf
   \   0002B3   E0           MOVX    A,@DPTR
   \   0002B4   FC           MOV     R4,A
   \   0002B5   A3           INC     DPTR
   \   0002B6   E0           MOVX    A,@DPTR
   \   0002B7   FD           MOV     R5,A
   \   0002B8   75F015       MOV     B,#0x15
   \   0002BB   90....       MOV     DPTR,#pBeaconIndBuf
   \   0002BE   E0           MOVX    A,@DPTR
   \   0002BF   F8           MOV     R0,A
   \   0002C0   A3           INC     DPTR
   \   0002C1   E0           MOVX    A,@DPTR
   \   0002C2   F583         MOV     DPH,A
   \   0002C4   8882         MOV     DPL,R0
   \   0002C6   E0           MOVX    A,@DPTR
   \   0002C7   A4           MUL     AB
   \   0002C8   2401         ADD     A,#0x1
   \   0002CA   FB           MOV     R3,A
   \   0002CB   7AC5         MOV     R2,#-0x3b
   \   0002CD   7945         MOV     R1,#0x45
   \   0002CF   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1712              }
   1713              // Free the allocated memory
   1714              if(pBeaconIndBuf != NULL)
   \                     ??MT_ZdoBeaconIndCB_5:
   \   0002D2   90....       MOV     DPTR,#pBeaconIndBuf
   \   0002D5   E0           MOVX    A,@DPTR
   \   0002D6   F8           MOV     R0,A
   \   0002D7   A3           INC     DPTR
   \   0002D8   E0           MOVX    A,@DPTR
   \   0002D9   F9           MOV     R1,A
   \   0002DA   E8           MOV     A,R0
   \   0002DB   49           ORL     A,R1
   \   0002DC   6015         JZ      ??MT_ZdoBeaconIndCB_4
   1715              {
   1716                osal_mem_free(pBeaconIndBuf);
   \   0002DE                ; Setup parameters for call to function osal_mem_free
   \   0002DE   90....       MOV     DPTR,#pBeaconIndBuf
   \   0002E1   E0           MOVX    A,@DPTR
   \   0002E2   FA           MOV     R2,A
   \   0002E3   A3           INC     DPTR
   \   0002E4   E0           MOVX    A,@DPTR
   \   0002E5   FB           MOV     R3,A
   \   0002E6   12....       LCALL   ??osal_mem_free?relay
   1717                pBeaconIndBuf = NULL;
   \   0002E9   90....       MOV     DPTR,#pBeaconIndBuf
   \   0002EC   7400         MOV     A,#0x0
   \   0002EE   F0           MOVX    @DPTR,A
   \   0002EF   A3           INC     DPTR
   \   0002F0   7400         MOV     A,#0x0
   \   0002F2   F0           MOVX    @DPTR,A
   1718              }
   1719            }
   1720          
   1721            return NULL;
   \                     ??MT_ZdoBeaconIndCB_4:
   \   0002F3   7A00         MOV     R2,#0x0
   \   0002F5   7B00         MOV     R3,#0x0
   \                     ??MT_ZdoBeaconIndCB_3:
   \   0002F7   7F07         MOV     R7,#0x7
   \   0002F9   02....       LJMP    ?BANKED_LEAVE_XDATA
   1722          }
   1723          
   1724          
   1725          
   1726          /***************************************************************************************************
   1727           * @fn          MT_ZdoJoinCnfCB
   1728           *
   1729           * @brief       Handle the ZDO Join Confirm from ZDO
   1730           *
   1731           * @param       pStr - pointer to a parameter and a structure of parameters
   1732           *
   1733           * @return      void
   1734           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1735          void *MT_ZdoJoinCnfCB ( void *pStr )
   \                     MT_ZdoJoinCnfCB:
   1736          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
   1737            /* pStr: zdoJoinCnf_t* */
   1738            /* Packet Format */
   1739            /* Status (1) | device addr (2) | parent addr (2) */
   1740          
   1741            uint8 buf[MT_ZDO_JOIN_CNF_LEN];
   1742            zdoJoinCnf_t *joinCnf = pStr;
   \   00000E   AE..         MOV     R6,?V0 + 0
   \   000010   AF..         MOV     R7,?V0 + 1
   1743          
   1744            /* Join Complete. De-register the callback with ZDO */
   1745            ZDO_DeregisterForZdoCB( ZDO_JOIN_CNF_CBID );
   \   000012                ; Setup parameters for call to function ZDO_DeregisterForZdoCB
   \   000012   7904         MOV     R1,#0x4
   \   000014   12....       LCALL   ??ZDO_DeregisterForZdoCB?relay
   \   000017   E9           MOV     A,R1
   1746          
   1747            buf[0] = joinCnf->status;
   \   000018   8E82         MOV     DPL,R6
   \   00001A   8F83         MOV     DPH,R7
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   F0           MOVX    @DPTR,A
   1748            buf[1] = LO_UINT16( joinCnf->deviceAddr );
   \   000024   8E82         MOV     DPL,R6
   \   000026   8F83         MOV     DPH,R7
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F8           MOV     R0,A
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   F9           MOV     R1,A
   \   00002E   E8           MOV     A,R0
   \   00002F   C0E0         PUSH    A
   \   000031   7401         MOV     A,#0x1
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   D0E0         POP     A
   \   000038   F0           MOVX    @DPTR,A
   1749            buf[2] = HI_UINT16( joinCnf->deviceAddr );
   \   000039   8E82         MOV     DPL,R6
   \   00003B   8F83         MOV     DPH,R7
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F8           MOV     R0,A
   \   000040   A3           INC     DPTR
   \   000041   E0           MOVX    A,@DPTR
   \   000042   F9           MOV     R1,A
   \   000043   E4           CLR     A
   \   000044   E9           MOV     A,R1
   \   000045   F8           MOV     R0,A
   \   000046   C0E0         PUSH    A
   \   000048   7402         MOV     A,#0x2
   \   00004A   12....       LCALL   ?XSTACK_DISP0_8
   \   00004D   D0E0         POP     A
   \   00004F   F0           MOVX    @DPTR,A
   1750            buf[3] = LO_UINT16( joinCnf->parentAddr );
   \   000050   8E82         MOV     DPL,R6
   \   000052   8F83         MOV     DPH,R7
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   F8           MOV     R0,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   F9           MOV     R1,A
   \   00005C   E8           MOV     A,R0
   \   00005D   C0E0         PUSH    A
   \   00005F   7403         MOV     A,#0x3
   \   000061   12....       LCALL   ?XSTACK_DISP0_8
   \   000064   D0E0         POP     A
   \   000066   F0           MOVX    @DPTR,A
   1751            buf[4] = HI_UINT16( joinCnf->parentAddr );
   \   000067   8E82         MOV     DPL,R6
   \   000069   8F83         MOV     DPH,R7
   \   00006B   A3           INC     DPTR
   \   00006C   A3           INC     DPTR
   \   00006D   A3           INC     DPTR
   \   00006E   E0           MOVX    A,@DPTR
   \   00006F   F8           MOV     R0,A
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   F9           MOV     R1,A
   \   000073   E4           CLR     A
   \   000074   E9           MOV     A,R1
   \   000075   F8           MOV     R0,A
   \   000076   C0E0         PUSH    A
   \   000078   7404         MOV     A,#0x4
   \   00007A   12....       LCALL   ?XSTACK_DISP0_8
   \   00007D   D0E0         POP     A
   \   00007F   F0           MOVX    @DPTR,A
   1752          
   1753            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   1754                                         MT_ZDO_JOIN_CNF, MT_ZDO_JOIN_CNF_LEN, buf);
   \   000080                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000080   85..82       MOV     DPL,?XSP + 0
   \   000083   85..83       MOV     DPH,?XSP + 1
   \   000086   AC82         MOV     R4,DPL
   \   000088   AD83         MOV     R5,DPH
   \   00008A   7B05         MOV     R3,#0x5
   \   00008C   7AC6         MOV     R2,#-0x3a
   \   00008E   7945         MOV     R1,#0x45
   \   000090   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1755          
   1756            return NULL;
   \   000093   7A00         MOV     R2,#0x0
   \   000095   7B00         MOV     R3,#0x0
   \   000097   7405         MOV     A,#0x5
   \   000099   12....       LCALL   ?DEALLOC_XSTACK8
   \   00009C   7F02         MOV     R7,#0x2
   \   00009E   02....       LJMP    ?BANKED_LEAVE_XDATA
   1757          }
   1758          
   1759          /*************************************************************************************************
   1760           * @fn      MT_ZdoRegisterForZDOMsg(pBuf);
   1761           *
   1762           * @brief   MT proxy for ZDO_RegisterForZDOMsg.
   1763           *
   1764           * @param   pBuf  - MT message data
   1765           *
   1766           * @return  void
   1767           *************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1768          void MT_ZdoRegisterForZDOMsg(uint8 *pBuf)
   \                     MT_ZdoRegisterForZDOMsg:
   1769          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1770            uint8 cmd0, cmd1, tmp;
   1771            uint16 cId;
   1772          
   1773            /* parse header */
   1774            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 2,A
   1775            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   000016   8E82         MOV     DPL,R6
   \   000018   8F83         MOV     DPH,R7
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 3,A
   1776            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001F   EE           MOV     A,R6
   \   000020   2403         ADD     A,#0x3
   \   000022   FE           MOV     R6,A
   \   000023   EF           MOV     A,R7
   \   000024   3400         ADDC    A,#0x0
   \   000026   FF           MOV     R7,A
   1777          
   1778            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   88..         MOV     ?V0 + 0,R0
   \   000043   89..         MOV     ?V0 + 1,R1
   1779            tmp = ZDO_RegisterForZDOMsg(MT_TaskID, cId);
   \   000045                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000045   AA..         MOV     R2,?V0 + 0
   \   000047   AB..         MOV     R3,?V0 + 1
   \   000049   90....       MOV     DPTR,#MT_TaskID
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F9           MOV     R1,A
   \   00004E   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000051   E9           MOV     A,R1
   \   000052   85..82       MOV     DPL,?XSP + 0
   \   000055   85..83       MOV     DPH,?XSP + 1
   \   000058   F0           MOVX    @DPTR,A
   1780          
   1781            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \   000059   74E0         MOV     A,#-0x20
   \   00005B   55..         ANL     A,?V0 + 2
   \   00005D   6420         XRL     A,#0x20
   \   00005F   7013         JNZ     ??MT_ZdoRegisterForZDOMsg_0
   1782            {
   1783              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_ZDO), cmd1, 1, &tmp);
   \   000061                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000061   85..82       MOV     DPL,?XSP + 0
   \   000064   85..83       MOV     DPH,?XSP + 1
   \   000067   AC82         MOV     R4,DPL
   \   000069   AD83         MOV     R5,DPH
   \   00006B   7B01         MOV     R3,#0x1
   \   00006D   AA..         MOV     R2,?V0 + 3
   \   00006F   7965         MOV     R1,#0x65
   \   000071   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1784            }
   1785          }
   \                     ??MT_ZdoRegisterForZDOMsg_0:
   \   000074   7401         MOV     A,#0x1
   \   000076   12....       LCALL   ?DEALLOC_XSTACK8
   \   000079   7F04         MOV     R7,#0x4
   \   00007B   02....       LJMP    ?BANKED_LEAVE_XDATA
   1786          
   1787          /*************************************************************************************************
   1788           * @fn      MT_ZdoRemoveRegisteredCB(pBuf);
   1789           *
   1790           * @brief   MT proxy for ZDO_RemoveRegisteredCB.
   1791           *
   1792           * @param   pBuf  - MT message data
   1793           *
   1794           * @return  void
   1795           *************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1796          void MT_ZdoRemoveRegisteredCB(uint8 *pBuf)
   \                     MT_ZdoRemoveRegisteredCB:
   1797          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1798            uint8 cmd0, cmd1, tmp;
   1799            uint16 cId;
   1800          
   1801            /* parse header */
   1802            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 2,A
   1803            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   000016   8E82         MOV     DPL,R6
   \   000018   8F83         MOV     DPH,R7
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 3,A
   1804            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001F   EE           MOV     A,R6
   \   000020   2403         ADD     A,#0x3
   \   000022   FE           MOV     R6,A
   \   000023   EF           MOV     A,R7
   \   000024   3400         ADDC    A,#0x0
   \   000026   FF           MOV     R7,A
   1805          
   1806            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   FA           MOV     R2,A
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   8E82         MOV     DPL,R6
   \   000031   8F83         MOV     DPH,R7
   \   000033   A3           INC     DPTR
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   7900         MOV     R1,#0x0
   \   000038   E4           CLR     A
   \   000039   C8           XCH     A,R0
   \   00003A   F9           MOV     R1,A
   \   00003B   EA           MOV     A,R2
   \   00003C   28           ADD     A,R0
   \   00003D   F8           MOV     R0,A
   \   00003E   EB           MOV     A,R3
   \   00003F   39           ADDC    A,R1
   \   000040   F9           MOV     R1,A
   \   000041   88..         MOV     ?V0 + 0,R0
   \   000043   89..         MOV     ?V0 + 1,R1
   1807            tmp = ZDO_RemoveRegisteredCB(MT_TaskID, cId);
   \   000045                ; Setup parameters for call to function ZDO_RemoveRegisteredCB
   \   000045   AA..         MOV     R2,?V0 + 0
   \   000047   AB..         MOV     R3,?V0 + 1
   \   000049   90....       MOV     DPTR,#MT_TaskID
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   F9           MOV     R1,A
   \   00004E   12....       LCALL   ??ZDO_RemoveRegisteredCB?relay
   \   000051   E9           MOV     A,R1
   \   000052   85..82       MOV     DPL,?XSP + 0
   \   000055   85..83       MOV     DPH,?XSP + 1
   \   000058   F0           MOVX    @DPTR,A
   1808          
   1809            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \   000059   74E0         MOV     A,#-0x20
   \   00005B   55..         ANL     A,?V0 + 2
   \   00005D   6420         XRL     A,#0x20
   \   00005F   7013         JNZ     ??MT_ZdoRemoveRegisteredCB_0
   1810            {
   1811              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_ZDO), cmd1, 1, &tmp);
   \   000061                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000061   85..82       MOV     DPL,?XSP + 0
   \   000064   85..83       MOV     DPH,?XSP + 1
   \   000067   AC82         MOV     R4,DPL
   \   000069   AD83         MOV     R5,DPH
   \   00006B   7B01         MOV     R3,#0x1
   \   00006D   AA..         MOV     R2,?V0 + 3
   \   00006F   7965         MOV     R1,#0x65
   \   000071   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1812            }
   1813          }
   \                     ??MT_ZdoRemoveRegisteredCB_0:
   \   000074   7401         MOV     A,#0x1
   \   000076   12....       LCALL   ?DEALLOC_XSTACK8
   \   000079   7F04         MOV     R7,#0x4
   \   00007B   02....       LJMP    ?BANKED_LEAVE_XDATA
   1814          
   1815          #endif /* MT_ZDO_FUNC */
   1816          
   1817          
   1818          /***************************************************************************************************
   1819           * Callback handling function
   1820           ***************************************************************************************************/
   1821          
   1822          #if defined (MT_ZDO_CB_FUNC)
   1823          
   1824          /***************************************************************************************************
   1825           * @fn      MT_ZdoStateChangeCB
   1826           *
   1827           * @brief   Handle state change OSAL message from ZDO.
   1828           *
   1829           * @param   pMsg  - Message data
   1830           *
   1831           * @return  void
   1832           */
   1833          void MT_ZdoStateChangeCB(osal_event_hdr_t *pMsg)
   1834          {
   1835            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   1836                                                 MT_ZDO_STATE_CHANGE_IND, 1, &pMsg->status);
   1837          }
   1838          
   1839          /***************************************************************************************************
   1840           * @fn     MT_ZdoDirectCB()
   1841           *
   1842           * @brief  ZDO direct callback.  Build an MT message directly from the
   1843           *         over-the-air ZDO message.
   1844           *
   1845           * @param  pData - Incoming AF frame.
   1846           *
   1847           * @return  none
   1848           ***************************************************************************************************/
   1849          void MT_ZdoDirectCB( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg )
   1850          {
   1851            uint8 len, *pBuf;
   1852            uint16 origClusterId;
   1853          
   1854            // save original value because MT_ZdoHandleExceptions() function could modify pData->clusterId
   1855            origClusterId = pData->clusterId;
   1856          
   1857            // Is the message an exception or not a response?
   1858            if ( MT_ZdoHandleExceptions( pData, inMsg ) || ( (origClusterId & ZDO_RESPONSE_BIT) == 0 ) )
   1859            {
   1860              return;  // Handled somewhere else or not needed.
   1861            }
   1862          
   1863            /* ZDO data starts after one-byte sequence number and the msg buffer length includes
   1864             * two bytes for srcAddr.
   1865             */
   1866            len = pData->cmd.DataLength - 1 + sizeof(uint16);
   1867          
   1868            if (NULL != (pBuf = (uint8 *)osal_mem_alloc(len)))
   1869            {
   1870              uint8 id = MT_ZDO_CID_TO_AREQ_ID(pData->clusterId);
   1871          
   1872              pBuf[0] = LO_UINT16(pData->srcAddr.addr.shortAddr);
   1873              pBuf[1] = HI_UINT16(pData->srcAddr.addr.shortAddr);
   1874          
   1875              /* copy ZDO data, skipping one-byte sequence number */
   1876              osal_memcpy(pBuf+2, (pData->cmd.Data + 1), pData->cmd.DataLength-1);
   1877          
   1878              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO), id, len, pBuf);
   1879              osal_mem_free(pBuf);
   1880            }
   1881          }
   1882          
   1883          /***************************************************************************************************
   1884           * @fn     MT_ZdoHandleExceptions()
   1885           *
   1886           * @brief  Handles all messages that are an exception to the generic MT ZDO Response.
   1887           *
   1888           * @param  pData - Incoming AF frame.
   1889           *
   1890           * @return  TRUE if handled by this function, FALSE if not
   1891           ***************************************************************************************************/
   1892          uint8 MT_ZdoHandleExceptions( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg )
   1893          {
   1894            uint8 ret = TRUE;
   1895            ZDO_NwkIEEEAddrResp_t *nwkRsp;
   1896            ZDO_DeviceAnnce_t devAnnce;
   1897            uint8 doDefault = FALSE;
   1898          
   1899            switch ( inMsg->clusterID )
   1900            {
   1901              case NWK_addr_rsp:
   1902              case IEEE_addr_rsp:
   1903                if ( NULL != (nwkRsp = ZDO_ParseAddrRsp(inMsg)) )
   1904                {
   1905                  if ( nwkRsp->status == ZDO_SUCCESS )
   1906                  {
   1907                    MT_ZdoAddrRspCB( nwkRsp, inMsg->clusterID );
   1908                  }
   1909                  osal_mem_free( nwkRsp );
   1910                }
   1911                break;
   1912          
   1913              case Device_annce:
   1914                ZDO_ParseDeviceAnnce( inMsg, &devAnnce );
   1915                MT_ZdoEndDevAnnceCB( &devAnnce, inMsg->srcAddr.addr.shortAddr );
   1916                break;
   1917          
   1918              case Simple_Desc_rsp:
   1919                if ( pData->cmd.DataLength > 5 )
   1920                {
   1921                  ret = FALSE;
   1922                }
   1923                else
   1924                {
   1925                  doDefault = TRUE;
   1926                }
   1927                break;
   1928          
   1929              default:
   1930                ret = FALSE;
   1931                break;
   1932            }
   1933          
   1934            if ( doDefault )
   1935            {
   1936              ret = FALSE;
   1937              pData->clusterId = MtZdoDef_rsp;
   1938              pData->cmd.DataLength = 2;
   1939            }
   1940          
   1941            return ( ret );
   1942          }
   1943          
   1944          /***************************************************************************************************
   1945           * @fn      MT_ZdoAddrRspCB
   1946           *
   1947           * @brief   Handle IEEE or nwk address response OSAL message from ZDO.
   1948           *
   1949           * @param   pMsg  - Message data
   1950           *
   1951           * @return  void
   1952           */
   1953          void MT_ZdoAddrRspCB( ZDO_NwkIEEEAddrResp_t *pMsg, uint16 clusterID )
   1954          {
   1955            uint8   listLen, len, *pBuf;
   1956          
   1957            /* both ZDO_NwkAddrResp_t and ZDO_IEEEAddrResp_t must be the same */
   1958          
   1959            /* get length, sanity check length */
   1960            listLen = pMsg->numAssocDevs;
   1961          
   1962            /* calculate msg length */
   1963            len = MT_ZDO_ADDR_RSP_LEN + (listLen * sizeof(uint16));
   1964          
   1965            /* get buffer */
   1966            if (NULL != (pBuf = (uint8 *)osal_mem_alloc(len)))
   1967            {
   1968              uint8 id = MT_ZDO_CID_TO_AREQ_ID(clusterID);
   1969              uint8 *pTmp = pBuf;
   1970          
   1971              *pTmp++ = pMsg->status;
   1972          
   1973              osal_cpyExtAddr(pTmp, pMsg->extAddr);
   1974              pTmp += Z_EXTADDR_LEN;
   1975          
   1976              *pTmp++ = LO_UINT16(pMsg->nwkAddr);
   1977              *pTmp++ = HI_UINT16(pMsg->nwkAddr);
   1978          
   1979              *pTmp++ = pMsg->startIndex;
   1980              *pTmp++ = listLen;
   1981          
   1982              MT_Word2Buf(pTmp, pMsg->devList, listLen);
   1983          
   1984              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO), id, len, pBuf);
   1985              osal_mem_free(pBuf);
   1986            }
   1987          }
   1988          
   1989          /***************************************************************************************************
   1990           * @fn      MT_ZdoEndDevAnnceCB
   1991           *
   1992           * @brief   Handle end device announce OSAL message from ZDO.
   1993           *
   1994           * @param   pMsg  - Message data
   1995           *
   1996           * @return  void
   1997           */
   1998          void MT_ZdoEndDevAnnceCB( ZDO_DeviceAnnce_t *pMsg, uint16 srcAddr )
   1999          {
   2000            uint8 *pBuf;
   2001          
   2002            if (NULL != (pBuf = (uint8 *)osal_mem_alloc(MT_ZDO_END_DEVICE_ANNCE_IND_LEN)))
   2003            {
   2004              uint8 *pTmp = pBuf;
   2005          
   2006              *pTmp++ = LO_UINT16(srcAddr);
   2007              *pTmp++ = HI_UINT16(srcAddr);
   2008          
   2009              *pTmp++ = LO_UINT16(pMsg->nwkAddr);
   2010              *pTmp++ = HI_UINT16(pMsg->nwkAddr);
   2011          
   2012              osal_cpyExtAddr(pTmp, pMsg->extAddr);
   2013              pTmp += Z_EXTADDR_LEN;
   2014          
   2015              *pTmp = pMsg->capabilities;
   2016          
   2017              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   2018                                                   MT_ZDO_END_DEVICE_ANNCE_IND,
   2019                                                   MT_ZDO_END_DEVICE_ANNCE_IND_LEN, pBuf);
   2020              osal_mem_free(pBuf);
   2021            }
   2022          }
   2023          
   2024          /***************************************************************************************************
   2025           * @fn      MT_ZdoSrcRtgCB
   2026           *
   2027           * @brief   Handle Src Route from ZDO.
   2028           *
   2029           * @param   pStr  - pointer to the data structure for the src route
   2030           *
   2031           * @return  void*
   2032           */
   2033          void* MT_ZdoSrcRtgCB( void *pStr )
   2034          {
   2035            uint8 len, *pBuf;
   2036            zdoSrcRtg_t *pSrcRtg = pStr;
   2037          
   2038            // srcAddr (2) + relayCnt (1) + relayList( relaycnt * 2 )
   2039            len = 2 + 1 + pSrcRtg->relayCnt * sizeof(uint16);
   2040          
   2041            if (NULL != (pBuf = (uint8 *)osal_mem_alloc(len)))
   2042            {
   2043              uint8 idx, *pTmp = pBuf;
   2044              uint16 *pRelay;
   2045          
   2046              // Packet payload
   2047              *pTmp++ = LO_UINT16(pSrcRtg->srcAddr);
   2048              *pTmp++ = HI_UINT16(pSrcRtg->srcAddr);
   2049              *pTmp++ = pSrcRtg->relayCnt;
   2050          
   2051              // Relay List
   2052              if( ( pRelay = pSrcRtg->pRelayList ) != NULL )
   2053              {
   2054                for( idx = 0; idx < pSrcRtg->relayCnt; idx ++ )
   2055                {
   2056                  *pTmp++ = LO_UINT16(*pRelay);
   2057                  *pTmp++ = HI_UINT16(*pRelay);
   2058                  pRelay++;
   2059                }
   2060              }
   2061              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   2062                                                   MT_ZDO_SRC_RTG_IND, len, pBuf);
   2063              osal_mem_free(pBuf);
   2064            }
   2065          
   2066            return NULL;
   2067          }
   2068          
   2069          /***************************************************************************************************
   2070           * @fn          MT_ZdoConcentratorIndCB
   2071           *
   2072           * @brief       Handle the ZDO Concentrator Indication callback from the ZDO.
   2073           *
   2074           * @param       pStr - pointer to a parameter and a structure of parameters
   2075           *
   2076           * @return      NULL
   2077           ***************************************************************************************************/
   2078          static void *MT_ZdoConcentratorIndCB(void *pStr)
   2079          {
   2080            uint8 buf[MT_ZDO_CONCENTRATOR_IND_LEN], *pTmp = buf;
   2081            zdoConcentratorInd_t *pInd = (zdoConcentratorInd_t *)pStr;
   2082          
   2083            *pTmp++ = LO_UINT16(pInd->nwkAddr);
   2084            *pTmp++ = HI_UINT16(pInd->nwkAddr);
   2085            pTmp = osal_memcpy(pTmp, pInd->extAddr, Z_EXTADDR_LEN);
   2086            *pTmp = pInd->pktCost;
   2087          
   2088            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   2089                                              MT_ZDO_CONCENTRATOR_IND_CB, MT_ZDO_CONCENTRATOR_IND_LEN, buf);
   2090            return NULL;
   2091          }
   2092          
   2093          /***************************************************************************************************
   2094           * @fn          MT_ZdoLeaveInd
   2095           *
   2096           * @brief       Handle the ZDO Leave Indication callback from the ZDO.
   2097           *
   2098           * @param       vPtr - Pointer to the received Leave Indication message.
   2099           *
   2100           * @return      NULL
   2101           ***************************************************************************************************/
   2102          static void *MT_ZdoLeaveInd(void *vPtr)
   2103          {
   2104            NLME_LeaveInd_t *pInd = (NLME_LeaveInd_t *)vPtr;
   2105            uint8 buf[sizeof(NLME_LeaveInd_t)];
   2106          
   2107            buf[0] = LO_UINT16(pInd->srcAddr);
   2108            buf[1] = HI_UINT16(pInd->srcAddr);
   2109            (void)osal_memcpy(buf+2, pInd->extAddr, Z_EXTADDR_LEN);
   2110            buf[2+Z_EXTADDR_LEN] = pInd->request;
   2111            buf[3+Z_EXTADDR_LEN] = pInd->removeChildren;
   2112            buf[4+Z_EXTADDR_LEN] = pInd->rejoin;
   2113          
   2114            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   2115                                                 MT_ZDO_LEAVE_IND, 5+Z_EXTADDR_LEN, buf);
   2116            return NULL;
   2117          }
   2118          #endif // MT_ZDO_CB_FUNC
   2119          
   2120          /***************************************************************************************************
   2121           * @fn      MT_ZdoSendMsgCB
   2122           *
   2123           * @brief   Proxy the ZDO_SendMsgCBs one message at a time.
   2124           *
   2125           * @param   pMsg  - Message data
   2126           *
   2127           * @return  void
   2128           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2129          void MT_ZdoSendMsgCB(zdoIncomingMsg_t *pMsg)
   \                     MT_ZdoSendMsgCB:
   2130          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   2131            uint8 len = pMsg->asduLen + 9;
   \   000009   E5..         MOV     A,?V0 + 0
   \   00000B   2410         ADD     A,#0x10
   \   00000D   F582         MOV     DPL,A
   \   00000F   E5..         MOV     A,?V0 + 1
   \   000011   3400         ADDC    A,#0x0
   \   000013   F583         MOV     DPH,A
   \   000015   E0           MOVX    A,@DPTR
   \   000016   2409         ADD     A,#0x9
   \   000018   F5..         MOV     ?V0 + 7,A
   2132            uint8 *pBuf = (uint8 *)osal_mem_alloc(len);
   \   00001A                ; Setup parameters for call to function osal_mem_alloc
   \   00001A   85....       MOV     ?V0 + 2,?V0 + 7
   \   00001D   75..00       MOV     ?V0 + 3,#0x0
   \   000020   AA..         MOV     R2,?V0 + 2
   \   000022   AB..         MOV     R3,?V0 + 3
   \   000024   12....       LCALL   ??osal_mem_alloc?relay
   \   000027   8A..         MOV     ?V0 + 4,R2
   \   000029   8B..         MOV     ?V0 + 5,R3
   \   00002B   85....       MOV     ?V0 + 2,?V0 + 4
   \   00002E   85....       MOV     ?V0 + 3,?V0 + 5
   2133          
   2134            if (pBuf != NULL)
   \   000031   E5..         MOV     A,?V0 + 2
   \   000033   45..         ORL     A,?V0 + 3
   \   000035   7003         JNZ     $+5
   \   000037   02....       LJMP    ??MT_ZdoSendMsgCB_0 & 0xFFFF
   2135            {
   2136              uint8 *pTmp = pBuf;
   \   00003A   AE..         MOV     R6,?V0 + 2
   \   00003C   AF..         MOV     R7,?V0 + 3
   2137          
   2138              // Assuming exclusive use of network short addresses.
   2139              *pTmp++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   00003E   85..82       MOV     DPL,?V0 + 0
   \   000041   85..83       MOV     DPH,?V0 + 1
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   E0           MOVX    A,@DPTR
   \   000047   F8           MOV     R0,A
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F9           MOV     R1,A
   \   00004B   E8           MOV     A,R0
   \   00004C   8E82         MOV     DPL,R6
   \   00004E   8F83         MOV     DPH,R7
   \   000050   F0           MOVX    @DPTR,A
   \   000051   8E82         MOV     DPL,R6
   \   000053   8F83         MOV     DPH,R7
   \   000055   A3           INC     DPTR
   \   000056   AE82         MOV     R6,DPL
   \   000058   AF83         MOV     R7,DPH
   2140              *pTmp++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   00005A   85..82       MOV     DPL,?V0 + 0
   \   00005D   85..83       MOV     DPH,?V0 + 1
   \   000060   A3           INC     DPTR
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   F8           MOV     R0,A
   \   000064   A3           INC     DPTR
   \   000065   E0           MOVX    A,@DPTR
   \   000066   F9           MOV     R1,A
   \   000067   E4           CLR     A
   \   000068   E9           MOV     A,R1
   \   000069   F8           MOV     R0,A
   \   00006A   8E82         MOV     DPL,R6
   \   00006C   8F83         MOV     DPH,R7
   \   00006E   F0           MOVX    @DPTR,A
   \   00006F   8E82         MOV     DPL,R6
   \   000071   8F83         MOV     DPH,R7
   \   000073   A3           INC     DPTR
   \   000074   AE82         MOV     R6,DPL
   \   000076   AF83         MOV     R7,DPH
   2141              *pTmp++ = pMsg->wasBroadcast;
   \   000078   E5..         MOV     A,?V0 + 0
   \   00007A   240B         ADD     A,#0xb
   \   00007C   F582         MOV     DPL,A
   \   00007E   E5..         MOV     A,?V0 + 1
   \   000080   3400         ADDC    A,#0x0
   \   000082   F583         MOV     DPH,A
   \   000084   E0           MOVX    A,@DPTR
   \   000085   8E82         MOV     DPL,R6
   \   000087   8F83         MOV     DPH,R7
   \   000089   F0           MOVX    @DPTR,A
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   A3           INC     DPTR
   \   00008F   AE82         MOV     R6,DPL
   \   000091   AF83         MOV     R7,DPH
   2142              *pTmp++ = LO_UINT16(pMsg->clusterID);
   \   000093   E5..         MOV     A,?V0 + 0
   \   000095   240C         ADD     A,#0xc
   \   000097   F582         MOV     DPL,A
   \   000099   E5..         MOV     A,?V0 + 1
   \   00009B   3400         ADDC    A,#0x0
   \   00009D   F583         MOV     DPH,A
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   F8           MOV     R0,A
   \   0000A1   A3           INC     DPTR
   \   0000A2   E0           MOVX    A,@DPTR
   \   0000A3   F9           MOV     R1,A
   \   0000A4   E8           MOV     A,R0
   \   0000A5   8E82         MOV     DPL,R6
   \   0000A7   8F83         MOV     DPH,R7
   \   0000A9   F0           MOVX    @DPTR,A
   \   0000AA   8E82         MOV     DPL,R6
   \   0000AC   8F83         MOV     DPH,R7
   \   0000AE   A3           INC     DPTR
   \   0000AF   AE82         MOV     R6,DPL
   \   0000B1   AF83         MOV     R7,DPH
   2143              *pTmp++ = HI_UINT16(pMsg->clusterID);
   \   0000B3   E5..         MOV     A,?V0 + 0
   \   0000B5   240C         ADD     A,#0xc
   \   0000B7   F582         MOV     DPL,A
   \   0000B9   E5..         MOV     A,?V0 + 1
   \   0000BB   3400         ADDC    A,#0x0
   \   0000BD   F583         MOV     DPH,A
   \   0000BF   E0           MOVX    A,@DPTR
   \   0000C0   F8           MOV     R0,A
   \   0000C1   A3           INC     DPTR
   \   0000C2   E0           MOVX    A,@DPTR
   \   0000C3   F9           MOV     R1,A
   \   0000C4   E4           CLR     A
   \   0000C5   E9           MOV     A,R1
   \   0000C6   F8           MOV     R0,A
   \   0000C7   8E82         MOV     DPL,R6
   \   0000C9   8F83         MOV     DPH,R7
   \   0000CB   F0           MOVX    @DPTR,A
   \   0000CC   8E82         MOV     DPL,R6
   \   0000CE   8F83         MOV     DPH,R7
   \   0000D0   A3           INC     DPTR
   \   0000D1   AE82         MOV     R6,DPL
   \   0000D3   AF83         MOV     R7,DPH
   2144              *pTmp++ = pMsg->SecurityUse;
   \   0000D5   E5..         MOV     A,?V0 + 0
   \   0000D7   240E         ADD     A,#0xe
   \   0000D9   F582         MOV     DPL,A
   \   0000DB   E5..         MOV     A,?V0 + 1
   \   0000DD   3400         ADDC    A,#0x0
   \   0000DF   F583         MOV     DPH,A
   \   0000E1   E0           MOVX    A,@DPTR
   \   0000E2   8E82         MOV     DPL,R6
   \   0000E4   8F83         MOV     DPH,R7
   \   0000E6   F0           MOVX    @DPTR,A
   \   0000E7   8E82         MOV     DPL,R6
   \   0000E9   8F83         MOV     DPH,R7
   \   0000EB   A3           INC     DPTR
   \   0000EC   AE82         MOV     R6,DPL
   \   0000EE   AF83         MOV     R7,DPH
   2145              *pTmp++ = pMsg->TransSeq;
   \   0000F0   E5..         MOV     A,?V0 + 0
   \   0000F2   240F         ADD     A,#0xf
   \   0000F4   F582         MOV     DPL,A
   \   0000F6   E5..         MOV     A,?V0 + 1
   \   0000F8   3400         ADDC    A,#0x0
   \   0000FA   F583         MOV     DPH,A
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   8E82         MOV     DPL,R6
   \   0000FF   8F83         MOV     DPH,R7
   \   000101   F0           MOVX    @DPTR,A
   \   000102   8E82         MOV     DPL,R6
   \   000104   8F83         MOV     DPH,R7
   \   000106   A3           INC     DPTR
   \   000107   AE82         MOV     R6,DPL
   \   000109   AF83         MOV     R7,DPH
   2146              // Skipping asduLen since it can be deduced from the RPC packet length.
   2147              *pTmp++ = LO_UINT16(pMsg->macDestAddr);
   \   00010B   E5..         MOV     A,?V0 + 0
   \   00010D   2411         ADD     A,#0x11
   \   00010F   F582         MOV     DPL,A
   \   000111   E5..         MOV     A,?V0 + 1
   \   000113   3400         ADDC    A,#0x0
   \   000115   F583         MOV     DPH,A
   \   000117   E0           MOVX    A,@DPTR
   \   000118   F8           MOV     R0,A
   \   000119   A3           INC     DPTR
   \   00011A   E0           MOVX    A,@DPTR
   \   00011B   F9           MOV     R1,A
   \   00011C   E8           MOV     A,R0
   \   00011D   8E82         MOV     DPL,R6
   \   00011F   8F83         MOV     DPH,R7
   \   000121   F0           MOVX    @DPTR,A
   \   000122   8E82         MOV     DPL,R6
   \   000124   8F83         MOV     DPH,R7
   \   000126   A3           INC     DPTR
   \   000127   AE82         MOV     R6,DPL
   \   000129   AF83         MOV     R7,DPH
   2148              *pTmp++ = HI_UINT16(pMsg->macDestAddr);
   \   00012B   E5..         MOV     A,?V0 + 0
   \   00012D   2411         ADD     A,#0x11
   \   00012F   F582         MOV     DPL,A
   \   000131   E5..         MOV     A,?V0 + 1
   \   000133   3400         ADDC    A,#0x0
   \   000135   F583         MOV     DPH,A
   \   000137   E0           MOVX    A,@DPTR
   \   000138   F8           MOV     R0,A
   \   000139   A3           INC     DPTR
   \   00013A   E0           MOVX    A,@DPTR
   \   00013B   F9           MOV     R1,A
   \   00013C   E4           CLR     A
   \   00013D   E9           MOV     A,R1
   \   00013E   F8           MOV     R0,A
   \   00013F   8E82         MOV     DPL,R6
   \   000141   8F83         MOV     DPH,R7
   \   000143   F0           MOVX    @DPTR,A
   \   000144   8E82         MOV     DPL,R6
   \   000146   8F83         MOV     DPH,R7
   \   000148   A3           INC     DPTR
   \   000149   AE82         MOV     R6,DPL
   \   00014B   AF83         MOV     R7,DPH
   2149              (void)osal_memcpy(pTmp, pMsg->asdu, pMsg->asduLen);
   \   00014D                ; Setup parameters for call to function osal_memcpy
   \   00014D   E5..         MOV     A,?V0 + 0
   \   00014F   2413         ADD     A,#0x13
   \   000151   F582         MOV     DPL,A
   \   000153   E5..         MOV     A,?V0 + 1
   \   000155   3400         ADDC    A,#0x0
   \   000157   F583         MOV     DPH,A
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   F5..         MOV     ?V0 + 4,A
   \   00015C   A3           INC     DPTR
   \   00015D   E0           MOVX    A,@DPTR
   \   00015E   F5..         MOV     ?V0 + 5,A
   \   000160   75..00       MOV     ?V0 + 6,#0x0
   \   000163   78..         MOV     R0,#?V0 + 4
   \   000165   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000168   E5..         MOV     A,?V0 + 0
   \   00016A   2410         ADD     A,#0x10
   \   00016C   F582         MOV     DPL,A
   \   00016E   E5..         MOV     A,?V0 + 1
   \   000170   3400         ADDC    A,#0x0
   \   000172   F583         MOV     DPH,A
   \   000174   E0           MOVX    A,@DPTR
   \   000175   FC           MOV     R4,A
   \   000176   7D00         MOV     R5,#0x0
   \   000178   EE           MOV     A,R6
   \   000179   FA           MOV     R2,A
   \   00017A   EF           MOV     A,R7
   \   00017B   FB           MOV     R3,A
   \   00017C   12....       LCALL   ??osal_memcpy?relay
   \   00017F   7403         MOV     A,#0x3
   \   000181   12....       LCALL   ?DEALLOC_XSTACK8
   \   000184   8A..         MOV     ?V0 + 8,R2
   \   000186   8B..         MOV     ?V0 + 9,R3
   \   000188   85....       MOV     ?V0 + 4,?V0 + 8
   \   00018B   85....       MOV     ?V0 + 5,?V0 + 9
   2150          
   2151              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   2152                                                   MT_ZDO_MSG_CB_INCOMING, len, pBuf);
   \   00018E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00018E   AC..         MOV     R4,?V0 + 2
   \   000190   AD..         MOV     R5,?V0 + 3
   \   000192   AB..         MOV     R3,?V0 + 7
   \   000194   7AFF         MOV     R2,#-0x1
   \   000196   7945         MOV     R1,#0x45
   \   000198   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   2153          
   2154              osal_mem_free(pBuf);
   \   00019B                ; Setup parameters for call to function osal_mem_free
   \   00019B   AA..         MOV     R2,?V0 + 2
   \   00019D   AB..         MOV     R3,?V0 + 3
   \   00019F   12....       LCALL   ??osal_mem_free?relay
   2155            }
   2156          }
   \                     ??MT_ZdoSendMsgCB_0:
   \   0001A2   7F0A         MOV     R7,#0xa
   \   0001A4   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoNWKAddressRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoNWKAddressRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoIEEEAddrRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoIEEEAddrRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoNodeDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoNodeDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoPowerDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoPowerDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoSimpleDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoSimpleDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoActiveEpRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoActiveEpRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoMatchDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoMatchDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoComplexDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoComplexDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoUserDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoUserDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoEndDevAnnce?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoEndDevAnnce

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoUserDescSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoUserDescSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoServiceDiscRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoServiceDiscRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoEndDevBindRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoEndDevBindRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoBindRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoBindRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoUnbindRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoUnbindRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoStartupFromApp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoStartupFromApp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoNetworkDiscoveryReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoNetworkDiscoveryReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoJoinReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoJoinReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoNwkDiscoveryCnfCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoNwkDiscoveryCnfCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoBeaconIndCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoBeaconIndCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoJoinCnfCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoJoinCnfCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoRegisterForZDOMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoRegisterForZDOMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoRemoveRegisteredCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoRemoveRegisteredCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoSendMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoSendMsgCB
   2157          
   2158          #endif   /*ZDO Command Processing in MT*/
   2159          /***************************************************************************************************
   2160          ***************************************************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_ZdoActiveEpRequest              1      0     32
       -> ZDP_NWKAddrOfInterestReq      0      0     46
       -> MT_BuildAndSendZToolResponse
                                        0      0     44
     MT_ZdoBeaconIndCB                  1      0     27
       -> osal_mem_alloc                0      0     30
       -> osal_memcpy                   0      0     36
       -> MT_BuildAndSendZToolResponse
                                        0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30
       -> osal_mem_free                 0      0     30
     MT_ZdoBindRequest                  1      0     56
       -> sAddrExtCpy                   0      0     78
       -> ZDP_BindUnbindReq             0      0     94
       -> MT_BuildAndSendZToolResponse
                                        0      0     78
     MT_ZdoCommandProcessing            0      0      9
       -> MT_ZdoNWKAddressRequest       0      0     18
       -> MT_ZdoIEEEAddrRequest         0      0     18
       -> MT_ZdoNodeDescRequest         0      0     18
       -> MT_ZdoPowerDescRequest        0      0     18
       -> MT_ZdoSimpleDescRequest       0      0     18
       -> MT_ZdoActiveEpRequest         0      0     18
       -> MT_ZdoMatchDescRequest        0      0     18
       -> MT_ZdoComplexDescRequest      0      0     18
       -> MT_ZdoUserDescRequest         0      0     18
       -> MT_ZdoEndDevAnnce             0      0     18
       -> MT_ZdoUserDescSet             0      0     18
       -> MT_ZdoServiceDiscRequest      0      0     18
       -> MT_ZdoEndDevBindRequest       0      0     18
       -> MT_ZdoBindRequest             0      0     18
       -> MT_ZdoUnbindRequest           0      0     18
       -> MT_ZdoNetworkDiscoveryReq     0      0     18
       -> MT_ZdoJoinReq                 0      0     18
       -> MT_ZdoStartupFromApp          0      0     18
       -> MT_ZdoRegisterForZDOMsg       0      0     18
       -> MT_ZdoRemoveRegisteredCB      0      0     18
     MT_ZdoComplexDescRequest           1      0     32
       -> ZDP_NWKAddrOfInterestReq      0      0     46
       -> MT_BuildAndSendZToolResponse
                                        0      0     44
     MT_ZdoEndDevAnnce                  1      0     25
       -> ZDP_DeviceAnnce               0      0     32
       -> MT_BuildAndSendZToolResponse
                                        0      0     30
     MT_ZdoEndDevBindRequest            1      0    107
       -> ZDP_EndDeviceBindReq          0      0    196
       -> MT_BuildAndSendZToolResponse
                                        0      0    178
     MT_ZdoIEEEAddrRequest              1      0     23
       -> ZDP_IEEEAddrReq               0      0     28
       -> MT_BuildAndSendZToolResponse
                                        0      0     28
     MT_ZdoInit                         0      0      0
     MT_ZdoJoinCnfCB                    1      0     15
       -> ZDO_DeregisterForZdoCB        0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30
     MT_ZdoJoinReq                      1      0     28
       -> ZDApp_JoinReq                 0      0     38
       -> ZDO_RegisterForZdoCB          0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30
     MT_ZdoMatchDescRequest             1      0    109
       -> ZDP_MatchDescReq              0      0    200
       -> MT_BuildAndSendZToolResponse
                                        0      0    184
     MT_ZdoNWKAddressRequest            1      0     23
       -> ZDP_NwkAddrReq                0      0     28
       -> MT_BuildAndSendZToolResponse
                                        0      0     28
     MT_ZdoNetworkDiscoveryReq          1      0     30
       -> osal_build_uint32             0      0     42
       -> ZDApp_NetworkDiscoveryReq     0      0     42
       -> ZDO_RegisterForZdoCB          0      0     42
       -> ZDO_RegisterForZdoCB          0      0     42
       -> MT_BuildAndSendZToolResponse
                                        0      0     42
     MT_ZdoNodeDescRequest              1      0     32
       -> ZDP_NWKAddrOfInterestReq      0      0     46
       -> MT_BuildAndSendZToolResponse
                                        0      0     44
     MT_ZdoNwkDiscoveryCnfCB            0      0      9
       -> ZDO_DeregisterForZdoCB        0      0     18
       -> ZDO_DeregisterForZdoCB        0      0     18
       -> MT_ZdoBeaconIndCB             0      0     18
       -> MT_BuildAndSendZToolResponse
                                        0      0     18
     MT_ZdoPowerDescRequest             1      0     32
       -> ZDP_NWKAddrOfInterestReq      0      0     46
       -> MT_BuildAndSendZToolResponse
                                        0      0     44
     MT_ZdoRegisterForZDOMsg            1      0     22
       -> ZDO_RegisterForZDOMsg         0      0     26
       -> MT_BuildAndSendZToolResponse
                                        0      0     26
     MT_ZdoRemoveRegisteredCB           1      0     22
       -> ZDO_RemoveRegisteredCB        0      0     26
       -> MT_BuildAndSendZToolResponse
                                        0      0     26
     MT_ZdoSendMsgCB                    1      0     21
       -> osal_mem_alloc                0      0     36
       -> osal_memcpy                   0      0     42
       -> MT_BuildAndSendZToolResponse
                                        0      0     36
       -> osal_mem_free                 0      0     36
     MT_ZdoServiceDiscRequest           1      0     21
       -> ZDP_ServerDiscReq             0      0     24
       -> MT_BuildAndSendZToolResponse
                                        0      0     24
     MT_ZdoSimpleDescRequest            1      0     33
       -> ZDP_SimpleDescReq             0      0     48
       -> MT_BuildAndSendZToolResponse
                                        0      0     46
     MT_ZdoStartupFromApp               1      0     20
       -> ZDOInitDevice                 0      0     22
       -> MT_BuildAndSendZToolResponse
                                        0      0     22
     MT_ZdoUnbindRequest                1      0     56
       -> sAddrExtCpy                   0      0     78
       -> ZDP_BindUnbindReq             0      0     94
       -> MT_BuildAndSendZToolResponse
                                        0      0     78
     MT_ZdoUserDescRequest              1      0     32
       -> ZDP_NWKAddrOfInterestReq      0      0     46
       -> MT_BuildAndSendZToolResponse
                                        0      0     44
     MT_ZdoUserDescSet                  1      0     54
       -> osal_memcpy                   0      0     90
       -> ZDP_UserDescSet               0      0     88
       -> MT_BuildAndSendZToolResponse
                                        0      0     84


   Segment part sizes:

     Function/Label                    Bytes
     --------------                    -----
     _zdoCallbackSub                      4
     pBeaconIndBuf                        2
     MT_ZdoInit                           3
     MT_ZdoCommandProcessing            335
     MT_ZdoNWKAddressRequest            116
     MT_ZdoIEEEAddrRequest              142
     MT_ZdoNodeDescRequest              189
     MT_ZdoPowerDescRequest             189
     MT_ZdoSimpleDescRequest            205
     MT_ZdoActiveEpRequest              189
     MT_ZdoMatchDescRequest             545
     MT_ZdoComplexDescRequest           189
     MT_ZdoUserDescRequest              189
     MT_ZdoEndDevAnnce                  148
     MT_ZdoUserDescSet                  267
     MT_ZdoServiceDiscRequest           115
     MT_ZdoEndDevBindRequest            578
     MT_ZdoBindRequest                  359
     MT_ZdoUnbindRequest                359
     MT_ZdoStartupFromApp                91
     MT_ZdoNetworkDiscoveryReq          151
     MT_ZdoJoinReq                      227
     MT_ZdoNwkDiscoveryCnfCB             50
     MT_ZdoBeaconIndCB                  764
     MT_ZdoJoinCnfCB                    161
     MT_ZdoRegisterForZDOMsg            126
     MT_ZdoRemoveRegisteredCB           126
     MT_ZdoSendMsgCB                    423
     ??MT_ZdoInit?relay                   6
     ??MT_ZdoCommandProcessing?relay      6
     ??MT_ZdoNWKAddressRequest?relay      6
     ??MT_ZdoIEEEAddrRequest?relay        6
     ??MT_ZdoNodeDescRequest?relay        6
     ??MT_ZdoPowerDescRequest?relay       6
     ??MT_ZdoSimpleDescRequest?relay      6
     ??MT_ZdoActiveEpRequest?relay        6
     ??MT_ZdoMatchDescRequest?relay       6
     ??MT_ZdoComplexDescRequest?relay     6
     ??MT_ZdoUserDescRequest?relay        6
     ??MT_ZdoEndDevAnnce?relay            6
     ??MT_ZdoUserDescSet?relay            6
     ??MT_ZdoServiceDiscRequest?relay     6
     ??MT_ZdoEndDevBindRequest?relay      6
     ??MT_ZdoBindRequest?relay            6
     ??MT_ZdoUnbindRequest?relay          6
     ??MT_ZdoStartupFromApp?relay         6
     ??MT_ZdoNetworkDiscoveryReq?relay    6
     ??MT_ZdoJoinReq?relay                6
     ??MT_ZdoNwkDiscoveryCnfCB?relay      6
     ??MT_ZdoBeaconIndCB?relay            6
     ??MT_ZdoJoinCnfCB?relay              6
     ??MT_ZdoRegisterForZDOMsg?relay      6
     ??MT_ZdoRemoveRegisteredCB?relay     6
     ??MT_ZdoSendMsgCB?relay              6

 
 6 236 bytes in segment BANKED_CODE
   156 bytes in segment BANK_RELAYS
     6 bytes in segment XDATA_Z
 
 6 392 bytes of CODE  memory
     6 bytes of XDATA memory

Errors: none
Warnings: none
