###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.40194/W32 for 8051         03/Sep/2015  13:14:13 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Componen #
#                          ts\mt\DebugTrace.c                                 #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\To #
#                          ols\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ            #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "C:\Texas         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\Tools\CC2530DB\ #
#                          f8wConfig.cfg" (-DZIGBEEPRO -DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.5.1a\Components\mt\Deb #
#                          ugTrace.c" -D ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC   #
#                          -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC          #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp\CC2530DB\RouterEB\List\ #
#                          " -lA "C:\Texas Instruments\ZStack-CC2530-2.5.1a\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\RouterEB #
#                          \List\" --diag_suppress Pe001,Pa010 -o "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\RouterEB\Obj\" -e        #
#                          --no_cse --no_unroll --no_inline --no_code_motion  #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\" -I        #
#                          "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Samples\SampleApp\CC2530DB\..\Source\"    #
#                          -I "C:\Texas Instruments\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\ZM #
#                          ain\TI2530DB\" -I "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\hal\include\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\hal\target\CC2530EB\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\include\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\high_level\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\low_level\srf04\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mac\low_level\srf04\single_chip\" -I "C:\Texas   #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\mt\" -I "C:\Texas Instruments\ZStack-CC2530-2.5. #
#                          1a\Projects\zstack\Samples\SampleApp\CC2530DB\..\. #
#                          .\..\..\..\Components\osal\include\" -I "C:\Texas  #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\services\saddr\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\services\sdata\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\af\" -I "C:\Texas                          #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\nwk\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sapi\" -I "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sec\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\sys\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\stack\zdo\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.5.1a\Projects\zstack\S #
#                          amples\SampleApp\CC2530DB\..\..\..\..\..\Component #
#                          s\zmac\" -I "C:\Texas Instruments\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Samples\SampleApp\CC2530DB\.. #
#                          \..\..\..\..\Components\zmac\f8w\" -On             #
#                          --require_prototypes                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\SampleApp\CC2530DB\RouterEB\List\D #
#                          ebugTrace.lst                                      #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.5.1a\Projects #
#                          \zstack\Samples\SampleApp\CC2530DB\RouterEB\Obj\De #
#                          bugTrace.r51                                       #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.5.1a\Components\mt\DebugTrace.c
      1          /**************************************************************************************************
      2            Filename:       DebugTrace.c
      3            Revised:        $Date: 2008-01-17 12:22:57 -0800 (Thu, 17 Jan 2008) $
      4            Revision:       $Revision: 16223 $
      5          
      6          
      7            Description:    This interface provides quick one-function-call functions to
      8                            Monitor and Test reporting mechanisms.
      9          
     10          
     11            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     12          
     13            IMPORTANT: Your use of this Software is limited to those specific rights
     14            granted under the terms of a software license agreement between the user
     15            who downloaded the software, his/her employer (which must be your employer)
     16            and Texas Instruments Incorporated (the "License").  You may not use this
     17            Software unless you agree to abide by the terms of the License. The License
     18            limits your use, and you acknowledge, that the Software may not be modified,
     19            copied or distributed unless embedded on a Texas Instruments microcontroller
     20            or used solely and exclusively in conjunction with a Texas Instruments radio
     21            frequency transceiver, which is integrated into your product.  Other than for
     22            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     23            works of, modify, distribute, perform, display or sell this Software and/or
     24            its documentation for any purpose.
     25          
     26            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     27            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     28            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     29            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     30            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     31            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     32            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     33            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     34            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     35            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     36            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     37          
     38            Should you have any questions regarding your right to use this Software,
     39            contact Texas Instruments Incorporated at www.TI.com.
     40          
     41          **************************************************************************************************/
     42          
     43          #if defined( MT_TASK ) || defined( APP_DEBUG )
     44          
     45          /*********************************************************************
     46           * INCLUDES
     47           */
     48          #include "ZComDef.h"
     49          #include "OSAL.h"
     50          #include "MT.h"
     51          #include "MT_TASK.h"
     52          #include "MT_DEBUG.h"
     53          #include "DebugTrace.h"
     54          
     55          #if defined ( APP_DEBUG )
     56            #include "DebugApp.h"
     57          #endif
     58          
     59           /*********************************************************************
     60           * MACROS
     61           */
     62          
     63          /*********************************************************************
     64           * CONSTANTS
     65           */
     66          
     67          
     68          /*********************************************************************
     69           * TYPEDEFS
     70           */
     71          
     72          /*********************************************************************
     73           * GLOBAL VARIABLES
     74           */
     75          
     76          /*********************************************************************
     77           * EXTERNAL VARIABLES
     78           */
     79          
     80          /*********************************************************************
     81           * EXTERNAL FUNCTIONS
     82           */
     83          
     84           /*********************************************************************
     85           * LOCAL VARIABLES
     86           */
     87          
     88          /*********************************************************************
     89           * LOCAL FUNCTIONS
     90           */
     91          
     92          /*********************************************************************
     93           * @fn      debug_msg
     94           *
     95           * @brief
     96           *
     97           *   This feature allows modules to display debug information as
     98           *   applications execute in real-time.  This feature will work similar
     99           *   to "printf()" but will output to the serial port for display in
    100           *   the Z-Test tool.
    101           *
    102           *   This feature will most likely be compiled out in the production code
    103           *   to save code space.
    104           *
    105           * @param   byte compID - Component ID
    106           * @param   byte severity - CRITICAL(0x01), ERROR(0x02), INFORMATION(0x03)
    107           *                          or TRACE(0x04)
    108           * @param   byte numParams - number of parameter fields (param1-3)
    109           * @param   UINT16 param1 - user defined data
    110           * @param   UINT16 param2 - user defined data
    111           * @param   UINT16 param3 - user defined data
    112           *
    113           * @return  void
    114           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    115          void debug_msg( byte compID, byte severity, byte numParams, UINT16 param1,
   \                     debug_msg:
    116          																								UINT16 param2, UINT16 param3 )
    117          {
   \   000000   74EA         MOV     A,#-0x16
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 22
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 6,R1
   \   000007   8A..         MOV     ?V0 + 7,R2
   \   000009   8B..         MOV     ?V0 + 8,R3
   \   00000B   8C..         MOV     ?V0 + 12,R4
   \   00000D   8D..         MOV     ?V0 + 13,R5
   \   00000F   7416         MOV     A,#0x16
   \   000011   12....       LCALL   ?XSTACK_DISP0_8
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 1,A
   \   00001B   7418         MOV     A,#0x18
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 2,A
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F5..         MOV     ?V0 + 3,A
    118          
    119            mtDebugMsg_t *mtDebugMsg;
    120            UINT16 timestamp;
    121          
    122            if ( debugThreshold == 0 || debugCompId != compID )
   \   000027   90....       MOV     DPTR,#debugThreshold
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   6008         JZ      ??debug_msg_0
   \   00002D   90....       MOV     DPTR,#debugCompId
   \   000030   E0           MOVX    A,@DPTR
   \   000031   65..         XRL     A,?V0 + 6
   \   000033   6003         JZ      ??debug_msg_1
    123              return;
   \                     ??debug_msg_0:
   \   000035   02....       LJMP    ??debug_msg_2 & 0xFFFF
    124          
    125            // Fill in the timestamp
    126            timestamp = 0;
   \                     ??debug_msg_1:
   \   000038   75..00       MOV     ?V0 + 4,#0x0
   \   00003B   75..00       MOV     ?V0 + 5,#0x0
    127          
    128            // Get a message buffer to build the debug message
    129            mtDebugMsg = (mtDebugMsg_t *)osal_msg_allocate( sizeof( mtDebugMsg_t ) );
   \   00003E                ; Setup parameters for call to function osal_msg_allocate
   \   00003E   7A0D         MOV     R2,#0xd
   \   000040   7B00         MOV     R3,#0x0
   \   000042   12....       LCALL   ??osal_msg_allocate?relay
   \   000045   8A..         MOV     ?V0 + 10,R2
   \   000047   8B..         MOV     ?V0 + 11,R3
   \   000049   AE..         MOV     R6,?V0 + 10
   \   00004B   AF..         MOV     R7,?V0 + 11
    130            if ( mtDebugMsg )
   \   00004D   EE           MOV     A,R6
   \   00004E   4F           ORL     A,R7
   \   00004F   607F         JZ      ??debug_msg_2
    131            {
    132                mtDebugMsg->hdr.event = CMD_DEBUG_MSG;
   \   000051   8E82         MOV     DPL,R6
   \   000053   8F83         MOV     DPH,R7
   \   000055   7402         MOV     A,#0x2
   \   000057   F0           MOVX    @DPTR,A
    133                mtDebugMsg->compID = compID;
   \   000058   E5..         MOV     A,?V0 + 6
   \   00005A   8E82         MOV     DPL,R6
   \   00005C   8F83         MOV     DPH,R7
   \   00005E   A3           INC     DPTR
   \   00005F   A3           INC     DPTR
   \   000060   E5..         MOV     A,?V0 + 6
   \   000062   F0           MOVX    @DPTR,A
    134                mtDebugMsg->severity = severity;
   \   000063   E5..         MOV     A,?V0 + 7
   \   000065   8E82         MOV     DPL,R6
   \   000067   8F83         MOV     DPH,R7
   \   000069   A3           INC     DPTR
   \   00006A   A3           INC     DPTR
   \   00006B   A3           INC     DPTR
   \   00006C   E5..         MOV     A,?V0 + 7
   \   00006E   F0           MOVX    @DPTR,A
    135                mtDebugMsg->numParams = numParams;
   \   00006F   E5..         MOV     A,?V0 + 8
   \   000071   8E82         MOV     DPL,R6
   \   000073   8F83         MOV     DPH,R7
   \   000075   A3           INC     DPTR
   \   000076   A3           INC     DPTR
   \   000077   A3           INC     DPTR
   \   000078   A3           INC     DPTR
   \   000079   E5..         MOV     A,?V0 + 8
   \   00007B   F0           MOVX    @DPTR,A
    136          
    137                mtDebugMsg->param1 = param1;
   \   00007C   8E82         MOV     DPL,R6
   \   00007E   8F83         MOV     DPH,R7
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   A3           INC     DPTR
   \   000084   A3           INC     DPTR
   \   000085   E5..         MOV     A,?V0 + 12
   \   000087   F0           MOVX    @DPTR,A
   \   000088   A3           INC     DPTR
   \   000089   E5..         MOV     A,?V0 + 13
   \   00008B   F0           MOVX    @DPTR,A
    138                mtDebugMsg->param2 = param2;
   \   00008C   8E82         MOV     DPL,R6
   \   00008E   8F83         MOV     DPH,R7
   \   000090   A3           INC     DPTR
   \   000091   A3           INC     DPTR
   \   000092   A3           INC     DPTR
   \   000093   A3           INC     DPTR
   \   000094   A3           INC     DPTR
   \   000095   A3           INC     DPTR
   \   000096   A3           INC     DPTR
   \   000097   E5..         MOV     A,?V0 + 0
   \   000099   F0           MOVX    @DPTR,A
   \   00009A   A3           INC     DPTR
   \   00009B   E5..         MOV     A,?V0 + 1
   \   00009D   F0           MOVX    @DPTR,A
    139                mtDebugMsg->param3 = param3;
   \   00009E   8E82         MOV     DPL,R6
   \   0000A0   8F83         MOV     DPH,R7
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   A3           INC     DPTR
   \   0000A7   A3           INC     DPTR
   \   0000A8   A3           INC     DPTR
   \   0000A9   A3           INC     DPTR
   \   0000AA   A3           INC     DPTR
   \   0000AB   E5..         MOV     A,?V0 + 2
   \   0000AD   F0           MOVX    @DPTR,A
   \   0000AE   A3           INC     DPTR
   \   0000AF   E5..         MOV     A,?V0 + 3
   \   0000B1   F0           MOVX    @DPTR,A
    140                mtDebugMsg->timestamp = timestamp;
   \   0000B2   EE           MOV     A,R6
   \   0000B3   240B         ADD     A,#0xb
   \   0000B5   F582         MOV     DPL,A
   \   0000B7   EF           MOV     A,R7
   \   0000B8   3400         ADDC    A,#0x0
   \   0000BA   F583         MOV     DPH,A
   \   0000BC   E5..         MOV     A,?V0 + 4
   \   0000BE   F0           MOVX    @DPTR,A
   \   0000BF   A3           INC     DPTR
   \   0000C0   E5..         MOV     A,?V0 + 5
   \   0000C2   F0           MOVX    @DPTR,A
    141          
    142                osal_msg_send( MT_TaskID, (uint8 *)mtDebugMsg );
   \   0000C3                ; Setup parameters for call to function osal_msg_send
   \   0000C3   EE           MOV     A,R6
   \   0000C4   FA           MOV     R2,A
   \   0000C5   EF           MOV     A,R7
   \   0000C6   FB           MOV     R3,A
   \   0000C7   90....       MOV     DPTR,#MT_TaskID
   \   0000CA   E0           MOVX    A,@DPTR
   \   0000CB   F9           MOV     R1,A
   \   0000CC   12....       LCALL   ??osal_msg_send?relay
   \   0000CF   E9           MOV     A,R1
    143            }
    144          
    145          } /* debug_msg() */
   \                     ??debug_msg_2:
   \   0000D0   7F0E         MOV     R7,#0xe
   \   0000D2   02....       LJMP    ?BANKED_LEAVE_XDATA
    146          
    147          /*********************************************************************
    148           * @fn      debug_str
    149           *
    150           * @brief
    151           *
    152           *   This feature allows modules to display a debug text string as
    153           *   applications execute in real-time. This feature will output to
    154           *   the serial port for display in the Z-Test tool.
    155           *
    156           *   This feature will most likely be compiled out in the production
    157           *   code in order to save code space.
    158           *
    159           * @param   byte *str_ptr - pointer to null-terminated string
    160           *
    161           * @return  void
    162           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    163          void debug_str( byte *str_ptr )
   \                     debug_str:
    164          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    165            mtDebugStr_t *msg;
    166            byte mln;
    167            byte strLen;
    168          
    169            // Text string length
    170            strLen = (byte)osal_strlen( (void*)str_ptr );
   \   000009                ; Setup parameters for call to function osal_strlen
   \   000009   EE           MOV     A,R6
   \   00000A   FA           MOV     R2,A
   \   00000B   EF           MOV     A,R7
   \   00000C   FB           MOV     R3,A
   \   00000D   12....       LCALL   ??osal_strlen?relay
   \   000010   EA           MOV     A,R2
   \   000011   F5..         MOV     ?V0 + 3,A
    171          
    172            // Debug string message length
    173            mln = sizeof ( mtDebugStr_t ) + strLen;
   \   000013   7405         MOV     A,#0x5
   \   000015   25..         ADD     A,?V0 + 3
   \   000017   F5..         MOV     ?V0 + 2,A
    174          
    175            // Get a message buffer to build the debug message
    176            msg = (mtDebugStr_t *)osal_msg_allocate( mln );
   \   000019                ; Setup parameters for call to function osal_msg_allocate
   \   000019   85....       MOV     ?V0 + 4,?V0 + 2
   \   00001C   75..00       MOV     ?V0 + 5,#0x0
   \   00001F   AA..         MOV     R2,?V0 + 4
   \   000021   AB..         MOV     R3,?V0 + 5
   \   000023   12....       LCALL   ??osal_msg_allocate?relay
   \   000026   8A..         MOV     ?V0 + 4,R2
   \   000028   8B..         MOV     ?V0 + 5,R3
   \   00002A   85....       MOV     ?V0 + 0,?V0 + 4
   \   00002D   85....       MOV     ?V0 + 1,?V0 + 5
    177            if ( msg )
   \   000030   E5..         MOV     A,?V0 + 0
   \   000032   45..         ORL     A,?V0 + 1
   \   000034   6067         JZ      ??debug_str_0
    178            {
    179              // Message type, length
    180              msg->hdr.event = CMD_DEBUG_STR;
   \   000036   85..82       MOV     DPL,?V0 + 0
   \   000039   85..83       MOV     DPH,?V0 + 1
   \   00003C   7406         MOV     A,#0x6
   \   00003E   F0           MOVX    @DPTR,A
    181              msg->strLen = strLen;
   \   00003F   E5..         MOV     A,?V0 + 3
   \   000041   85..82       MOV     DPL,?V0 + 0
   \   000044   85..83       MOV     DPH,?V0 + 1
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E5..         MOV     A,?V0 + 3
   \   00004B   F0           MOVX    @DPTR,A
    182          
    183              // Append message, no terminator
    184              msg->pString = (uint8 *)(msg+1);
   \   00004C   E5..         MOV     A,?V0 + 0
   \   00004E   2405         ADD     A,#0x5
   \   000050   F8           MOV     R0,A
   \   000051   E5..         MOV     A,?V0 + 1
   \   000053   3400         ADDC    A,#0x0
   \   000055   F9           MOV     R1,A
   \   000056   85..82       MOV     DPL,?V0 + 0
   \   000059   85..83       MOV     DPH,?V0 + 1
   \   00005C   A3           INC     DPTR
   \   00005D   A3           INC     DPTR
   \   00005E   A3           INC     DPTR
   \   00005F   E8           MOV     A,R0
   \   000060   F0           MOVX    @DPTR,A
   \   000061   A3           INC     DPTR
   \   000062   E9           MOV     A,R1
   \   000063   F0           MOVX    @DPTR,A
    185              osal_memcpy ( msg->pString, str_ptr, strLen );
   \   000064                ; Setup parameters for call to function osal_memcpy
   \   000064   8E..         MOV     ?V0 + 4,R6
   \   000066   8F..         MOV     ?V0 + 5,R7
   \   000068   75..00       MOV     ?V0 + 6,#0x0
   \   00006B   78..         MOV     R0,#?V0 + 4
   \   00006D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000070   85....       MOV     ?V0 + 4,?V0 + 3
   \   000073   75..00       MOV     ?V0 + 5,#0x0
   \   000076   AC..         MOV     R4,?V0 + 4
   \   000078   AD..         MOV     R5,?V0 + 5
   \   00007A   85..82       MOV     DPL,?V0 + 0
   \   00007D   85..83       MOV     DPH,?V0 + 1
   \   000080   A3           INC     DPTR
   \   000081   A3           INC     DPTR
   \   000082   A3           INC     DPTR
   \   000083   E0           MOVX    A,@DPTR
   \   000084   FA           MOV     R2,A
   \   000085   A3           INC     DPTR
   \   000086   E0           MOVX    A,@DPTR
   \   000087   FB           MOV     R3,A
   \   000088   12....       LCALL   ??osal_memcpy?relay
   \   00008B   7403         MOV     A,#0x3
   \   00008D   12....       LCALL   ?DEALLOC_XSTACK8
    186          
    187              osal_msg_send( MT_TaskID, (uint8 *)msg );
   \   000090                ; Setup parameters for call to function osal_msg_send
   \   000090   AA..         MOV     R2,?V0 + 0
   \   000092   AB..         MOV     R3,?V0 + 1
   \   000094   90....       MOV     DPTR,#MT_TaskID
   \   000097   E0           MOVX    A,@DPTR
   \   000098   F9           MOV     R1,A
   \   000099   12....       LCALL   ??osal_msg_send?relay
   \   00009C   E9           MOV     A,R1
    188            }
    189          } // debug_str()
   \                     ??debug_str_0:
   \   00009D   7F07         MOV     R7,#0x7
   \   00009F   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??debug_msg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    debug_msg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??debug_str?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    debug_str
    190          
    191          /*********************************************************************
    192          *********************************************************************/
    193          #endif  // MT_TASK

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     debug_msg                  1      0     26
       -> osal_msg_allocate     0      0     44
       -> osal_msg_send         0      0     44
     debug_str                  1      0     18
       -> osal_strlen           0      0     30
       -> osal_msg_allocate     0      0     30
       -> osal_memcpy           0      0     36
       -> osal_msg_send         0      0     30


   Segment part sizes:

     Function/Label    Bytes
     --------------    -----
     debug_msg          213
     debug_str          162
     ??debug_msg?relay    6
     ??debug_str?relay    6

 
 375 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
 
 387 bytes of CODE memory

Errors: none
Warnings: none
